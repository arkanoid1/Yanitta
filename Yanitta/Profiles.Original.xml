<?xml version="1.0"?>
<ProfileDb xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema">
  <Version>0.0.3.234</Version>
  <Author>Konctantin</Author>
  <Url>https://raw.github.com/Konctantin/yanitta/master/Yanitta/Profiles.Original.xml</Url>
  <Core><![CDATA[-- первоначальные настройки, используются, когда аддон работает в режиме отладки
ShowInChat   = true;    -- показывать сообщения в чате
DebugEnabled = true;    -- показывать отладочные сообщения в чате
ProcNotifyer = false;
OnEventExtended = nil;
ping         = 0;       -- текущий пинг
-- Константы горячих клавиш
mkLeftShift     = 1;
mkLeftControl   = 2;
mkLeftAlt       = 3;
mkRightShift    = 4;
mkRightControl  = 5;
mkRightAlt      = 6;

ABILITY_TABLE  = { };
AURA_PROC_LIST = { };
LOSS_TABLE     = { };

LAST_TARGET = 0;

-- Возвращает ограниченное сверху и снизу значение
function asc(m_value, m_min, m_max)
    if m_value < m_min then
        return m_min;
    elseif m_value > m_max then
        return m_max;
    end
    return m_value;
end

function CheckAndCastAbility(ability)
    -- Если способность требует проверки в бою
    if ability.IsCheckInCombat and (not FORCE_IN_COMBAT and not UnitAffectingCombat("player")) then
        return;
    end

    -- Имитация задержки на повторное произнесение заклинания
    local recastDelay = 0;
    if ability.SetRecastDelay then
        -- установка задержки, для текущего заклинания
        recastDelay = ping + 300;
        if (GetTime() - ability.LastCastingTime) < 1 then
            return;
        end
    end

    -- вычисление задержки от пинга
    local pingin, pingout = select(3, GetNetStats());
    ping = ((pingin + pingout) / 1000);
    ping = asc(ping, 0.05, 0.80);
    local castPing = (ping * 1000) - recastDelay;

    -- Если не указан ид заклинания,
    -- тогда выполняем только код проверки, и дальше не идем
    if ability.SpellId < 1 then
        return ability.Func(ability);
    end

    -- проверка на возможность использовать заклинание
    -- тут входит и проверка на основной ресурс и условия к применению.
    -- На пример, если произношение заклинания требует  меньше 20% здоровья цели.
    -- ВАЖНО. Не надо городить кучи проверок, лучше использовать эту функцию
    -- Не делает проверку на доступность заклинания по уровню
    if not IsUsableSpell(ability.SpellId) then
        return;
    end

    -- Проверка на то, читает ли в этот момент персонаж заклинание (с учетом пинга)
    if not ability.CencelCasting then
        local endTime = select(6, UnitCastingInfo("player")) or 0;
        if (endTime - (GetTime() * 1000)) >= castPing then
            return;
        end
    end

    -- Проверка на то, поддерживает ли в этот момент персонаж заклинание (с учетом пинга)
    if not ability.DropChanel then
        local endTime = select(6, UnitChannelInfo("player")) or 0;
        if (endTime - (GetTime() * 1000)) >= castPing then
            return;
        end
    end

    -- вычисление кулдаунка заклинания
    local start, duration, enable = GetSpellCooldown(ability.SpellId);
    if enable == 1 and ((duration + start) - GetTime()) > ping then
        return;
    end

    -- Проверка, на присутствие бафа прока, если бафа нет - значит убираем прок
    if ProcNotifyer then
        -- todo: implement proc notifier;
    end

    if (ability.IsMovingCheck == "notmoving" and IsMoving()) or (ability.IsMovingCheck == "moving" and not IsMoving()) then
        return;
    end

    -- Выполняем функцию проверки
    local mResult = ability.Func(ability);
    if not mResult then
        return;
    end
    --и если она нам возвращает новую цель, тогда делаем ее присваивание.
    if type(mResult) == "string" then
        ability.Target = mResult;
    end

    -- Поскольку многие функции требуют имени заклинания, получим его.
    local spellInfo = GetSpellInfo(ability.SpellId);
    if not spellInfo then
        return;
    end

    -- Делает проверку на то, что данное заклинание доступно для персонажа.
    -- Не работает для некоторых заклинаний (например: Увечье (друид))
    if ability.IsSpellKnownCheck and not IsSpellKnown(ability.SpellId) then
        return;
    end

    -- проверку на доступность цели делаем только для определенных видов целей
    if ability.Target ~= "none" and ability.Target ~= "player" and ability.Target ~= "mouselocation" then

        -- Проверка на доступность юнита, тоесть есть ли он.
        if not UnitExists(ability.Target) then
            return;
        end

        -- проверка, если стоит свойство на возможность атаковать
        if ability.IsAttackedCheck then
            -- если юнит дух или мертв, тогда не выполняем ротацию
            local deadOrGhost = UnitIsDeadOrGhost(ability.Target);
            if deadOrGhost == 1 then
                return;
            end

            -- если цель незьзя атаковать
            local isCanAttack = UnitCanAttack("player", ability.Target);
            if isCanAttack ~= 1 then
                return;
            end
        end

        -- Проверка на досягаемость цели
        -- эта функция работает не для всех заклинаний, поэтому нужна постоянная проверка.
        -- Если эта функция возвращает nil, тогда проверка не проходит, и надо извращатся.
        -- Если проверка не проходит используйте стнадартную проверку:
        -- IsSpellInRange([заклинание одинаковое по радиусу действия], unit)
        if ability.IsRangeCheck then
            local isRange = IsSpellInRange(spellInfo, ability.Target);
            if not isRange and DebugEnabled then
                print("|cfff5360c Ошибка IsSpellInRange: ["..tostring(ability.SpellId).."] "..spellInfo..".|r");
            end
            if isRange ~= 1 then
                return;
            end
        end
    end

    -- прерываем канальное или потоковое заклинание,
    -- ести стоит соответствующая установка
    if ability.CencelCasting or ability.DropChanel then
        SpellStopCasting();
    end

    -- чтение заклинания по области
    if ability.Target == "mouselocation" then
        local last_target_guid = UnitGUID("target");
        CastSpellByName(spellInfo, nil);
        CameraOrSelectOrMoveStart();
        CameraOrSelectOrMoveStop();
        -- для того, чтобы была видна область действия заклинания
        CastSpellByName(spellInfo, nil);
        if UnitGUID("target") ~= last_target_guid then
            TargetLastTarget();
        end
    -- чтения заклинания без цели
    elseif ability.Target == "none" then
        LAST_TARGET = UnitGUID("player");
        CastSpellByName(spellInfo, nil);
    -- чтение заклинания по конкретной цели
    else
        LAST_TARGET = UnitGUID(ability.Target);
        CastSpellByName(spellInfo, ability.Target);
    end
    if not ability.IsNotHCD then
        return true;
    end
end

-- Включение/выключение текущей ротации
function ChangeRotation(rotation, notes)
    -- Если ротация пустая, или новая ротация такая же как и текущая, тогда выключаем
    if (not rotation or rotation == CurentRotation) and CurentRotation then
        CurentRotation = nil;
        AddonEnabled   = false;
        -- [красный]Ротация отключена.
        ShowMessage("|cfff5360cРотация отключена.|r", true);
        PlaySound("PAPERDOLLCLOSE", "Master");

        -- При выключении ротации, снимаем регистрацию с событий
        if AddonFrame then
            AddonFrame:UnregisterAllEvents();
        end
    else
        if AddonFrame then
            AddonFrame:RegisterEvent("COMBAT_LOG_EVENT_UNFILTERED");
            AddonFrame:RegisterEvent("PLAYER_ENTERING_WORLD");
            AddonFrame:RegisterEvent("PLAYER_LOGOUT");
        end

        -- Иначе запускаем ротацию
        CurentRotation = rotation;
        AddonEnabled   = true;
        -- [зеленый]Ротация: [фиолетовый]Название ротации [зеленый] - Включена.
        ShowMessage("|cff15bd05Ротация: |r|cff6f0a9a"..rotation.."|r|cff15bd05 - Включена.|r", true);
        if notes and strtrim(notes) ~= "" then
            print("|cff6f0a9a     "..notes.."|r");
        end
        PlaySound("PAPERDOLLOPEN", "Master");
    end
end

function AddonFrame_OnEvent(self, event, ...)
    if event == "PLAYER_ENTERING_WORLD" then
        if AddonFrame then
            AddonFrame:Show();
        end
    elseif event == "PLAYER_LOGOUT" then
        ChangeRotation();
    elseif event == "COMBAT_LOG_EVENT_UNFILTERED" then
        local timestamp, subEvent, hideCaster,
              sourceGUID,srcName,  sourceFlags,sourceFlags2,
              destGUID,  destName, destFlags,  destFlags2,
              spellId,   spellName,spellSchool, param15 = ...;
        if (subEvent == "SPELL_CAST_SUCCESS" and type(ABILITY_TABLE) == "table" and sourceGUID == UnitGUID("player")) then
            for i, ability in ipairs(ABILITY_TABLE) do
                if (spellId == ability.SpellId) and (destGUID == UnitGUID(ability.Target)) then
                    -- Если мы удачно прочитали заклинание под проком, убираем его из списка
                    ability.HasProc = false;
                    -- Устанавливаем время последнего удачного каста
                    if ability.SetRecastDelay then
                        ability.LastCastingTime = GetTime();
                    end
                end
            end
        elseif ProcNotifyer and subEvent == "SPELL_AURA_APPLIED" and sourceGUID == UnitGUID("player") then
            for i, ability in ipairs(ABILITY_TABLE) do
                for _,proc_aura_id in ipairs(AURA_PROC_LIST) do
                    if proc_aura_id == spellId then
                        ability.HasProc = spellId;
                        break;
                    end
                end
            end
        elseif subEvent == "SPELL_CAST_FAILED" then
            if param15 == SPELL_FAILED_LINE_OF_SIGHT and LAST_TARGET ~= 0 then
                LOSS_TABLE[LAST_TARGET] = {
                    ctime  = GetTime(),
                    cspell = spellId
                };
            elseif param15 == SPELL_FAILED_NOT_BEHIND then
                LastNotBehindTime = GetTime();
            end
        end
    end
    --print(type(OnEventExtended) )
    if type(OnEventExtended) == "function" then
        OnEventExtended(self, event, ...);
    end
end

function AddonFrame_OnUpdate(self, elapsed)
    if type(ABILITY_TABLE) == "table" then
        if GetTime() >= LastTime and #ABILITY_TABLE > 0 then
            if AddonEnabled and not UnitIsDeadOrGhost("player") then
                -- Передираем способности, и останавляваемся, если условия выполнены
                for _,ability in ipairs(ABILITY_TABLE) do
                    if CheckAndCastAbility(ability) then
                        break;
                    end
                end
            end
            LastTime = GetTime() + (Delay / 1000);
        end
        -- Будем каждые 30 сек. обнулять таблицу
        if GetTime() >= LastTimeClearLossTable then
            LOSS_TABLE = { };
            LastTimeClearLossTable = GetTime() + 30;
        end
    end
end

function ShowMessage(msg, toConsole, duration)
    if NotifyFrame then
        NotifyFrame.text:SetText(msg);
        NotifyFrame:Show();
        durationMessage = (GetTime() + (duration or 5));
    end
    if toConsole then
        print(msg);
    end
end

if not NotifyFrame then
    durationMessage = 0;
    NotifyFrame = CreateFrame('Frame');
    NotifyFrame:ClearAllPoints();
    NotifyFrame:SetHeight(300);
    NotifyFrame:SetWidth(600);
    NotifyFrame:SetScript('OnUpdate', function()
        if durationMessage < GetTime() then
            NotifyFrame:Hide();
        end
    end);
    NotifyFrame:Hide();
    NotifyFrame.text = NotifyFrame:CreateFontString(nil, 'BACKGROUND', 'PVPInfoTextFont');
    NotifyFrame.text:SetAllPoints();
    NotifyFrame:SetPoint('CENTER', 0, 100);
end

if not AddonFrame then
    CurentRotation  = nil;      -- текущая ротация
    AddonEnabled    = false;    -- признак включенного аддона
    Delay           = 250;      -- интервал таймера (милисекунды)
    LastTime        = 0;        -- служебная переменная для таймера
    LastTimeClearLossTable = 0;
    LastStartMovingTime    = 0;
    LastNotBehindTime      = 0;

    AddonFrame = CreateFrame("Frame");
    AddonFrame:SetScript("OnUpdate", AddonFrame_OnUpdate);
    AddonFrame:SetScript("OnEvent",  AddonFrame_OnEvent);
    AddonFrame:Show();
end]]></Core>
  <Func><![CDATA[-- Заклинания (бафы), которые позволяют произносить заклинания на ходу
moving_spell_table = {
    97128,  -- Опаляющее перо (Алисразор)
    79206,  -- Благосклонность предков (Шанам)
    110806, -- Благосклонность предков (Друид: Симбиоз)
    147806, -- Вневременной остров
};

-- Возвращает, есть ли один из перечисленных бафов на персонаже
-- Возвращает:
--  Имя эффекта
--  Количество стаков
--  Оставшееся время действия
--  value1, value2, value3 - Величина эффекта
-- Параметры:
--  unit - Цель ("palyer", "target", "focus", "mouseover")
--  {...} - перечень бафов
--  filter - фильтр
function HasBuff(unit, spellId, filter)

    local spell_table = { };
    if type(spellId) == "table" then
        spell_table = spellId;
    elseif type(spellId) == "number" then
        spell_table = { spellId };
    end

    for _,spell_id in ipairs(spell_table) do
        local spellName, spellRank = GetSpellInfo(spell_id);
        if spellName then
            -- name, rank, icon, count, dispelType, duration, expires, caster, isStealable, shouldConsolidate, spellID, canApplyAura, isBossDebuff, value1, value2, value3
            local name,_,_,count,_,_,expires,_,_,_,_,_,_,value1,value2,value3 = UnitBuff(unit, spellName, spellRank, filter);
            if name then
                local rem = asc((expires or 0) - GetTime(), 0, 0xffff);
                return name, count, rem, value1, value2, value3;
            end
        end
    end
    return nil, 0, 0, 0, 0, 0;
end

-- Возвращает, есть ли один из перечисленных дебафов на персонаже
-- Возвращает:
--  Имя эффекта
--  Количество стаков
--  Оставшееся время действия
--  value1, value2, value3 - Величина эффекта
-- Параметры:
--  unit - Цель ("palyer", "target", "focus", "mouseover")
--  {...} - перечень дебафов
--  filter - фильтр
function HasDebuff(unit, spellId, filter)

    local spell_table = { };
    if type(spellId) == "table" then
        spell_table = spellId;
    elseif type(spellId) == "number" then
        spell_table = { spellId };
    end

    for _,spell_id in ipairs(spell_table) do
        local spellName, spellRank = GetSpellInfo(spell_id);
        if spellName then
            -- name, rank, icon, count, dispelType, duration, expires, caster, isStealable, shouldConsolidate, spellID, canApplyAura, isBossDebuff, value1, value2, value3
            local name,_,_,count,_,_,expires,_,_,_,_,_,_,value1,value2,value3 = UnitDebuff(unit, spellName, spellRank, filter);
            if name then
                local rem = asc((expires or 0) - GetTime(), 0, 0xffff);
                return name, count, rem, value1, value2, value3;
            end
        end
    end
    return nil, 0, 0, 0, 0, 0;
end

function UnitBuffId(target, spellId, filter)
    local spellName, spellRank = GetSpellInfo(spellId);
    if spellName then
        return UnitBuff(target, spellName, spellRank, fileter);
    end
end

function UnitDebuffId(target, spellId, filter)
    local spellName, spellRank = GetSpellInfo(spellId);
    if spellName then
        return UnitDebuff(target, spellName, spellRank, fileter);
    end
end

-- Вызвращает время до восстановления заклинания
-- Параметр: ид заклинания
function SpellCD(m_spell)
    local start, duration = GetSpellCooldown(m_spell);
    local cooldown = duration + start - GetTime();
    return cooldown > 0 and cooldown or 0;
end

-- Проверка, двигается ли игрок, за исключением бафов, которые дают возможность кастровать на ходу
-- на пример: Опаляющее перо (Алисразор), Благосклонность предков (Шанам)
function IsMoving()
    for _,spell in ipairs(moving_spell_table) do
        local name,rank = GetSpellInfo(spell);
        if name then
            if UnitAura("player", name, rank, nil) then
                return;
            end
        end
    end

    return GetUnitSpeed("player") ~= 0;
end

-- Проверка на нахождение персонажа за спиной цели
function IsNotBehind(sec)
    local sec = sec or 1;
    if (GetTime() - LastNotBehindTime <= sec) then
        return true;
    end
end

-- Проверка на нахождение цели в зоне видимости персонажа
function IsNotLineOfSight(unit,sec)
    local sec = sec or 1;
    local guid = UnitGUID(unit);
    if type(LOSS_TABLE) == "table" then
        local rec = LOSS_TABLE[guid];
        if rec and GetTime() - rec.ctime <= sec then
            return true;
        end
    end
end

-- возвращает текущее значение здоровья в процентах
function HealthByPercent(m_target)
    if UnitExists(m_target) then
        return 100 * (UnitHealth(m_target) or 1) / (UnitHealthMax(m_target) or 1);
    end
    return 0;
end

-- возвращает текущее значение ресурса (мана, энергия, фокус, ярость ...) в процентах
function PowerByPercent(m_target, m_powertype)
    if UnitExists(m_target) then
        return 100 * (UnitPower(m_target, m_powertype) or 1) / (UnitPowerMax(m_target, m_powertype) or 1);
    end
    return 0;
end

-- Проверка, была ли зажата клавиша модификатор mk*
function IsModKeyDown(m_key)
    if not GetCurrentKeyBoardFocus() then
        if     m_key == mkLeftShift    and IsLeftShiftKeyDown()    then return true;  -- 1
        elseif m_key == mkLeftControl  and IsLeftControlKeyDown()  then return true;  -- 2
        elseif m_key == mkLeftAlt      and IsLeftAltKeyDown()      then return true;  -- 3
        elseif m_key == mkRightShift   and IsRightShiftKeyDown()   then return true;  -- 4
        elseif m_key == mkRightControl and IsRightControlKeyDown() then return true;  -- 5
        elseif m_key == mkRightAlt     and IsRightAltKeyDown()     then return true;  -- 6
        end
    end
end

-- вычисление дистанции между 2 игроками (рейд или группа)
function GetDistance(unit1, unit2)
    local x1, y1 = GetPlayerMapPosition(unit1);
    local x2, y2 = GetPlayerMapPosition(unit2);

    return sqrt(((x1 - x2) ^ 2) + ((y1 - y2) ^ 2)) * 2000;
end

-- Проверяет растояние между 2мя игроками по их координатам
function CheckDistance(x1, x2, y2, y2, distance)
    return (sqrt(((x1 - x2) ^ 2) + ((y1 - y2) ^ 2)) * 2000) <= distance;
end

-- Проверяет растояние между 2мя игроками
function CheckDistance2(unit1, unit2, distance)
    local x1, y1 = GetPlayerMapPosition(unit1);
    local x2, y2 = GetPlayerMapPosition(unit2);

    return (sqrt(((x1 - x2) ^ 2) + ((y1 - y2) ^ 2)) * 2000) <= distance;
end

-- Проверка, имеется ли у персонажа указанный символ
function HasGlyph(glyphid)
    for slot = 1, 6 do
        if select(4, GetGlyphSocketInfo(slot)) == glyphid then
            return true;
        end
    end
end

-- Использование предмета в инвентаре
-- Если предмет (перчатка, тринька, пояс и т.п) юзабелен и не имеет КД - имитируем клик правой кн. мыши.
function UseItemBySlot(slotId)
    local start, duration, enable = GetInventoryItemCooldown("player", slotId);
    -- Проверку на пинг делать не будем, так как это не критично
    if duration == 0 and enable == 1 then
        UseInventoryItem(slotId);
    end
end

-- Использование предмета в инвентаре по его ID
function UseItemById(itemId)
    local count = GetItemCount(itemId);
    if (count or 0) > 0 then
        local start,duration,enable = GetItemCooldown(itemId);
        if start == 0 and duration == 0 and enable then
            UseItemByName(itemId);
        end
    end
end

-- Проверяет, надо ли сбивать заклинание текущему юниту.
function CheckInterrupt(unit)
    if not UnitExists(unit) then
        return;
    end
    -- чтение заклинания прерываем только перед окончанием каста.
    local name,_,_,_,startTime,endTime,isTrade,_,notInterruptible = UnitCastingInfo(unit);
    if name and not (notInterruptible or isTrade) then
        if (((endTime / 1000) - GetTime()) - ping) <= 1 then
            return true;
        end
    end
    -- канальное заклинание прерываем сразу.
    local name,_,_,_,_,_,isTrade,notInterruptible = UnitChannelInfo(unit);
    if name and not (notInterruptible or isTrade) then
        return true;
    end
end

-----------------------------------------------
--                    HEAL                   --
-----------------------------------------------

MAIN_CLASS_SPELL = 0;

-- Возвращает ID юнита
function UnitId(unit)
    return tonumber((UnitGUID(unit) or "0x0000000000000000"):sub(-12, -9), 16);
end

-- Добавляет в таблицу "members" указанного юнита, при этом делая проверки (возможность лечить)
function InsertNewUnitToHeallersTable(unit)
    if UnitExists(unit)
        and not UnitIsDeadOrGhost(unit)
        and UnitCanAssist(unit, "player")
        and IsSpellInRange(GetSpellInfo(MAIN_CLASS_SPELL), unit) == 1
        and not IsNotLineOfSight(unit) then
        for i,member in ipairs(members) do
            if UnitGUID(member.Unit) ~= UnitGUID(unit) then
                table.insert(members, { Unit = unit, IsInMyPaty = false });
            end
        end
    end
end

-- Исключительные ситуации в рейде, добавление юнитов для дополнительного лечения.
function ExtendTheHealTable()
    if type(members) == "table" then
        -- Норусхен
        local bossId = UnitId("boss1");
        -- Если хиллер на испытании, добавляем юнитов для отхила.
        if bossId == 71475 or bossId == 71479 or bossId == 71480 then
            InsertNewUnitToHeallersTable("boss1");
            InsertNewUnitToHeallersTable("boss2");
            InsertNewUnitToHeallersTable("boss3");
        end
        -- отхил дружественной цели по mouseover/target/focus
        InsertNewUnitToHeallersTable("target");
        InsertNewUnitToHeallersTable("focus");
        InsertNewUnitToHeallersTable("mouseover");
    end
end

-- в эту функцию добавляем логику по особому поведению в рейдах
-- на пример, если есть какой-то дебаф, который надо выхиливать.
function CheckInstanseLogic(members, index)
    local member = members[index];
    -- Осада Огриммара: Малкорок
    -- Отхил не проходит, надо настакивать щит под дебафом
    -- по этому просто занижаем реальное здоровье.
    if HasDebuff(member.Unit, 142861) then
        -- возможно есть дебаф, который показывает уровень щита, если этот так,
        -- надо добавить логику и на него.
        if HasDebuff(member.Unit, 142863) then -- красный
            member.HP = 50;
        elseif HasDebuff(member.Unit, 142864) then -- желтый
            member.HP = 80;
        elseif HasDebuff(member.Unit, 142865) then -- зеленый
            member.HP = 100;
        else -- без щита
            member.HP = 30;
        end
    end

    -- Престол гроз: Наложницы блезнецы (Дебаф: Чудовище из кошмаров)
    if HasDebuff(member.Unit, 137341) then
        table.remove(members, index);
    end
end

-- Выполняет проверку на доступность диспела для текущего лекаря (учитывается симбиоз друида)
function ValidDispellForClass(dispelType, druidSimbios)
    -- Curse Disease Magic Poison
    if not dispelType then return; end
    local class = select(2, UnitClass("player"));
    if     class == "PRIEST" then
        return dispelType == "Magic" or dispelType == "Disease";
    elseif class == "DRUID" and druidSimbios then -- Simbios of paladin
        return                          dispelType == "Poison" or dispelType == "Disease";
    elseif class == "DRUID" then
        return dispelType == "Magic" or dispelType == "Poison" or dispelType == "Curse";
    elseif class == "PALADIN" then
        return dispelType == "Magic" or dispelType == "Poison" or dispelType == "Disease";
    elseif class == "MONK" then
        return dispelType == "Magic" or dispelType == "Poison" or dispelType == "Disease";
    elseif class == "SHAMAN" then
        return dispelType == "Magic" or dispelType == "Curse";
    end
end

-- логика развеивания заклинаний, тут добавляем условия, которые запрещают развеивать дебафы
function CheckRaidDispellLogic(spellId, member)
    -- ша гордыни: диспелим "Слово тьмы: Погибель" только с дебафом "Дар титанов"
    -- После "Освобождения" Дар титанов больше не кидается, поэтому диспелим по КД
    if spellId == 144351 and (not HasDebuff("player", 144359) and HealthByPercent("boss1") > 30) then
        return true;
    end
    -- Блуждающая энергия: надо диспелить когда возле цели разсеивания нету других игроков
    if spellId == 142913 then
        for i,member2 in ipairs(members) do
            if CheckDistance2(member.Unit, member2.Unit, 9) then
                return true;
            end
        end
    end
end

-- Возвращает юнита, с которого надо диспелить (с наибольшим количеством стаков)
-- Параметр druidSimbios - Указывает, что это заклинание от симбиоза
-- Возвращает: unit, count или nil - если диспелить нечего.
function GetDispellInfo(druidSimbios)
    local dispellTable = {};
    for _,member in ipairs(members) do
        for i = 1, 40 do
            local name,_,_,count,dispelType,duration,expires,_,_,_,spellId = UnitDebuff(member.Unit, i);
            if not name then
                break;
            end
            -- Проверяем можем ли мы диспелить данный тип дебафа + проверяем надо ли диспелить.
            if ValidDispellForClass(dispelType, druidSimbios) and not CheckRaidDispellLogic(spellId, member) then
                table.insert(dispellTable, { Unit = member.Unit, Count = count, HP = member.HP });
            end
        end
    end
    if #dispellTable > 0 then
        table.sort(dispellTable, function(A, B)
            return A.Count > B.Count;
        end);
        return dispellTable[1].Unit, dispellTable[1].Count;
    end
end

-- Формирует таблицу "members" которая содержит юнитов нуждающихся в лечении.
-- при формировании происходят проверки: (доступность + рейдовая логика)
-- сформированная таблица будет отчортирована по наименьшему здоровью.
function FillPartyTables(standartSpellId)
    -- Обнуляем все хиловские глобальные переменные.
    FORCE_IN_COMBAT  = false;
    MAIN_CLASS_SPELL = standartSpellId;
    LowHP            = { };
    members          = {{ Unit = "player", IsInMyPaty = true }};

    local prefix = "party";
    if IsInRaid() then
        prefix = "raid";
    elseif IsInArenaTeam() then
        prefix = "arena";
    end

    for index = 1, GetNumGroupMembers() do
        local unit = prefix..index; -- raid5
        if UnitExists(unit) and not UnitIsUnit("player", unit) and UnitIsConnected(unit) then
            local inRange   = IsSpellInRange(GetSpellInfo(standartSpellId), unit) == 1;
            local isVisible = not IsNotLineOfSight(unit); -- need testing
            if inRange and isVisible and not UnitIsDeadOrGhost(unit) and not UnitCanAttack("player", unit) then
                table.insert(members, { Unit = unit, IsInMyPaty = true });
            end
        end
    end

    ExtendTheHealTable();

    -- Обновляем статы игроков из пати/рейда
    for i, member in ipairs(members) do
        member.IsTank  = UnitGroupRolesAssigned(member.Unit) == "TANK";
        member.Agro    = UnitThreatSituation(member.Unit) or 0;

        local max_hp   = UnitHealthMax(member.Unit) or 0;
        local inc_hp   = UnitGetIncomingHeals(member.Unit) or 0;
        local cur_hp   = UnitHealth(member.Unit) or 0;
        member.IncHeal = 100 * inc_hp / max_hp;
        member.HP      = 100 * (cur_hp + inc_hp) / max_hp;

        if UnitAffectingCombat(member.Unit) then
            FORCE_IN_COMBAT = true;
        end

        -- логика по особому поведению в рейдах
        CheckInstanseLogic(members, i);

        -- подсчет количества персонажей с определенным уровнем здоровья (95-10) с шагом в -5
        for i = 95, 10, -5 do
            LowHP["H"..i] = LowHP["H"..i] and LowHP["H"..i] or 0; -- Первичная инициализация
            if member.HP <= i then
                LowHP["H"..i] = LowHP["H"..i] + 1;
            end
        end
    end
    -- сортируем таблицы по наименьшему количеству ХР
    table.sort(members, function(x, y) return x.HP < y.HP; end);
end]]></Func>
  <Profile Class="Warrior">
    <Lua><![CDATA[useCooldown = true;
setAoE      = nil;
isAltMod    = nil;
targetCount = 3;

kolossRem  = 0;
RB_Count   = 0;
RB_Rem     = 0;
rage       = 0;
targetHP   = 0;

koloss_remains      = 0;
bloodthirst_remains = 0;

function FillFurryData()
     -- Удар колосса
    koloss,_,kolossRem = HasDebuff("target", 86346, "PLAYER");
    -- Яростный выпад!
    ragingBlow,RB_Count,RB_Rem = HasBuff("player", 131116);
    -- Кровавый фарш
    meat_cleaver, meat_cleaver_couunt = HasBuff("player", 12950);
    
    rage = UnitPower("player");
    targetHP   = HealthByPercent("target");
    
    -- кулдаун колосса
    koloss_remains = SpellCD(86346);    
    -- кулдаун кровожадности
    bloodthirst_remains = SpellCD(23881);
end]]></Lua>
    <AbilityList>
      <Ability Name="Prot: Победный раж">
        <SpellID>34428</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if playerHP <= 80 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Prot: Героический прыжок">
        <SpellID>6544</SpellID>
        <Target>MouseLocation</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if IsModKeyDown(mkLeftShift) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Зуботычина">
        <SpellID>6552</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>true</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return CheckInterrupt("target");]]></Lua>
      </Ability>
      <Ability Name="Разрушительный крик">
        <SpellID>102060</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>true</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if isInMeele and SpellCD(6552) > 0 and CheckInterrupt("target") then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Инициализация (Защита)">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[-- модификатор
if     IsModKeyDown(mkLeftShift) then
elseif IsModKeyDown(mkLeftControl) then
    if setAoE then
        setAoE = false;
        ShowMessage("|cff00ff00 Одиночная цель", true);
    else
        setAoE = true;
        ShowMessage("|cffff0000 AOE", true);
    end
elseif IsModKeyDown(mkLeftAlt) then
    return true;
elseif IsModKeyDown(mkRightShift) then
    if useCooldown then
        useCooldown = false;
        ShowMessage("|cffff0000Кулдауны выключены", true);
    else
        useCooldown = true;
        ShowMessage("|cff00ff00Кулдауны включены", true);
    end
elseif IsModKeyDown(mkRightControl) then
elseif IsModKeyDown(mkRightAlt)     then
    if isAltMod then
        isAltMod = false;
        ShowMessage("|cffff0000Используется блок щитом", true);
    else
        isAltMod = true;
        ShowMessage("|cff00ff00Используется непроницаемый щит", true);
    end
end

-- если персонаж на маунте, тогда не выполняем ротацию дальше
if IsMounted() then
    return true;
end

-- Перейти в стойку защиты
if GetSpecialization() == 3 and GetShapeshiftForm() ~= 2 then
    CastShapeshiftForm(2);
end

-- камень здоровья
if HealthByPercent("player") < 30 then
    UseItemById(5512);
end

agroStatus = UnitThreatSituation("player") or 0;
isInMeele  = IsSpellInRange(GetSpellInfo(78), "target") == 1;
hasAPbuff  = HasBuff("player", { 57330, 19506});
playerHP   = HealthByPercent("player");
rage       = UnitPower("player");]]></Lua>
      </Ability>
      <Ability Name="Prot: Боевой крик">
        <SpellID>6673</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if rage < 70 and not hasAPbuff then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Prot: Командирский крик">
        <SpellID>469</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if rage < 70 and hasAPbuff then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Prot: Одобряющий клич">
        <SpellID>97462</SpellID>
        <Target>None</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if isInCombat and playerHP < 25 and useCooldown then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Prot: Ярость берсерка">
        <SpellID>18499</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>true</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if not HasBuff("player", 12880) and rage < 20 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Prot: Удар героя">
        <SpellID>78</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>true</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[-- Это заклинание не затрагивает ГКД
-- есть баф на использование бесплатного удара (Ультиматум - 122510)
if not setAoE and (HasBuff("player", 122510) or rage > 90 or agroStatus < 2) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Prot: Разсекающий удар">
        <SpellID>845</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>true</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[-- Это заклинание не затрагивает ГКД
-- есть баф на использование бесплатного удара (Ультиматум - 122510)
if setAoE and (HasBuff("player", 122510) or rage > 90 or agroStatus < 2) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Prot: Сокрушительный Бросок">
        <SpellID>64382</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[-- 5 - RightControl
if IsModKeyDown(5) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Prot: Непроницаемый щит">
        <SpellID>112048</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if playerHP < 60 and rage > 55 and agroStatus > 2 and not HasBuff("player", 112048) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Prot: Реванш">
        <SpellID>6572</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Prot: Ни шагу назад">
        <SpellID>12975</SpellID>
        <Target>None</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if playerHP < 20 and useCooldown then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Prot: Удар грома (AOE)">
        <SpellID>6343</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if isInMeele and setAoE then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Prot: Глухая оборона">
        <SpellID>871</SpellID>
        <Target>None</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if playerHP < 20 and useCooldown then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Prot: Блок щитом">
        <SpellID>2565</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if UnitPower("player") >= 60 and agroStatus > 2 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Prot: Мощный удар щитом">
        <SpellID>23922</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Prot: Удар грома (SOLO)">
        <SpellID>6343</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return isInMeele;]]></Lua>
      </Ability>
      <Ability Name="Prot: Сокрушение">
        <SpellID>20243</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return isInMeele;]]></Lua>
      </Ability>
      <Ability Name="Prot: Деморализующий крик">
        <SpellID>1160</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if playerHP <= 50 and isInMeele and useCooldown then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Инициализация (Неистовство)">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>true</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[-- модификатор
if     IsModKeyDown(mkLeftShift) then
elseif IsModKeyDown(mkLeftControl) then
    -- setAoE = 0   - solo
    -- setAoE = 2   - 2-3 target's
    -- setAoE = 3   - >4 target's
    setAoE = setAoE or 0;
    if setAoE == 0 then
        setAoE = 2;
        ShowMessage("|cff6f0a9a Несколько целей", true);
    elseif setAoE == 2 then
        setAoE = 3;
        ShowMessage("|cffff0000 AOE", true);
    else
        setAoE = 0;
        ShowMessage("|cff00ff00 Одиночная цель", true);
    end
elseif IsModKeyDown(mkLeftAlt) then
    return true;
elseif IsModKeyDown(mkRightShift) then
    if useCooldown then
        useCooldown = false;
        ShowMessage("|cff00ff00Кулдауны включены", true);
    else
        useCooldown = true;
        ShowMessage("|cffff0000Кулдауны выключены", true);
    end
elseif IsModKeyDown(mkRightControl) then
elseif IsModKeyDown(mkRightAlt) then
end

-- если персонаж на маунте, тогда не выполняем ротацию дальше
if IsMounted() then
    return true;
end

-- Перейти в боевую стойку
--if GetSpecialization() ~= 3 and GetShapeshiftForm() ~= 1 then
--    CastShapeshiftForm(1);
--end

-- камень здоровья
if HealthByPercent("player") < 30 then
    UseItemById(5512);
end

FillFurryData();
playerHP   = HealthByPercent("player");
isInMeele  = IsSpellInRange(GetSpellInfo(78), "target") == 1;]]></Lua>
      </Ability>
      <Ability Name="Furry: Безразсудство">
        <SpellID>1719</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>true</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if useCooldown and isInMeele and (kolossRem >= 5 or koloss_remains <= 4 or SpellCD(12292) <= 3) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Furry: Знамя с черепом">
        <SpellID>114207</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>true</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if useCooldown and isInMeele and (kolossRem >= 5 or koloss_remains <= 4 or SpellCD(12292) <= 3) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Furry: Кровавая баня">
        <SpellID>12292</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>true</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if useCooldown and isInMeele and koloss_remains < 1 and (HasBuff("player", 1719) or SpellCD(1719) > 60) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Furry: Ярость берсерка">
        <SpellID>18499</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>true</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if isInMeele and not HasBuff("player", 12880) and not HasBuff("player", 131116) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Furry: Вихрь">
        <SpellID>1680</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[local setAoE = setAoE or 0;
if isInMeele then
    if setAoE == 3 then
        return true;
    elseif setAoE == 2 then
        local name,count = HasBuff("player", 12950);
        if count < 2 then
            return true;
        end
    end
end]]></Lua>
      </Ability>
      <Ability Name="Furry: Удар героя">
        <SpellID>78</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>true</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if (setAoE or 0) == 0 and ((targetHP >= 20 and ( HasDebuff("target", 86346, "PLAYER") and rage >= 40 )) or rage >= 110) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Furry: Разсекающий удар">
        <SpellID>845</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>true</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if (setAoE or 0) == 2 and ((targetHP >= 20 and ( HasDebuff("target", 86346, "PLAYER") and rage >= 40 )) or rage >= 110) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Furry: Кровожадность">
        <SpellID>23881</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if not (targetHP < 20  and HasDebuff("target", 86346, "PLAYER") and rage >= 30) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Furry: Зверский удар (1)">
        <SpellID>100130</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if HasBuff("player", 46916) and targetHP >= 20 and SpellCD(23881) > 0 and SpellCD(23881) <= 1 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Furry: Пауза">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if not (targetHP < 20 and koloss and rage >= 30) and (SpellCD(23881) > 0 and SpellCD(23881) <= 1) then
    return true
end]]></Lua>
      </Ability>
      <Ability Name="Furry: Удар колосса">
        <SpellID>86346</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Furry: Рев дракона">
        <SpellID>118000</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if isInMeele and not koloss and HasBuff("player", 12292) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Furry: Казнь">
        <SpellID>5308</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Furry: Яростный выпад">
        <SpellID>85288</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if ragingBlow and (koloss or HasBuff("player", { 12292, 1719 })) then
    return true;
elseif koloss_remains >= 6 or RB_Rem <= 6 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Furry: Зверский удар (2)">
        <SpellID>100130</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if HasBuff("player", 46916) and targetHP >= 20 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Furry: Героический бросок">
        <SpellID>57755</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Furry: Боевой крик (1)">
        <SpellID>6673</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if rage < 70 and not koloss then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Furry: Зверский удар (3)">
        <SpellID>100130</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if (koloss and targetHP >= 20) or (koloss_remains >= 1 and rage >= 80 and targetHP >= 20) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Furry: Боевой крик (2)">
        <SpellID>6673</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if rage < 70 then
    return true;
end]]></Lua>
      </Ability>
    </AbilityList>
    <RotationList>
      <Rotation Name="Неистовство" ProcNotifyer="false">
        <HotKey Key="Z" Modifier="Alt" />
        <AbilityQueue>
          <string>Инициализация (Неистовство)</string>
          <string>Prot: Победный раж</string>
          <string>Зуботычина</string>
          <string>Разрушительный крик</string>
          <string>Prot: Героический прыжок</string>
          <string>Prot: Сокрушительный Бросок</string>
          <string>Furry: Безразсудство</string>
          <string>Furry: Кровавая баня</string>
          <string>Furry: Ярость берсерка</string>
          <string>Furry: Знамя с черепом</string>
          <string>Furry: Вихрь</string>
          <string>Furry: Удар героя</string>
          <string>Furry: Разсекающий удар</string>
          <string>Furry: Кровожадность</string>
          <string>Furry: Зверский удар (1)</string>
          <string>Furry: Пауза</string>
          <string>Furry: Удар колосса</string>
          <string>Furry: Рев дракона</string>
          <string>Furry: Казнь</string>
          <string>Furry: Яростный выпад</string>
          <string>Furry: Зверский удар (2)</string>
          <string>Furry: Героический бросок</string>
          <string>Furry: Боевой крик (1)</string>
          <string>Furry: Зверский удар (3)</string>
          <string>Furry: Боевой крик (2)</string>
        </AbilityQueue>
        <Notes><![CDATA[
]]></Notes>
      </Rotation>
      <Rotation Name="Защита" ProcNotifyer="false">
        <HotKey Key="X" Modifier="Alt" />
        <AbilityQueue>
          <string>Инициализация (Защита)</string>
          <string>Prot: Героический прыжок</string>
          <string>Зуботычина</string>
          <string>Разрушительный крик</string>
          <string>Prot: Победный раж</string>
          <string>Prot: Непроницаемый щит</string>
          <string>Prot: Глухая оборона</string>
          <string>Prot: Одобряющий клич</string>
          <string>Prot: Ни шагу назад</string>
          <string>Prot: Деморализующий крик</string>
          <string>Prot: Блок щитом</string>
          <string>Prot: Сокрушительный Бросок</string>
          <string>Prot: Мощный удар щитом</string>
          <string>Prot: Удар грома (AOE)</string>
          <string>Prot: Удар героя</string>
          <string>Prot: Разсекающий удар</string>
          <string>Prot: Реванш</string>
          <string>Prot: Удар грома (SOLO)</string>
          <string>Prot: Боевой крик</string>
          <string>Prot: Командирский крик</string>
          <string>Prot: Ярость берсерка</string>
          <string>Prot: Сокрушение</string>
        </AbilityQueue>
        <Notes><![CDATA[]]></Notes>
      </Rotation>
    </RotationList>
  </Profile>
  <Profile Class="Paladin">
    <Lua><![CDATA[agroStatus  = 0;
useCooldown = true;
setAoE      = nil;]]></Lua>
    <AbilityList>
      <Ability Name="Инициализация">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[-- модификатор5
if     IsModKeyDown(mkLeftShift) then
elseif IsModKeyDown(mkLeftControl) then
    if setAoE then
        setAoE = false;
        ShowMessage("|cff00ff00 >> Одиночная цель", true);
    else
        setAoE = true;
        ShowMessage("|cffff0000 >> AOE", true);
    end
elseif IsModKeyDown(mkLeftAlt) then
    return true;
elseif IsModKeyDown(mkRightShift) then
    if useCooldown then
        useCooldown = false;
        ShowMessage("|cffff0000Кулдауны выключены", true);
    else
        useCooldown = true;
        ShowMessage("|cff00ff00Кулдауны включены", true);
    end
elseif IsModKeyDown(mkRightControl) then
elseif IsModKeyDown(mkRightAlt) then
end

-- если персонаж на маунте, тогда не выполняем ротацию дальше
if IsMounted() then
    return true;
end

-- камень здоровья
if HealthByPercent("player") < 30 then
    UseItemById(5512);
end

agroStatus = UnitThreatSituation("player");
isInMeele  = IsSpellInRange(GetSpellInfo(35395), "target") == 1;
playerHP   = HealthByPercent("player");
hollyPower = UnitPower("player", SPELL_POWER_HOLY_POWER);

divine_purpose = HasBuff("player", 90174);  -- Божественный замысел
holy_avenger   = HasBuff("player", 105809); -- Святая клятва
inquisition,_,inquisition_rem = HasBuff("player", 84963); -- дознание]]></Lua>
      </Ability>
      <Ability Name="Prot: Щит небес">
        <SpellID>20925</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if not HasBuff("player", 20925, "PLAYER") then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Prot: Торжество">
        <SpellID>130551</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if playerHP < 70 then
    if divine_purpose or hollyPower > 2 then
        -- Бастион славы (114637)
        if (select(2, HasBuff("player", 114637)) or 0) > 4 then
            return true;
        end
    end
end]]></Lua>
      </Ability>
      <Ability Name="Prot: Щит праведника">
        <SpellID>53600</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if divine_purpose or hollyPower > 2 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Prot: Ревностный защитник">
        <SpellID>31850</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if playerHP < 15 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Prot: Защитник древних королей">
        <SpellID>86659</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if playerHP < 40 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Prot: Божественная защита">
        <SpellID>498</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if playerHP < 60 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Prot: Молот праведника">
        <SpellID>53595</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[-- Должен быть дебаф на Слабые Удары (115798)
return setAoE or not HasDebuff("target", 115798);]]></Lua>
      </Ability>
      <Ability Name="Prot: Удар воина света">
        <SpellID>35395</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return not setAoE;]]></Lua>
      </Ability>
      <Ability Name="Prot: Правосудие">
        <SpellID>20271</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Prot: Щит мстителя">
        <SpellID>31935</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Prot: Освящение">
        <SpellID>26573</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if isInMeele and not HasDebuff("target", 26573, "PLAYER") then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Prot: Гнев небес">
        <SpellID>119072</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return isInMeele;]]></Lua>
      </Ability>
      <Ability Name="Prot: Божественная призма">
        <SpellID>114165</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Prot: Праведное неистовство">
        <SpellID>25780</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if not HasBuff("player", 25780) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Retri: Дознание">
        <SpellID>84963</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if hollyPower > 2 and inquisition_rem <= 2 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Retri: Гнев карателя">
        <SpellID>31884</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if useCooldown and inquisition then
    if SpellCD(86698) < 291 then
        return true;
    end
end]]></Lua>
      </Ability>
      <Ability Name="Retri: Защитник древних королей">
        <SpellID>86698</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if useCooldown and inquisition then
    if SpellCD(31884) < 10 then
        return true;
    end
end]]></Lua>
      </Ability>
      <Ability Name="Retri: Святая клятва">
        <SpellID>105809</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if useCooldown and inquisition and hollyPower <= 2 then
    if SpellCD(86698) < 289 then
        return true;
    end
end]]></Lua>
      </Ability>
      <Ability Name="Retri: Смертный приговор">
        <SpellID>114157</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if useCooldown and inquisition then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Retri: Вердикт храмовника (1)">
        <SpellID>85256</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if not setAoE then
    if hollyPower > 4 or (hollyPower > 1 and holy_avenger) then
        return true;
    end
end]]></Lua>
      </Ability>
      <Ability Name="Retri: Божественная буря">
        <SpellID>53385</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if setAoE then
    if hollyPower > 4 or (hollyPower > 1 and holy_avenger) then
        return true;
    end
end]]></Lua>
      </Ability>
      <Ability Name="Retri: Молот гнева">
        <SpellID>24275</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Retri: Экзорцизм">
        <SpellID>879</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Retri: Удар воина Света">
        <SpellID>35395</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return not setAoE;]]></Lua>
      </Ability>
      <Ability Name="Retri: Молот праведника">
        <SpellID>53595</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return setAoE;]]></Lua>
      </Ability>
      <Ability Name="Retri: Правосудие">
        <SpellID>20271</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Retri: Вердикт храмовника (2)">
        <SpellID>85256</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if not setAoE and hollyPower > 2 then
    return true;
end]]></Lua>
      </Ability>
    </AbilityList>
    <RotationList>
      <Rotation Name="Защита" ProcNotifyer="false">
        <HotKey Key="X" Modifier="Alt" />
        <AbilityQueue>
          <string>Инициализация</string>
          <string>Prot: Щит небес</string>
          <string>Prot: Торжество</string>
          <string>Prot: Щит праведника</string>
          <string>Prot: Ревностный защитник</string>
          <string>Prot: Защитник древних королей</string>
          <string>Prot: Божественная защита</string>
          <string>Prot: Молот праведника</string>
          <string>Prot: Удар воина света</string>
          <string>Retri: Молот гнева</string>
          <string>Prot: Божественная призма</string>
          <string>Prot: Щит мстителя</string>
          <string>Prot: Правосудие</string>
          <string>Prot: Освящение</string>
          <string>Prot: Гнев небес</string>
          <string>Prot: Праведное неистовство</string>
        </AbilityQueue>
        <Notes><![CDATA[]]></Notes>
      </Rotation>
      <Rotation Name="Лекарь" ProcNotifyer="false">
        <HotKey Key="Z" Modifier="Alt" />
        <AbilityQueue />
        <Notes><![CDATA[]]></Notes>
      </Rotation>
      <Rotation Name="Воздаяние" ProcNotifyer="false">
        <HotKey Key="C" Modifier="Alt" />
        <AbilityQueue>
          <string>Инициализация</string>
          <string>Retri: Дознание</string>
          <string>Retri: Гнев карателя</string>
          <string>Retri: Защитник древних королей</string>
          <string>Retri: Святая клятва</string>
          <string>Retri: Смертный приговор</string>
          <string>Retri: Вердикт храмовника (1)</string>
          <string>Retri: Божественная буря</string>
          <string>Retri: Молот гнева</string>
          <string>Retri: Экзорцизм</string>
          <string>Retri: Удар воина Света</string>
          <string>Retri: Молот праведника</string>
          <string>Retri: Правосудие</string>
          <string>Retri: Вердикт храмовника (2)</string>
        </AbilityQueue>
        <Notes><![CDATA[]]></Notes>
      </Rotation>
    </RotationList>
  </Profile>
  <Profile Class="Hunter">
    <Lua><![CDATA[useCooldown = true;
setAoE      = nil;
isAltMod    = nil;]]></Lua>
    <AbilityList>
      <Ability Name="Инициализация">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[-- модификатор
if     IsModKeyDown(mkLeftShift) then
elseif IsModKeyDown(mkLeftControl) then
    if setAoE then
        setAoE = false;
        ShowMessage("|cff00ff00 Одиночная цель", true);
    else
        setAoE = true;
        ShowMessage("|cffff0000 AOE", true);
    end
elseif IsModKeyDown(mkLeftAlt) then
    StopAttack();
    PetStopAttack();
    -- перейдем в аспект ястребя
    if GetShapeshiftForm() ~= 1 then
        CastShapeshiftForm(1);
    end
    return true;
elseif IsModKeyDown(mkRightShift) then
    if useCooldown then
        useCooldown = false;
        ShowMessage("|cffff0000Кулдауны выключены", true);
    else
        useCooldown = true;
        ShowMessage("|cff00ff00Кулдауны включены", true);
    end
elseif IsModKeyDown(mkRightControl) then
elseif IsModKeyDown(mkRightAlt) then
end

-- если в комуфляже или притворились мертвыми или "Слился с тенью"
if HasBuff("player", { 5384, 51755, 58984 }) then
    return true;
end

unitFocus = UnitPower("player");

-- При проке "На изготовку" прерываем чтение "Выстрел кобры"
if not setAoE and UnitCastingInfo("player") == GetSpellInfo(77767) then
    if HasBuff("player", 56453) then
        SpellStopCasting();
    end
end]]></Lua>
      </Ability>
      <Ability Name="Триньки/перчатки">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[-- если персонаж на маунте, тогда не выполняем ротацию дальше
if IsMounted() then
    return true;
end

-- камень здоровья
if HealthByPercent("player") < 30 then
    UseItemById(5512);
end

if useCooldown then
    UseItemBySlot(INVSLOT_HAND);
    UseItemBySlot(INVSLOT_TRINKET1);
    UseItemBySlot(INVSLOT_TRINKET2);
end]]></Lua>
      </Ability>
      <Ability Name="Метание ловушки">
        <SpellID>77769</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if not HasBuff("player", 77769) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Дух ястреба">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if UnitAffectingCombat("player") or IsMounted() then
    if GetShapeshiftForm() ~= 1 and GetShapeshiftFormCooldown(1) == 0 then
        CastShapeshiftForm(1);
        return true;
    end
end]]></Lua>
      </Ability>
      <Ability Name="Дух гепарда">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if not UnitAffectingCombat("player") and not IsMounted() then
    if GetShapeshiftForm() ~= 2 and GetShapeshiftFormCooldown(2) == 0 then
        CastShapeshiftForm(2);
        return true;
    end
end]]></Lua>
      </Ability>
      <Ability Name="Залп">
        <SpellID>2643</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return setAoE;]]></Lua>
      </Ability>
      <Ability Name="Разрывной выстрел">
        <SpellID>53301</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Черная стрела">
        <SpellID>3674</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return not setAoE;]]></Lua>
      </Ability>
      <Ability Name="Бросок глеф">
        <SpellID>117050</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return unitFocus >= 15;]]></Lua>
      </Ability>
      <Ability Name="Звериный натиск">
        <SpellID>121818</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return useCooldown;]]></Lua>
      </Ability>
      <Ability Name="Стая воронов">
        <SpellID>131894</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return useCooldown;]]></Lua>
      </Ability>
      <Ability Name="Ужасный зверь">
        <SpellID>120679</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return useCooldown;]]></Lua>
      </Ability>
      <Ability Name="Чародейский выстрел">
        <SpellID>3044</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if not setAoE and unitFocus > 35 then
    if UnitLevel("player") < 90 then
        return true;
    else
        local cd1 = SpellCD(131894);
        local cd2 = SpellCD(3674);
        if cd1 > 1 and cd2 > 1 then
            return true;
        end
    end
end]]></Lua>
      </Ability>
      <Ability Name="Выстрел кобры">
        <SpellID>77767</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return IsSpellInRange(GetSpellInfo(3044), "target") == 1;]]></Lua>
      </Ability>
      <Ability Name="Змеиная ловушка">
        <SpellID>82948</SpellID>
        <Target>MouseLocation</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return IsModKeyDown(mkLeftShift);]]></Lua>
      </Ability>
      <Ability Name="Взрывная ловушка">
        <SpellID>82939</SpellID>
        <Target>MouseLocation</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return IsModKeyDown(mkLeftShift);]]></Lua>
      </Ability>
      <Ability Name="Ледяная ловушка">
        <SpellID>82941</SpellID>
        <Target>MouseLocation</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return IsModKeyDown(mkRightAlt);]]></Lua>
      </Ability>
      <Ability Name="Замораживающая ловушка">
        <SpellID>60192</SpellID>
        <Target>MouseLocation</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return IsModKeyDown(mkRightControl);]]></Lua>
      </Ability>
      <Ability Name="Быстрая стрельба">
        <SpellID>3045</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return useCooldown;]]></Lua>
      </Ability>
      <Ability Name="Укус змеи">
        <SpellID>1978</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if not setAoE and not HasDebuff("target", 118253, "PLAYER") then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Убийственный выстрел">
        <SpellID>53351</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if UnitLevel("player") >= 35 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Лечение питомца">
        <SpellID>136</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[local pethp = HealthByPercent("pet");
if pethp ~= 0 and pethp < 75 then
    if not HasBuff("pet", 136) then
        return true;
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Верный выстрел">
        <SpellID>56641</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Цель фокуса">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[-- Для фарма репы с пиратами кровавого паруса
-- Если нету цели, берет в цель цель фокуса и стреляет в нее
if not UnitExists("target") or UnitIsDead("target") then
    if UnitAffectingCombat("focus") then
        if UnitIsFriend("player", "focus") then
            RunMacroText("/target focustarget");
            StartAttack("target");
        end
    end
end]]></Lua>
      </Ability>
      <Ability Name="Укус змеи : FARM">
        <SpellID>1978</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[-- 64399 Боевой штандарт координации
UseItemById(64399);

TargetNearestEnemy();
if UnitExists("target") and not UnitIsDeadOrGhost("target") then
    if IsSpellInRange(GetSpellInfo(3044), "target") == 1 then
        StartAttack("target");
        return true;
    end
end]]></Lua>
      </Ability>
      <Ability Name="Выстрел кобры: Farm">
        <SpellID>77767</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[TargetNearestEnemy();
if UnitExists("target") and not UnitIsDeadOrGhost("target") then
    if IsSpellInRange(GetSpellInfo(3044), "target") == 1 then
        StartAttack("target");
        return true;
    end
end]]></Lua>
      </Ability>
    </AbilityList>
    <RotationList>
      <Rotation Name="PVE Выживание" ProcNotifyer="false">
        <HotKey Key="X" Modifier="Alt" />
        <AbilityQueue>
          <string>Инициализация</string>
          <string>Дух ястреба</string>
          <string>Дух гепарда</string>
          <string>Метание ловушки</string>
          <string>Взрывная ловушка</string>
          <string>Ледяная ловушка</string>
          <string>Замораживающая ловушка</string>
          <string>Лечение питомца</string>
          <string>Триньки/перчатки</string>
          <string>Убийственный выстрел</string>
          <string>Залп</string>
          <string>Разрывной выстрел</string>
          <string>Черная стрела</string>
          <string>Укус змеи</string>
          <string>Бросок глеф</string>
          <string>Ужасный зверь</string>
          <string>Быстрая стрельба</string>
          <string>Звериный натиск</string>
          <string>Стая воронов</string>
          <string>Чародейский выстрел</string>
          <string>Выстрел кобры</string>
        </AbilityQueue>
        <Notes><![CDATA[LeftShift - Метание огненной ловушки
LeftControl - включение/выключение AOE
RightControl - Метание замораживающей ловушки
RightAlt - Ледяная ловушка
RightShift - Кулдауны
LeftAlt - Пауза]]></Notes>
      </Rotation>
      <Rotation Name="Повелитель зверей" ProcNotifyer="false">
        <HotKey Key="C" Modifier="Alt" />
        <AbilityQueue />
        <Notes><![CDATA[]]></Notes>
      </Rotation>
      <Rotation Name="Стрельба" ProcNotifyer="false">
        <HotKey Key="V" Modifier="Alt" />
        <AbilityQueue />
        <Notes><![CDATA[]]></Notes>
      </Rotation>
      <Rotation Name="PVE Выживание (прокачка)" ProcNotifyer="false">
        <HotKey Key="Z" Modifier="Alt" />
        <AbilityQueue>
          <string>Инициализация</string>
          <string>Взрывная ловушка</string>
          <string>Ледяная ловушка</string>
          <string>Замораживающая ловушка</string>
          <string>Триньки/перчатки</string>
          <string>Дух ястреба</string>
          <string>Дух гепарда</string>
          <string>Лечение питомца</string>
          <string>Разрывной выстрел</string>
          <string>Убийственный выстрел</string>
          <string>Черная стрела</string>
          <string>Залп</string>
          <string>Укус змеи</string>
          <string>Чародейский выстрел</string>
          <string>Верный выстрел</string>
          <string>Метание ловушки</string>
        </AbilityQueue>
        <Notes><![CDATA[Постепенно надо добавлять способности, либо же сделать проверку на уровень

LeftControl - включение/выключение AOE
RightControl - Метание замораживающей ловушки
LeftAlt - Пауза]]></Notes>
      </Rotation>
      <Rotation Name="Farm" ProcNotifyer="false">
        <HotKey Key="B" Modifier="Alt" />
        <AbilityQueue>
          <string>Укус змеи : FARM</string>
          <string>Выстрел кобры: Farm</string>
        </AbilityQueue>
        <Notes><![CDATA[]]></Notes>
      </Rotation>
    </RotationList>
  </Profile>
  <Profile Class="Rogue">
    <Lua><![CDATA[invisible     = false;
setAoE        = false;
useCooldown   = true;]]></Lua>
    <AbilityList>
      <Ability Name="Инициализаця">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[-- модификатор
if     IsModKeyDown(mkLeftShift) then
elseif IsModKeyDown(mkLeftControl) then
    if setAoE then
        setAoE = false;
        ShowMessage("|cff00ff00 >> Одиночная цель", true);
    else
        setAoE = true;
        ShowMessage("|cffff0000 >> AOE", true);
    end
elseif IsModKeyDown(mkLeftAlt) then
    return true;
elseif IsModKeyDown(mkRightShift) then
    if useCooldown then
        useCooldown = false;
        ShowMessage("|cffff0000Кулдауны выключены", true);
    else
        useCooldown = true;
        ShowMessage("|cff00ff00Кулдауны включены", true);
    end
elseif IsModKeyDown(mkRightControl) then
    if invisible then
        invisible = false;
        ShowMessage("|cffff0000Незаметность выключена", true);
    else
        invisible = true;
        ShowMessage("|cff00ff00Незаметность включена", true);
    end
elseif IsModKeyDown(mkRightAlt) then
end

-- если персонаж на маунте, тогда не выполняем ротацию дальше
if IsMounted() then
    return true;
end

-- камень здоровья
if HealthByPercent("player") < 30 then
    UseItemById(5512);
end

-- Если мы в скрытности, то всегда, если возможно прыгаем в форму незаметности
if GetSpecialization() == 3 then
    if GetShapeshiftForm() ~= 1 then
        local start, duration, enable = GetShapeshiftFormCooldown(1);
        if enable == 1 and start == 0 then
            CastShapeshiftForm(1);
        end
    end
end]]></Lua>
      </Ability>
      <Ability Name="Смертоносный яд">
        <SpellID>2823</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>true</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if not (UnitAffectingCombat("player") or HasBuff("player", 2823) or IsMoving()) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Внезапный удар">
        <SpellID>8676</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if GetShapeshiftForm() == 1 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Нахождение в скрытности">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if GetShapeshiftForm() == 1 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Мясорубка ">
        <SpellID>5171</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[local name, count, rem = HasBuff("player", 5171);

if rem == 0 then
    return true;
end

if UnitExists("target") and GetComboPoints("player", "target") > 4 then
    if rem < 4 then
        return true;
    end
end]]></Lua>
      </Ability>
      <Ability Name="Потрошение">
        <SpellID>2098</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if GetComboPoints("player", "target") > 4 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Пробивающий удар">
        <SpellID>84617</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if not HasDebuff("target", 84617, "PLAYER") then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Коварный удар">
        <SpellID>1752</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Рваная рана">
        <SpellID>1943</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if GetComboPoints("player", "target") > 4 then
    if not HasDebuff("target", 1943, "PLAYER") then
        return true;
    end
end]]></Lua>
      </Ability>
      <Ability Name="Заживление ран">
        <SpellID>73651</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if GetComboPoints("player") > 4 and HealthByPercent("player") < 80 then
    if not HasBuff("target", 73651, "PLAYER") then
        return true;
    end
end]]></Lua>
      </Ability>
      <Ability Name="Обшаривание карманов">
        <SpellID>921</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if not RFrame then

    ALREADY_PICKPOCKETED_TABLE = { };

    RFrame = CreateFrame("Frame");
    RFrame:RegisterEvent("UI_ERROR_MESSAGE");
    RFrame:RegisterEvent("WORLD_MAP_UPDATE");
    RFrame:SetScript("OnEvent",  function(self, event, ...)
        if event == "UI_ERROR_MESSAGE" then
            local msg = ...;
            if  msg == SPELL_FAILED_TARGET_NO_POCKETS or
                msg == ERR_ALREADY_PICKPOCKETED then
                ALREADY_PICKPOCKETED_TABLE[LastTarget] = GetTime();
            end
        elseif event == "WORLD_MAP_UPDATE" then
            ALREADY_PICKPOCKETED_TABLE = { };
        end
    end);
    RFrame:Show();

    function IsPickPocketed(unit)
        local guid = UnitGUID(unit);

        if ALREADY_PICKPOCKETED_TABLE then
            if ALREADY_PICKPOCKETED_TABLE[guid] then
                return true;
            end
        end
    end
end


ClearTarget();
TargetNearestEnemy();

if UnitExists("target") and not IsPickPocketed("target") and not UnitIsDeadOrGhost("target") then
    if IsSpellInRange(GetSpellInfo(921), "target") == 1 then
        return true;
    end
end

ClearTarget();]]></Lua>
      </Ability>
      <Ability Name="Незаметность">
        <SpellID>1784</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if invisible and not UnitAffectingCombat("player") and GetShapeshiftForm() ~= 1 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Веер клинков">
        <SpellID>51723</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if IsModKeyDown(mkLeftShift) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Muti: Отравление">
        <SpellID>32645</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if GetComboPoints("player", "target") >= 4 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Muti: Рсправа">
        <SpellID>1329</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if UnitLevel("player") >= 10 then
    if HealthByPercent("target") > 35 then
        return true;
    end
end]]></Lua>
      </Ability>
      <Ability Name="Muti: Рваная рана">
        <SpellID>1943</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if GetComboPoints("player", "target") > 2 then
    if not HasDebuff("target", 1943, "PLAYER") then
        return true;
    end
end]]></Lua>
      </Ability>
      <Ability Name="Muti: Вендетта">
        <SpellID>79140</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if useCooldown and HasDebuff("target", 1943, "PLAYER") then 
    if select(3, HasBuff("player", 5171)) > 5 then
        return true;
    end
end]]></Lua>
      </Ability>
      <Ability Name="Muti: Устранение">
        <SpellID>111240</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if UnitLevel("player") >= 40 then
    if HasBuff("player", 121152) then -- Слепая зона
        return true;
    elseif HealthByPercent("target") <= 35 then
        return true;
    end 
end]]></Lua>
      </Ability>
      <Ability Name="Muti: Теневые клинки">
        <SpellID>121471</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if useCooldown and HasDebuff("target", 1943, "PLAYER") then 
    if select(3, HasBuff("player", 5171)) > 5 then
        return true;
    end
end]]></Lua>
      </Ability>
    </AbilityList>
    <RotationList>
      <Rotation Name="Бой" ProcNotifyer="false">
        <HotKey Key="Z" Modifier="Alt" />
        <AbilityQueue>
          <string>Инициализаця</string>
          <string>Смертоносный яд</string>
          <string>Веер клинков</string>
          <string>Внезапный удар</string>
          <string>Заживление ран</string>
          <string>Нахождение в скрытности</string>
          <string>Мясорубка </string>
          <string>Пробивающий удар</string>
          <string>Потрошение</string>
          <string>Рваная рана</string>
          <string>Коварный удар</string>
          <string>Незаметность</string>
        </AbilityQueue>
        <Notes><![CDATA[]]></Notes>
      </Rotation>
      <Rotation Name="Ликвидация" ProcNotifyer="false">
        <HotKey Key="X" Modifier="Alt" />
        <AbilityQueue>
          <string>Инициализаця</string>
          <string>Смертоносный яд</string>
          <string>Заживление ран</string>
          <string>Внезапный удар</string>
          <string>Мясорубка </string>
        </AbilityQueue>
        <Notes><![CDATA[]]></Notes>
      </Rotation>
      <Rotation Name="Скрытность" ProcNotifyer="false">
        <HotKey Key="C" Modifier="Alt" />
        <AbilityQueue />
        <Notes><![CDATA[]]></Notes>
      </Rotation>
      <Rotation Name="Фарм ларей" ProcNotifyer="false">
        <HotKey Key="V" Modifier="Alt" />
        <AbilityQueue>
          <string>Обшаривание карманов</string>
        </AbilityQueue>
        <Notes><![CDATA[]]></Notes>
      </Rotation>
    </RotationList>
  </Profile>
  <Profile Class="Priest">
    <Lua><![CDATA[useCooldown = true;
setAoE      = nil;
useAutoDispell = true;]]></Lua>
    <AbilityList>
      <Ability Name="Инициализация (Тьма)">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[-- модификатор
if     IsModKeyDown(mkLeftShift) then
elseif IsModKeyDown(mkLeftControl) then
    if setAoE then
        setAoE = false;
        ShowMessage("|cff00ff00 >> Одиночная цель", true);
    else
        setAoE = true;
        ShowMessage("|cffff0000 >> AOE", true);
    end
elseif IsModKeyDown(mkLeftAlt) then
    return true;
elseif IsModKeyDown(mkRightShift) then
    if useCooldown then
        useCooldown = false;
        ShowMessage("|cffff0000Кулдауны выключены", true);
    else
        useCooldown = true;
        ShowMessage("|cff00ff00Кулдауны включены", true);
    end
elseif IsModKeyDown(mkRightControl) then
elseif IsModKeyDown(mkRightAlt) then

end

-- если персонаж на маунте, тогда не выполняем ротацию дальше
if IsMounted() then
    return true;
end

-- Перейти в форму тьмы
if GetSpecialization() == 3 and GetShapeshiftForm() ~= 1 then
    CastShapeshiftForm(1);
end

-- камень здоровья
if HealthByPercent("player") < 30 then
    UseItemById(5512);
end

isInRange = IsSpellInRange(GetSpellInfo(8092), "target") == 1;
isMoving  = IsMoving();]]></Lua>
      </Ability>
      <Ability Name="Shadow: Слово тьмы: Боль">
        <SpellID>589</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if ability.HasProc then
    return true;
end
local name, count, rem = HasDebuff("target", 589, "PLAYER");
if not name or rem < 2 or isMoving then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Shadow: Слово тьмы: Боль (focus)">
        <SpellID>589</SpellID>
        <Target>Focus</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if ability.HasProc then
    return true;
end
local name, count, rem = HasDebuff("focus", 589, "PLAYER");
if not name or rem < 2 or isMoving then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Shadow: Слово тьмы: Боль (mouseover)">
        <SpellID>589</SpellID>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if ability.HasProc then
    return true;
end
local name, count, rem = HasDebuff("mouseover", 589, "PLAYER");
if not name or rem < 2 or isMoving then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Shadow: Прикосновение вампира (target)">
        <SpellID>34914</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>true</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if not isMoving then
    if ability.HasProc then
        return true;
    end
    local name, count, rem = HasDebuff("target", 34914, "PLAYER");
    if not name or rem < 2 then
        return true;
    end
end]]></Lua>
      </Ability>
      <Ability Name="Shadow: Прикосновение вампира (Focus)">
        <SpellID>34914</SpellID>
        <Target>Focus</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>true</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if not isMoving then
    if ability.HasProc then
        return true;
    end
    local name, count, rem = HasDebuff("focus", 34914, "PLAYER");
    if not name or rem < 2 then
        return true;
    end
end]]></Lua>
      </Ability>
      <Ability Name="Shadow: Прикосновение вампира (Mouseover)">
        <SpellID>34914</SpellID>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>true</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if not isMoving then
    if ability.HasProc then
        return true;
    end
    local name, count, rem = HasDebuff("mouseover", 34914, "PLAYER");
    if not name or rem < 2 then
        return true;
    end
end]]></Lua>
      </Ability>
      <Ability Name="Shadow: Взрыв разума">
        <SpellID>8092</SpellID>
        <Target>Target</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Shadow: Пытка разума">
        <SpellID>15407</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return isInRange;]]></Lua>
      </Ability>
      <Ability Name="Shadow: Всепожирающая чума">
        <SpellID>2944</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if UnitPower("player", SPELL_POWER_SHADOW_ORBS) >= 3 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Shadow: Искушение разума">
        <SpellID>48045</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return setAoE;]]></Lua>
      </Ability>
      <Ability Name="Shadow: Слово Тьмы: Смерть (Target)">
        <SpellID>32379</SpellID>
        <Target>Target</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return HealthByPercent("target") < 20;]]></Lua>
      </Ability>
      <Ability Name="Shadow: Слово Тьмы: Смерть (Focus)">
        <SpellID>32379</SpellID>
        <Target>Focus</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return HealthByPercent("focus") < 20;]]></Lua>
      </Ability>
      <Ability Name="Shadow: Слово Тьмы: Смерть (Mouseover)">
        <SpellID>32379</SpellID>
        <Target>Mouseover</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return HealthByPercent("mouseover") < 20;]]></Lua>
      </Ability>
      <Ability Name="Shadow: Пронзание разума">
        <SpellID>73510</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if HasBuff("player", 87160) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Shadow: Сияние">
        <SpellID>120517</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Shadow: Исчадие тьмы">
        <SpellID>34433</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return useCooldown;]]></Lua>
      </Ability>
      <Ability Name="Инициализация (Послушание)">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[-- модификатор
if     IsModKeyDown(mkLeftShift) then
    return true;
elseif IsModKeyDown(mkLeftControl) then
elseif IsModKeyDown(mkLeftAlt) then
elseif IsModKeyDown(mkRightShift) then
    if useCooldown then
        useCooldown = false;
        ShowMessage("|cffff0000Кулдауны выключены", true);
    else
        useCooldown = true;
        ShowMessage("|cff00ff00Кулдауны включены", true);
    end
elseif IsModKeyDown(mkRightControl) then
elseif IsModKeyDown(mkRightAlt) then
    if useAutoDispell then
        useAutoDispell = false;
        ShowMessage("|cffff0000Диспел по mouseover: Выключен", true);
    else
        useAutoDispell = true;
        ShowMessage("|cff00ff00Диспел по mouseover: Включен", true);
    end
end

-- если персонаж на маунте, тогда не выполняем ротацию дальше
if IsMounted() then
    return true;
end

FillPartyTables(2061);

isInRange = IsSpellInRange(GetSpellInfo(8092), "target") == 1;
isMoving  = IsMoving();
myMana    = PowerByPercent("player", SPELL_POWER_MANA);

if myMana < 75 then
    --UseItemBySlot(INVSLOT_TRINKET1);
    UseItemBySlot(INVSLOT_TRINKET2);
end

-- камень здоровья
if HealthByPercent("player") < 30 then
    UseItemById(5512);
end]]></Lua>
      </Ability>
      <Ability Name="Disc: Массовое разсеивание">
        <SpellID>32375</SpellID>
        <Target>MouseLocation</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[return IsModKeyDown(mkLeftAlt);]]></Lua>
      </Ability>
      <Ability Name="Disc: Разсеивание заклинаний (Авто)">
        <SpellID>527</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if useAutoDispell then
    return GetDispellInfo();
end]]></Lua>
      </Ability>
      <Ability Name="Disc: Придание сил">
        <SpellID>10060</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return LowHP.H50 > 3;]]></Lua>
      </Ability>
      <Ability Name="Disc: Исповедь">
        <SpellID>47540</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Disc: Священный огонь">
        <SpellID>14914</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Disc: Кара">
        <SpellID>585</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Disc: Подавление боли">
        <SpellID>33206</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>true</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if useCooldown and members[1].HP < 30 then
    return members[1].Unit;
end]]></Lua>
      </Ability>
      <Ability Name="Disc: Подчиняющий разум">
        <SpellID>123040</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if myMana < 80 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Disc: Слово силы: Барьер">
        <SpellID>62618</SpellID>
        <Target>MouseLocation</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>true</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if IsModKeyDown(mkLeftControl) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Disc: Молитва восстановления">
        <SpellID>33076</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if LowHP.H90 > 2 and members[1].HP < 85 then
   return members[1].Unit;
end]]></Lua>
      </Ability>
      <Ability Name="Disc: Молитва Исцеления">
        <SpellID>596</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[-- Если активен щит души, тогда настакиваем щит
if LowHP.H70 > 3 or HasBuff("player", 114908, "PLAYER") then
    return members[1].Unit;
end]]></Lua>
      </Ability>
      <Ability Name="Disc: Обновление">
        <SpellID>139</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[for _,member in ipairs(members) do
   if (member.IsTank and member.HP < 90) or member.HP < 70 then
       if not HasBuff(member.Unit, 139, "PLAYER") then
           return member.Unit;
       end
   end
end]]></Lua>
      </Ability>
      <Ability Name="Disc: Слово силы: Щит">
        <SpellID>17</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[-- Ослабленная душа (6788)
for _,member in ipairs(members) do
    if not HasDebuff(member.Unit, 6788) then
        if member.Agro > 2 or (isMoving and member.HP < 70) or member.HP < 50 then
            return member.Unit;
        end
    end
end]]></Lua>
      </Ability>
      <Ability Name="Disc: Исцеление">
        <SpellID>2050</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[if UnitCanAttack("player", "target") ~= 1 then
    if members[1].HP < 90 then
        return members[1].Unit;
    end
end]]></Lua>
      </Ability>
      <Ability Name="Disc: Быстрое исцеление">
        <SpellID>2061</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[if members[1].HP < 40 then
    return members[1].Unit;
end]]></Lua>
      </Ability>
      <Ability Name="Disc: Великое исцеление">
        <SpellID>2060</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[if members[1].HP < 60 then
    return members[1].Unit;
end]]></Lua>
      </Ability>
      <Ability Name="Disc: Слово тьмы: Боль">
        <SpellID>589</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if select(3, HasDebuff("target", 589, "PLAYER")) < 2 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Disc: Вхождение в бездну">
        <SpellID>108968</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>true</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if useCooldown and members[1].HP < 20 and HealthByPercent("player") > 95 then
    return members[1].Unit;
end]]></Lua>
      </Ability>
      <Ability Name="Disc: Архангел">
        <SpellID>81700</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>true</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return LowHP.H70 > 3;]]></Lua>
      </Ability>
      <Ability Name="Disc: Каскад">
        <SpellID>120785</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if (isMoving and LowHP.H80 > 3) or LowHP.H70 > 3 then
    return members[1].Unit;
end]]></Lua>
      </Ability>
    </AbilityList>
    <RotationList>
      <Rotation Name="Послушание" ProcNotifyer="false">
        <HotKey Key="C" Modifier="Alt" />
        <AbilityQueue>
          <string>Инициализация (Послушание)</string>
          <string>Disc: Массовое разсеивание</string>
          <string>Disc: Слово силы: Барьер</string>
          <string>Disc: Разсеивание заклинаний (Mouseover)</string>
          <string>Disc: Разсеивание заклинаний (Авто)</string>
          <string>Disc: Вхождение в бездну</string>
          <string>Disc: Подавление боли</string>
          <string>Disc: Подчиняющий разум</string>
          <string>Disc: Придание сил</string>
          <string>Disc: Архангел</string>
          <string>Disc: Каскад</string>
          <string>Disc: Слово силы: Щит</string>
          <string>Disc: Быстрое исцеление</string>
          <string>Disc: Молитва восстановления</string>
          <string>Disc: Молитва Исцеления</string>
          <string>Disc: Великое исцеление</string>
          <string>Disc: Обновление</string>
          <string>Disc: Исцеление</string>
          <string>Disc: Исповедь</string>
          <string>Disc: Священный огонь</string>
          <string>Shadow: Слово Тьмы: Смерть (Target)</string>
          <string>Disc: Слово тьмы: Боль</string>
          <string>Disc: Кара</string>
        </AbilityQueue>
        <Notes><![CDATA[LeftShift - Пауза
RightAlt - Диспел по mouseover
RightShift - Кулдауны
LeftControl - Слово силы: Барьер
LeftAlt - Массовое разсеивание]]></Notes>
      </Rotation>
      <Rotation Name="Свет" ProcNotifyer="false">
        <HotKey Key="Z" Modifier="Alt" />
        <AbilityQueue />
        <Notes><![CDATA[]]></Notes>
      </Rotation>
      <Rotation Name="Тьма" ProcNotifyer="true">
        <HotKey Key="X" Modifier="Alt" />
        <AbilityQueue>
          <string>Инициализация (Тьма)</string>
          <string>Disc: Массовое разсеивание</string>
          <string>Shadow: Искушение разума</string>
          <string>Shadow: Слово Тьмы: Смерть (Target)</string>
          <string>Shadow: Слово Тьмы: Смерть (Focus)</string>
          <string>Shadow: Слово Тьмы: Смерть (Mouseover)</string>
          <string>Shadow: Всепожирающая чума</string>
          <string>Shadow: Взрыв разума</string>
          <string>Shadow: Сияние</string>
          <string>Shadow: Исчадие тьмы</string>
          <string>Shadow: Пронзание разума</string>
          <string>Shadow: Слово тьмы: Боль</string>
          <string>Shadow: Слово тьмы: Боль (focus)</string>
          <string>Shadow: Слово тьмы: Боль (mouseover)</string>
          <string>Shadow: Прикосновение вампира (target)</string>
          <string>Shadow: Прикосновение вампира (Focus)</string>
          <string>Shadow: Прикосновение вампира (Mouseover)</string>
          <string>Shadow: Пытка разума</string>
        </AbilityQueue>
        <Notes><![CDATA[]]></Notes>
      </Rotation>
    </RotationList>
  </Profile>
  <Profile Class="DeathKnight">
    <Lua><![CDATA[-- 1 - Blood rune
-- 2 - Unholy rune
-- 3 - Frost rune
-- 4 - Death rune

useCooldown     = true;
setAoE          = nil;
isAltMod        = nil;
rune_names = { "Blood", "Unholy", "Frost", "Death" };

function FillRunesInfo()
    runes = {
        Blood  = { Rem = 0, Count = 0 },
        Unholy = { Rem = 0, Count = 0 },
        Frost  = { Rem = 0, Count = 0 },
        Death  = { Rem = 0, Count = 0 },
        Power  = 0,
    };

    runes.Power = UnitPower("player");--, SPELL_POWER_RUNIC_POWER);
    
    for slot = 1, 6 do
        local runeType        = GetRuneType(slot);
        local start, duration = GetRuneCooldown(slot);
        local rune_name = rune_names[runeType];
 
        runes[rune_name].Rem   = (start + duration) - GetTime();
        runes[rune_name].Count = GetRuneCount(slot);
    end    
end]]></Lua>
    <AbilityList>
      <Ability Name="Инициализация">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[-- модификатор
if     IsModKeyDown(mkLeftShift) then
elseif IsModKeyDown(mkLeftControl) then
    if setAoE then
        setAoE = false;
        print("|cff00ff00 >> Одиночная цель");
    else
        setAoE = true;
        print("|cffff0000 >> AOE");
    end
elseif IsModKeyDown(mkLeftAlt) then
    return true;
elseif IsModKeyDown(mkRightShift) then
    if useCooldown then
        useCooldown = false;
        print("|cffff0000Кулдауны выключены");
    else
        useCooldown = true;
        print("|cff00ff00Кулдауны включены");
    end
elseif IsModKeyDown(mkRightControl) then
elseif IsModKeyDown(mkRightAlt)     then
end

-- если персонаж на маунте, тогда не выполняем ротацию дальше
if IsMounted() then
    return true;
end

-- Перейти в стойку защиты
if     GetSpecialization() == 1 and GetShapeshiftForm() ~= 1 then
    CastShapeshiftForm(1); -- blood
elseif GetSpecialization() == 2 and GetShapeshiftForm() ~= 2 then
    CastShapeshiftForm(2); -- frost
elseif GetSpecialization() == 3 and GetShapeshiftForm() ~= 3 then
    CastShapeshiftForm(3); -- unholly
end

FillRunesInfo();

-- камень здоровья
if HealthByPercent("player") < 30 then
    UseItemById(5512);
end

isInMeele  = IsSpellInRange(GetSpellInfo(49998), "target") == 1;
agroStatus = UnitThreatSituation("player");
playerHP   = HealthByPercent("player");
]]></Lua>
      </Ability>
      <Ability Name="Смерть и разложение">
        <SpellID>43265</SpellID>
        <Target>MouseLocation</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return IsModKeyDown(mkLeftShift);]]></Lua>
      </Ability>
      <Ability Name="Кровь вампира">
        <SpellID>55233</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if playerHP < 30 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Костяной щит">
        <SpellID>49222</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if not HasBuff("player", 49222) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Незыблемость льда">
        <SpellID>48792</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if useCooldown and playerHP <= 40 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Захват рун">
        <SpellID>48982</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if agroStatus == 3 and playerHP < 90 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Танцующее руническое оружие">
        <SpellID>49028</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return useCooldown;]]></Lua>
      </Ability>
      <Ability Name="Вспышка болезни">
        <SpellID>77575</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if not HasBuff("target", 59879, "PLAYER") and not HasBuff("target", 59921, "PLAYER") then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Удар чумы">
        <SpellID>45462</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if not UnitDebuff("target", 59879) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Ледяное прикосновение">
        <SpellID>45477</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if not UnitDebuff("target", 59921) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Жнец душ">
        <SpellID>114866</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Кровоотвод">
        <SpellID>45529</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[-- if=(unholy=0&frost>=1)|(unholy>=1&frost=0)|(death=1)
if (runes.Unholy.Count == 0 and runes.Frost.Count >= 1) 
or (runes.Unholy.Count >= 1 and runes.Frost.Count == 0) 
or runes.Death.Count == 1 then
    if (select(2, HasBuff("player", 114851)) or 0) >= 5 then
        return true;
    end
end]]></Lua>
      </Ability>
      <Ability Name="Удар смерти">
        <SpellID>49998</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Вскипание крови">
        <SpellID>48721</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if isInMeele and runes.Blood.Count > 0 or HasBuff("player", 81141) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Удар в сердце">
        <SpellID>55050</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[-- if=(blood=1&blood.cooldown_remains<1)|blood=2
if isInMeele and (runes.Blood.Count == 1 and runes.Blood.Rem < 1) or runes.Blood.Count == 2 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Рунический удар">
        <SpellID>56815</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if UnitPower("player") > 40 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Зимний горн">
        <SpellID>57330</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if UnitPower("player") < 70 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Усиление рунического оружия">
        <SpellID>47568</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if useCooldown and runes.Blood.Count == 0 and runes.Unholy.Count == 0 and runes.Frost.Count == 0 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Frost: Вытягивание чумы (1)">
        <SpellID>123693</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Frost: Вспышка болезни (1)">
        <SpellID>77575</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Frost: Нечестивая порча (1)">
        <SpellID>115989</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Frost: Жнец душ">
        <SpellID>130736</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Frost: Кровоотвод (1)">
        <SpellID>45529</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Frost: Воющий ветер (1)">
        <SpellID>49184</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Frost: Удар чумы">
        <SpellID>45462</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Frost: Воющий ветер (2)">
        <SpellID>49184</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Frost: Уничтожение (1)">
        <SpellID>49020</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Frost: Кровоотвод (2)">
        <SpellID>45529</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Frost: Ледяной удар (1)">
        <SpellID>49143</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Frost: Уничтожение (2)">
        <SpellID>49020</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Frost: Вытягивание чумы (2)">
        <SpellID>123693</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Frost: Вспышка болезни (2)">
        <SpellID>77575</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Frost: Нечестивая порча (2)">
        <SpellID>115989</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Frost: Ледяной удар (2)">
        <SpellID>49143</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Frost: Зимний горн">
        <SpellID>57330</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Frost: Ледяной удар (3)">
        <SpellID>49143</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Frost: Уничтожение (3)">
        <SpellID>49020</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Frost: Усиление рунического оружия">
        <SpellID>47568</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Frost: Кровоотвод (3)">
        <SpellID>45529</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Frost: Ледяной удар (4)">
        <SpellID>49143</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Frost: Вытягивание чумы (3)">
        <SpellID>123693</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Frost: Усиление рунического оружия (2)">
        <SpellID>47568</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
    </AbilityList>
    <RotationList>
      <Rotation Name="Кровь" ProcNotifyer="false">
        <HotKey Key="X" Modifier="Alt" />
        <AbilityQueue>
          <string>Инициализация</string>
          <string>Смерть и разложение</string>
          <string>Кровь вампира</string>
          <string>Костяной щит</string>
          <string>Незыблемость льда</string>
          <string>Захват рун</string>
          <string>Танцующее руническое оружие</string>
          <string>Вспышка болезни</string>
          <string>Удар чумы</string>
          <string>Ледяное прикосновение</string>
          <string>Жнец душ</string>
          <string>Кровоотвод</string>
          <string>Удар смерти</string>
          <string>Вскипание крови</string>
          <string>Удар в сердце</string>
          <string>Рунический удар</string>
          <string>Зимний горн</string>
          <string>Усиление рунического оружия</string>
        </AbilityQueue>
        <Notes><![CDATA[Left Shift - Смерть и разложение
Left Alt - Пауза
Right Shift - Кулдауны]]></Notes>
      </Rotation>
      <Rotation Name="Лед" ProcNotifyer="false">
        <HotKey Key="Z" Modifier="Alt" />
        <AbilityQueue>
          <string>Frost: Вытягивание чумы (1)</string>
          <string>Frost: Вспышка болезни (1)</string>
          <string>Frost: Нечестивая порча (1)</string>
          <string>Frost: Жнец душ</string>
          <string>Frost: Кровоотвод (1)</string>
          <string>Frost: Воющий ветер (1)</string>
          <string>Frost: Удар чумы</string>
          <string>Frost: Воющий ветер (2)</string>
          <string>Frost: Уничтожение (1)</string>
          <string>Frost: Кровоотвод (2)</string>
          <string>Frost: Ледяной удар (1)</string>
          <string>Frost: Уничтожение (2)</string>
          <string>Frost: Вытягивание чумы (2)</string>
          <string>Frost: Вспышка болезни (2)</string>
          <string>Frost: Нечестивая порча (2)</string>
          <string>Frost: Ледяной удар (2)</string>
          <string>Frost: Зимний горн</string>
          <string>Frost: Ледяной удар (3)</string>
          <string>Frost: Уничтожение (3)</string>
          <string>Frost: Усиление рунического оружия</string>
          <string>Frost: Кровоотвод (3)</string>
          <string>Frost: Ледяной удар (4)</string>
          <string>Frost: Вытягивание чумы (3)</string>
          <string>Frost: Усиление рунического оружия (2)</string>
        </AbilityQueue>
        <Notes><![CDATA[]]></Notes>
      </Rotation>
      <Rotation Name="Нечестивость" ProcNotifyer="false">
        <HotKey Key="C" Modifier="Alt" />
        <AbilityQueue />
        <Notes><![CDATA[]]></Notes>
      </Rotation>
    </RotationList>
  </Profile>
  <Profile Class="Shaman">
    <Lua><![CDATA[]]></Lua>
    <AbilityList>
      <Ability Name="Инициализация Стихии">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[-- модификатор
if     IsModKeyDown(mkLeftShift) then
elseif IsModKeyDown(mkLeftControl) then
    if setAoE then
        setAoE = false;
        print("|cff00ff00 >> Одиночная цель");
    else
        setAoE = true;
        print("|cffff0000 >> AOE");
    end
elseif IsModKeyDown(mkLeftAlt) then
    return true;
elseif IsModKeyDown(mkRightShift) then
    if useCooldown then
        useCooldown = false;
        print("|cffff0000Кулдауны выключены");
    else
        useCooldown = true;
        print("|cff00ff00Кулдауны включены");
    end
elseif IsModKeyDown(mkRightControl) then
    if useAutoDispell then
        useAutoDispell = false;
        ShowMessage("|cffff0000Автодиспел выключен", true);
    else
        useAutoDispell = true;
        ShowMessage("|cff00ff00Автодиспел включен", true);
    end
elseif IsModKeyDown(mkRightAlt)     then
end

-- если персонаж на маунте, тогда не выполняем ротацию дальше
if IsMounted() then
    return true;
end

-- камень здоровья
if HealthByPercent("player") < 30 then
    UseItemById(5512);
end

FillPartyTables(331);]]></Lua>
      </Ability>
      <Ability Name="Опаляющий тотем">
        <SpellID>3599</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if not GetTotemInfo(1) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Огненный шок">
        <SpellID>8050</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if not HasDebuff("target", 8050, "PLAYER") then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Земной шок">
        <SpellID>8042</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if (select(2, HasBuff("player", 324)) or 0) == 7 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="молния">
        <SpellID>403</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Исцеляющий всплеск">
        <SpellID>8004</SpellID>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if UnitIsFriend("player", "mouseover") then
    if HealthByPercent("mouseover") < 50 then
        return true;
    end
end]]></Lua>
      </Ability>
      <Ability Name="Цепная молния">
        <SpellID>421</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return setAoE;]]></Lua>
      </Ability>
      <Ability Name="Restor: Дух предков">
        <SpellID>2008</SpellID>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[if UnitIsDead("mouseover") and not UnitAffectingCombat("player") and UnitIsPlayer("mouseover") then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Restor: Щит земли">
        <SpellID>974</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[for _,member in ipairs(members) do
    if member.Agro > 2 and member.IsTank then
        if select(3, HasBuff(member.Unit, 974, "PLAYER")) > 10 then
            return;
        end
    end
end

-- Накладываем щит земли на танка с агро
for _,member in ipairs(members) do
    if member.Agro > 2 and member.IsTank then
        return member.Unit;
    end
end]]></Lua>
      </Ability>
      <Ability Name="Restor: Быстрина">
        <SpellID>61295</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[for _,member in ipairs(members) do
    if member.HP < 70 or (member.IsTank and member.Agro > 2)then
        if not HasBuff(member.Unit, 61295, "PLAYER") then
            return member.Unit;
        end
    end
end]]></Lua>
      </Ability>
      <Ability Name="Restor: Волна исцеления">
        <SpellID>331</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[if members[1].HP < 70 then
    return members[1].Unit;
end]]></Lua>
      </Ability>
      <Ability Name="Restor: Исцелающий всплеск">
        <SpellID>8004</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[if members[1].HP < 70 then
    return members[1].Unit;
end]]></Lua>
      </Ability>
      <Ability Name="Restor: Тотем исцеляющего потока">
        <SpellID>5394</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if not GetTotemInfo(3) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Restor: Водяной щит">
        <SpellID>52127</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if not HasBuff("player", 52127) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Restor: Очищение духа">
        <SpellID>77130</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if useAutoDispell then
    return GetDispellInfo();
end]]></Lua>
      </Ability>
    </AbilityList>
    <RotationList>
      <Rotation Name="Стихии" ProcNotifyer="false">
        <HotKey Key="X" Modifier="Alt" />
        <AbilityQueue>
          <string>Инициализация Стихии</string>
          <string>Исцеляющий всплеск</string>
          <string>Опаляющий тотем</string>
          <string>Земной шок</string>
          <string>Цепная молния</string>
          <string>Огненный шок</string>
          <string>молния</string>
        </AbilityQueue>
        <Notes><![CDATA[]]></Notes>
      </Rotation>
      <Rotation Name="Совершенствование" ProcNotifyer="false">
        <HotKey Key="Z" Modifier="Alt" />
        <AbilityQueue />
        <Notes><![CDATA[]]></Notes>
      </Rotation>
      <Rotation Name="Исцеление" ProcNotifyer="false">
        <HotKey Key="C" Modifier="Alt" />
        <AbilityQueue>
          <string>Инициализация Стихии</string>
          <string>Restor: Водяной щит</string>
          <string>Restor: Щит земли</string>
          <string>Restor: Быстрина</string>
          <string>Restor: Исцелающий всплеск</string>
          <string>Restor: Волна исцеления</string>
          <string>Restor: Тотем исцеляющего потока</string>
          <string>Restor: Дух предков</string>
        </AbilityQueue>
        <Notes><![CDATA[]]></Notes>
      </Rotation>
    </RotationList>
  </Profile>
  <Profile Class="Mage">
    <Lua><![CDATA[useCooldown  = true;
setAoE       = nil;

igniteDamage = 0;       -- Урон от тика доты Воспламенение (12654)
pyroDamage   = 0;       -- Урон от заклинания Огненная глыба (11366)
pyroCrit     = false;   -- Было ли заклинание Огненная глыба (11366) критическим

function OnEventExtended (self, event, ...)
--print("AddonFrame_OnEvent")
    if event == "COMBAT_LOG_EVENT_UNFILTERED" then
        -- для начала приведу полный список параметров.
        local timestamp, subEvent, hideCaster,
              sourceGUID,srcName,  sourceFlags,sourceFlags2,
              destGUID,  destName, destFlags,  destFlags2,
              spellId,   spellName,spellSchool,amount,      overkill,school,
              resisted,  blocked,  absorbed,   critical,    glancing,crushing = ...;

        if subEvent == "SPELL_PERIODIC_DAMAGE" then
            if UnitGUID("player") == sourceGUID and destGUID == UnitGUID("target") then
                -- Воспламенение
                if spellId == 12654 then
                    igniteDamage = amount;
                    --print("Тик: Воспламенение (12654) - "..tostring(amount));
                end
            end
        end

        if subEvent == "SPELL_DAMAGE" then
            if UnitName("player") == srcName and destName == UnitName("target") then
                -- Огненная глыба
                if spellId == 11366 then
                    pyroDamage = amount;
                    pyroCrit   = critical;
                    --print("Урон: "..tostring(critical).." Огненная глыба (11366) - "..tostring(amount));
                end
            end
        end
    end
end]]></Lua>
    <AbilityList>
      <Ability Name="Инициализация(Огонь)">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[-- модификатор
if     IsModKeyDown(mkLeftShift) then
elseif IsModKeyDown(mkLeftControl) then
    if setAoE then
        setAoE = false;
        print("|cff00ff00 >> Одиночная цель");
    else
        setAoE = true;
        print("|cffff0000 >> AOE");
    end
elseif IsModKeyDown(mkLeftAlt) then
    return true;
elseif IsModKeyDown(mkRightShift) then
    if useCooldown then
        useCooldown = false;
        print("|cffff0000Кулдауны выключены");
    else
        useCooldown = true;
        print("|cff00ff00Кулдауны включены");
    end
elseif IsModKeyDown(mkRightControl) then
elseif IsModKeyDown(mkRightAlt) then
end

isInRange = IsSpellInRange(GetSpellInfo(133), "target") == 1;
isMoving  = IsMoving();

-- камень здоровья
if HealthByPercent("player") < 30 then
    UseItemById(5512);
end]]></Lua>
      </Ability>
      <Ability Name="Использование предметов">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
-- если персонаж на маунте, тогда не выполняем ротацию дальше
if IsMounted() then
    return true;
end

if useCooldown then
    UseItemBySlot(INVSLOT_HAND);
    UseItemBySlot(INVSLOT_TRINKET1);
    UseItemBySlot(INVSLOT_TRINKET1);
end]]></Lua>
      </Ability>
      <Ability Name="Fire: Живая бомба (Target)">
        <SpellID>44457</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if isInRange and not HasDebuff("target", 44457, "PLAYER") then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Fire: Живая бомба (Focus)">
        <SpellID>44457</SpellID>
        <Target>Focus</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if not HasDebuff("focus", 44457, "PLAYER") then
    if IsSpellInRange(GetSpellInfo(133), "focus") == 1 then
        return true;
    end
end]]></Lua>
      </Ability>
      <Ability Name="Fire: Живая бомба (Mouseover)">
        <SpellID>44457</SpellID>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if not HasDebuff("mouseover", 44457, "PLAYER") then
    if IsSpellInRange(GetSpellInfo(133), "mouseover") == 1 then
        return true;
    end
end]]></Lua>
      </Ability>
      <Ability Name="Fire: Огненная глыба">
        <SpellID>11366</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[-- Огненная глыба! (48108)
if HasBuff("player", 48108) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Fire: Пламенный взрыв">
        <SpellID>108853</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>true</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[-- При крите огненного шара и получения баффа Разогрев (48107) делаем каст Пламенный взрыв (108853).
-- Скорее всего вы увидите каст бафф разогрева после того как начнете следующий каст Огненного шара (133),
-- поэтому важно сразу после окончания каста использовать Пламенный взрыв (108853),
-- чтобы следующий Огненный шар (133) не успел и долететь до цели и сбить бафф, если вдруг не критонет.

if isInRange or HasBuff("player", 48107) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Fire: Огненный шар">
        <SpellID>133</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Fire: Ожoг">
        <SpellID>2948</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>Moving</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Fire: Возгорание">
        <SpellID>11129</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[-- Вешаем возгорание только после крита Огненной бомбы (и/или) наличия сильной доты.
-- Будем тестировать, позже.
-- это пробная версия.

-- Надо в ручную определить это значение.
-- вычислением пиковой/средней величины.
local MAX_DOTE_IGNITE = 5000;
--print(pyroCrit ,igniteDamage)
if useCooldown and pyroCrit and igniteDamage > MAX_DOTE_IGNITE then
    if select(3, HasDebuff("target", 12654, "PLAYER")) > 3 then
        return true;
    end
end]]></Lua>
      </Ability>
      <Ability Name="Fire: Огненный столб">
        <SpellID>2120</SpellID>
        <Target>MouseLocation</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if IsModKeyDown(mkLeftShift) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Инициализация (Лед)">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[-- модификатор
if     IsModKeyDown(mkLeftShift) then
elseif IsModKeyDown(mkLeftControl) then
    if setAoE then
        setAoE = false;
        print("|cff00ff00 >> Одиночная цель");
    else
        setAoE = true;
        print("|cffff0000 >> AOE");
    end
elseif IsModKeyDown(mkLeftAlt) then
    return true;
elseif IsModKeyDown(mkRightShift) then
    if useCooldown then
        useCooldown = false;
        print("|cffff0000Кулдауны выключены");
    else
        useCooldown = true;
        print("|cff00ff00Кулдауны включены");
    end
elseif IsModKeyDown(mkRightControl) then
elseif IsModKeyDown(mkRightAlt) then
end

if IsMounted() or HasBuff("player", 87959) then
    return true;
end

isInRange = IsSpellInRange(GetSpellInfo(116), "target") == 1;
isMoving  = IsMoving();

-- камень здоровья
if HealthByPercent("player") < 30 then
    UseItemById(5512);
end]]></Lua>
      </Ability>
      <Ability Name="Frost: Ледяная преграда">
        <SpellID>11426</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if not HasBuff("player", 11426) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Frost: Снежная Буря">
        <SpellID>10</SpellID>
        <Target>MouseLocation</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if IsModKeyDown(mkLeftShift) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Frost: Живая бомба">
        <SpellID>44457</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if not HasDebuff("target", 44457, "PLAYER") then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Frost: Ледяной шар">
        <SpellID>84714</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Frost: Стрела ледяного огня">
        <SpellID>44614</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if HasBuff("player", 44549) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Frost: Ледяное копье">
        <SpellID>30455</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if HasBuff("player", 112965) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Frost: Ледяная стрела">
        <SpellID>116</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
    </AbilityList>
    <RotationList>
      <Rotation Name="Огонь" ProcNotifyer="false">
        <HotKey Key="Z" Modifier="Alt" />
        <AbilityQueue>
          <string>Инициализация(Огонь)</string>
          <string>Использование предметов</string>
          <string>Fire: Огненный столб</string>
          <string>Fire: Возгорание</string>
          <string>Fire: Живая бомба (Target)</string>
          <string>Fire: Живая бомба (Focus)</string>
          <string>Fire: Живая бомба (Mouseover)</string>
          <string>Fire: Огненная глыба</string>
          <string>Fire: Пламенный взрыв</string>
          <string>Fire: Ожoг</string>
          <string>Fire: Огненный шар</string>
        </AbilityQueue>
        <Notes><![CDATA[]]></Notes>
      </Rotation>
      <Rotation Name="Лед" ProcNotifyer="false">
        <HotKey Key="X" Modifier="Alt" />
        <AbilityQueue>
          <string>Инициализация (Лед)</string>
          <string>Frost: Снежная Буря</string>
          <string>Frost: Ледяная преграда</string>
          <string>Frost: Живая бомба</string>
          <string>Frost: Ледяной шар</string>
          <string>Frost: Стрела ледяного огня</string>
          <string>Frost: Ледяное копье</string>
          <string>Frost: Ледяная стрела</string>
        </AbilityQueue>
        <Notes><![CDATA[]]></Notes>
      </Rotation>
      <Rotation Name="Тайная магия" ProcNotifyer="false">
        <HotKey Key="C" Modifier="Alt" />
        <AbilityQueue />
        <Notes><![CDATA[]]></Notes>
      </Rotation>
    </RotationList>
  </Profile>
  <Profile Class="Warlock">
    <Lua><![CDATA[]]></Lua>
    <AbilityList>
      <Ability Name="Инициализация">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[-- модификатор
if     IsModKeyDown(mkLeftShift) then
elseif IsModKeyDown(mkLeftControl) then
    if setAoE then
        setAoE = false;
        print("|cff00ff00 >> Одиночная цель");
    else
        setAoE = true;
        print("|cffff0000 >> AOE");
    end
elseif IsModKeyDown(mkLeftAlt) then
    return true;
elseif IsModKeyDown(mkRightShift) then
    if useCooldown then
        useCooldown = false;
        print("|cffff0000Кулдауны выключены");
    else
        useCooldown = true;
        print("|cff00ff00Кулдауны включены");
    end
elseif IsModKeyDown(mkRightControl) then
elseif IsModKeyDown(mkRightAlt) then
end

isInRange = IsSpellInRange(GetSpellInfo(172), "target") == 1;
isMoving  = IsMoving();

if IsMounted() then
    return true;
end

power2 = 0;
if GetSpecialization() == 1 then     -- aflyction
    power2 = UnitPower("player", SPELL_POWER_SOUL_SHARDS);
elseif GetSpecialization() == 2 then -- demonology
    power2 = UnitPower("player", SPELL_POWER_DEMONIC_FURY);
    if power2 < 100 or select(3, HasDebuff("target", 172, "PLAYER")) < 2 then
        CancelShapeshiftForm();
    end
elseif GetSpecialization() == 3 then -- dectruction
    power2 = UnitPower("player", SPELL_POWER_BURNING_EMBERS);
end

-- камень здоровья
if HealthByPercent("player") < 30 then
    UseItemById(5512);
end]]></Lua>
      </Ability>
      <Ability Name="Demo: Метаморфоза">
        <SpellID>103958</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if GetShapeshiftForm() ~= 1 and power2 > 150 then
    if power2 > 990 or select(3, HasDebuff("target", 603, "PLAYER")) < 2 then
        return true;
    end
end]]></Lua>
      </Ability>
      <Ability Name="Demo: Порча (Target)">
        <SpellID>172</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if GetShapeshiftForm() ~= 1 then
    if ability.HasProc or select(3, HasDebuff("target", 172, "PLAYER")) < 2 then
        return true;
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Demo: Порча (Focus)">
        <SpellID>172</SpellID>
        <Target>Focus</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if GetShapeshiftForm() ~= 1 then
    if ability.HasProc or select(3, HasDebuff("focus", 172, "PLAYER")) < 2 then
        return true;
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Demo: Порча (Mouseover)">
        <SpellID>172</SpellID>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if GetShapeshiftForm() ~= 1 then
    if ability.HasProc or select(3, HasDebuff("mouseover", 172, "PLAYER")) < 2 then
        return true;
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Demo: Рок">
        <SpellID>603</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if isInRange then
    if GetShapeshiftForm() == 1 then
        if select(3, HasDebuff("target", 603, "PLAYER")) < 2 then
            return true;
        end
    end
end]]></Lua>
      </Ability>
      <Ability Name="Demo: Узы тьмы">
        <SpellID>109773</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if UnitLevel("player") > 81 and not HasBuff("player", 109773) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Demo: Рука Гул'дана">
        <SpellID>105174</SpellID>
        <Target>Target</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if not HasBuff("target", 47960) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Demo: Ожег души">
        <SpellID>6353</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if HasBuff("target", 122351) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Demo: Стрела тьмы">
        <SpellID>686</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Afli: Блуждающий дух">
        <SpellID>48181</SpellID>
        <Target>Target</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>true</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if power2 > 0 and not HasDebuff("target", 48181, "PLAYER") then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Afli: Агония (Target)">
        <SpellID>980</SpellID>
        <Target>Target</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if ability.HasProc or select(3, HasDebuff("target", 980, "PLAYER")) < 2 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Afli: Агония (Focus)">
        <SpellID>980</SpellID>
        <Target>Focus</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if ability.HasProc or select(3, HasDebuff("focus", 980, "PLAYER")) < 2 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Afli: Агония (Mouseover)">
        <SpellID>980</SpellID>
        <Target>Mouseover</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if ability.HasProc or select(3, HasDebuff("mouseover", 980, "PLAYER")) < 2 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Afli: Порча (Target)">
        <SpellID>172</SpellID>
        <Target>Target</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if ability.HasProc or select(3, HasDebuff("target", 172, "PLAYER")) < 2 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Afli: Порча (Focus)">
        <SpellID>172</SpellID>
        <Target>Focus</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if ability.HasProc or select(3, HasDebuff("focus", 172, "PLAYER")) < 2 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Afli: Порча (Mouseover)">
        <SpellID>172</SpellID>
        <Target>Mouseover</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if ability.HasProc or select(3, HasDebuff("mouseover", 172, "PLAYER")) < 2 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Afli: Нестабильное колдовство (Target)">
        <SpellID>30108</SpellID>
        <Target>Target</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>true</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if ability.HasProc or select(3, HasDebuff("target", 30108, "PLAYER")) < 2 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Afli: Нестабильное колдовство (Focus)">
        <SpellID>30108</SpellID>
        <Target>Focus</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>true</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if ability.HasProc or select(3, HasDebuff("focus", 30108, "PLAYER")) < 2 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Afli: Нестабильное колдовство (Mouseover)">
        <SpellID>30108</SpellID>
        <Target>Mouseover</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>true</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if ability.HasProc or select(3, HasDebuff("mouseover", 30108, "PLAYER")) < 2 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Afli: Похищение души">
        <SpellID>1120</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if HealthByPercent("target") <= 20 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Afli: Гибельная хватка">
        <SpellID>103103</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if HealthByPercent("target") > 20 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Afli: Пламя Скверны">
        <SpellID>77799</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return isMoving;]]></Lua>
      </Ability>
      <Ability Name="Afli: Семя порчи">
        <SpellID>27243</SpellID>
        <Target>Target</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return setAoE;]]></Lua>
      </Ability>
      <Ability Name="Destro: Жертвенный огонь">
        <SpellID>348</SpellID>
        <Target>Target</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Destro: Поджигание">
        <SpellID>17962</SpellID>
        <Target>Target</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Destro: Испепеление">
        <SpellID>29722</SpellID>
        <Target>Target</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if HasBuff("player", 17962) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Destro: Ожег тьмы">
        <SpellID>17877</SpellID>
        <Target>Target</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if HealthByPercent("target") < 20 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Destro: Стрела хаоса">
        <SpellID>116858</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if not HasBuff("player", 117896) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Destro: Огненный ливень">
        <SpellID>5740</SpellID>
        <Target>MouseLocation</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if IsModKeyDown(mkLeftShift) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Destro: Огонь и сера">
        <SpellID>108683</SpellID>
        <Target>Player</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Destro: ХАос">
        <SpellID>80240</SpellID>
        <Target>Target</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Destro: Черная душа: Изменчивость">
        <SpellID>113858</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if useCooldown then
    return true;
end]]></Lua>
      </Ability>
    </AbilityList>
    <RotationList>
      <Rotation Name="Демонология" ProcNotifyer="false">
        <HotKey Key="X" Modifier="Alt" />
        <AbilityQueue>
          <string>Инициализация</string>
          <string>Demo: Метаморфоза</string>
          <string>Demo: Рок</string>
          <string>Demo: Порча (Target)</string>
          <string>Demo: Порча (Focus)</string>
          <string>Demo: Порча (Mouseover)</string>
          <string>Demo: Рука Гул'дана</string>
          <string>Demo: Ожег души</string>
          <string>Demo: Стрела тьмы</string>
          <string>Demo: Узы тьмы</string>
        </AbilityQueue>
        <Notes><![CDATA[]]></Notes>
      </Rotation>
      <Rotation Name="Разрушение" ProcNotifyer="false">
        <HotKey Key="Z" Modifier="Alt" />
        <AbilityQueue />
        <Notes><![CDATA[]]></Notes>
      </Rotation>
      <Rotation Name="Колдовство" ProcNotifyer="false">
        <HotKey Key="C" Modifier="Alt" />
        <AbilityQueue>
          <string>Инициализация</string>
          <string>Afli: Семя порчи</string>
          <string>Afli: Блуждающий дух</string>
          <string>Afli: Агония (Target)</string>
          <string>Afli: Агония (Focus)</string>
          <string>Afli: Агония (Mouseover)</string>
          <string>Afli: Порча (Target)</string>
          <string>Afli: Порча (Focus)</string>
          <string>Afli: Порча (Mouseover)</string>
          <string>Afli: Нестабильное колдовство (Target)</string>
          <string>Afli: Нестабильное колдовство (Focus)</string>
          <string>Afli: Нестабильное колдовство (Mouseover)</string>
          <string>Afli: Похищение души</string>
          <string>Afli: Гибельная хватка</string>
          <string>Afli: Пламя Скверны</string>
          <string>Demo: Узы тьмы</string>
        </AbilityQueue>
        <Notes><![CDATA[]]></Notes>
      </Rotation>
    </RotationList>
  </Profile>
  <Profile Class="Monk">
    <Lua><![CDATA[useCooldown = true;]]></Lua>
    <AbilityList>
      <Ability Name="Инициализация">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if     IsModKeyDown(mkLeftShift) then
elseif IsModKeyDown(mkLeftControl) then
    if setAoE then
        setAoE = false;
        print("|cff00ff00 >> Одиночная цель");
    else
        setAoE = true;
        print("|cffff0000 >> AOE");
    end
elseif IsModKeyDown(3) then
    return true;
elseif IsModKeyDown(4) then
    if useCooldown then
        useCooldown = false;
        print("|cffff0000Кулдауны выключены");
    else
        useCooldown = true;
        print("|cff00ff00Кулдауны включены");
    end
elseif IsModKeyDown(5) then
elseif IsModKeyDown(6) then
end

-- если персонаж на маунте, тогда не выполняем ротацию дальше
if IsMounted() then
    return true;
end

isInMeele  = IsSpellInRange(GetSpellInfo(100787), "target") == 1;
agroStatus = UnitThreatSituation("player") or 0;
playerHP   = HealthByPercent("player");
energy     = UnitPower("player");     -- energy
chi        = UnitPower("player", 12); -- chi

additionalChi = 0;
if IsSpellKnown(115396) then
    additionalChi = 1;
end

TP  = HasBuff("player",   125359);            -- Сила тигра
BoF = HasDebuff("target", 123725, "PLAYER");  -- Пламенное дыхание
DH  = HasDebuff("target", 123727, "PLAYER");  -- Хмельная дымка
SR  = select(3, HasBuff("player",   115307)); -- Скрытые резервы

-- камень здоровья
if HealthByPercent("player") < 30 then
    UseItemById(5512);
end]]></Lua>
      </Ability>
      <Ability Name="Brew: Целительная сфера">
        <SpellID>115460</SpellID>
        <Target>MouseLocation</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if IsModKeyDown(mkRightAlt) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Brew: Хмельная дымка">
        <SpellID>115180</SpellID>
        <Target>MouseLocation</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if IsModKeyDown(mkLeftShift) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Brew: Смертельное касание">
        <SpellID>115080</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if chi > 2 and not UnitIsPlayer("target") and UnitHealth("target") < UnitHealthMax("player") then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Brew: Рука-копье">
        <SpellID>116705</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return CheckInterrupt("target");]]></Lua>
      </Ability>
      <Ability Name="Brew: Отвар неуловимости">
        <SpellID>115308</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if select(2, HasBuff("player", 115308)) > 9 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Brew: Очищающий отвар">
        <SpellID>119582</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[-- (124275) Легкое пошатывание
-- (124274) Умеренное пошатывание
-- (124273) Сильное пошатывание
-- Снимаем только при "Сильном пошатывании"
if chi > 0 and HasDebuff("player", 124273) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Brew: Защита">
        <SpellID>123402</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if agroStatus > 2 and HasBuff("player", 118636) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Brew:Укрепляющий отвар">
        <SpellID>115203</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if playerHP < 40 and useCooldown then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Brew: Удар кружкой">
        <SpellID>121253</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if chi < (2 + additionalChi) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Brew: Пламенное дыхание">
        <SpellID>115181</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if isInMeele and setAoE and chi > 2 then
    --                Хмельная дымка                                Пламенное дыхание
    if HasDebuff("target", 123727, "PLAYER") and not HasDebuff("target", 123725, "PLAYER") then
        return true;
    end
end]]></Lua>
      </Ability>
      <Ability Name="Brew: Порыв нефритового ветра">
        <SpellID>116847</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if setAoE and chi >= 2 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Brew: Танцующий журавль">
        <SpellID>101546</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if isInMeele and setAoE and chi > 2 then
    if HasDebuff("target", 123727, "PLAYER") and not HasDebuff("target", 123725, "PLAYER") then
        return false;
    end
end
if setAoE and isInMeele and energy >= 40 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Brew: Устранение вреда">
        <SpellID>115072</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if playerHP < 80 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Brew: Дзуки">
        <SpellID>100780</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if (chi < 3 or energy > 85) and SpellCD(121253) > 1 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Brew: Лапа тигра">
        <SpellID>100787</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if (chi < 3 and energy < 40) or not HasBuff("player", 125359) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Brew: Нокаутирующий удар">
        <SpellID>100784</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if chi >= 3 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Наследие императора">
        <SpellID>117666</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[local params_buff = { 1126, 115921, 20217, 90363 };
if not HasBuff("player", params_buff) then
    return true;
end]]></Lua>
      </Ability>
    </AbilityList>
    <RotationList>
      <Rotation Name="Ткач туманов" ProcNotifyer="false">
        <HotKey Key="X" Modifier="Alt" />
        <AbilityQueue />
        <Notes><![CDATA[]]></Notes>
      </Rotation>
      <Rotation Name="Хмелевар" ProcNotifyer="false">
        <HotKey Key="Z" Modifier="Alt" />
        <AbilityQueue>
          <string>Инициализация</string>
          <string>Brew: Целительная сфера</string>
          <string>Brew: Хмельная дымка</string>
          <string>Brew: Смертельное касание</string>
          <string>Brew: Рука-копье</string>
          <string>Brew: Отвар неуловимости</string>
          <string>Brew: Очищающий отвар</string>
          <string>Brew: Защита</string>
          <string>Brew:Укрепляющий отвар</string>
          <string>Brew: Пламенное дыхание</string>
          <string>Brew: Порыв нефритового ветра</string>
          <string>Brew: Танцующий журавль</string>
          <string>Brew: Удар кружкой</string>
          <string>Brew: Устранение вреда</string>
          <string>Brew: Дзуки</string>
          <string>Brew: Лапа тигра</string>
          <string>Brew: Нокаутирующий удар</string>
          <string>Наследие императора</string>
        </AbilityQueue>
        <Notes><![CDATA[]]></Notes>
      </Rotation>
      <Rotation Name="Танцующий с ветром" ProcNotifyer="false">
        <HotKey Key="C" Modifier="Alt" />
        <AbilityQueue />
        <Notes><![CDATA[]]></Notes>
      </Rotation>
    </RotationList>
  </Profile>
  <Profile Class="Druid">
    <Lua><![CDATA[useCooldown = true;
setAoE      = nil;
isCat       = nil;
useAutoDispell = true;]]></Lua>
    <AbilityList>
      <Ability Name="Знак дикой природы">
        <SpellID>1126</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[local params_buff = { 1126, 115921, 20217, 90363 };
if type(members) == "table" and GetShapeshiftForm() == 0 then
    for _,member in ipairs(members) do
        if member.IsInMyPaty and UnitIsPlayer(member.Unit) and not HasBuff(member.Unit, params_buff) then
            return true;
        end
    end
elseif not UnitAffectingCombat("player") then
    if not HasBuff("player", params_buff) then
        return true;
    end
end]]></Lua>
      </Ability>
      <Ability Name="Restor: Инициализация">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[-- модификатор
if     IsModKeyDown(mkLeftShift) then
    return true;
elseif IsModKeyDown(mkLeftControl) then
elseif IsModKeyDown(mkLeftAlt) then
elseif IsModKeyDown(mkRightShift) then
    if useCooldown then
        useCooldown = false;
        ShowMessage("|cffff0000Кулдауны выключены", true);
    else
        useCooldown = true;
        ShowMessage("|cff00ff00Кулдауны включены", true);
    end
elseif IsModKeyDown(mkRightControl) then
    if useAutoDispell then
        useAutoDispell = false;
        ShowMessage("|cffff0000Автодиспел выключен", true);
    else
        useAutoDispell = true;
        ShowMessage("|cff00ff00Автодиспел включен", true);
    end
elseif IsModKeyDown(mkRightAlt) then
    if useDamage then
        useDamage = false;
        ShowMessage("|cffff0000Нанесение урона выключено", true);
    else
        useDamage = true;
        ShowMessage("|cff00ff00Нанесение урона включено", true);
    end
end

local b_ufs = { 58984, 104270 };

-- если персонаж на маунте или в форме или "Слился с тенью", тогда не выполняем ротацию дальше
if IsMounted() or GetShapeshiftForm() ~= 0 or HasBuff("player", b_ufs) or IsStealthed() then
    return true;
end

-- Если кастуем спокойствие - тогда ничего не делаем
if UnitChannelInfo("player") then
    return true;
end

FillPartyTables(774);

isInRange = IsSpellInRange(GetSpellInfo(8092), "target") == 1;
isMoving  = IsMoving();
myMana    = PowerByPercent("player", SPELL_POWER_MANA);

-- используем аксесуар на ману, только в форме исцеления (0)
if myMana < 80 and GetShapeshiftForm() == 0 then
    UseItemBySlot(INVSLOT_TRINKET2);
end

if myMana < 90 and GetShapeshiftForm() == 0 then
    UseItemBySlot(INVSLOT_TRINKET1);
end

-- камень здоровья
if HealthByPercent("player") < 30 then
    UseItemById(5512);
end

if LowHP.H70 > 3 and UnitAffectingCombat("player") then
    UseItemBySlot(INVSLOT_HAND); -- Нейронные пружины
end

if UnitId("boss1") == 71529 and UnitCastingInfo("boss1") then
    if UnitCastingInfo("player") == GetSpellInfo(5185) or UnitCastingInfo("player") == GetSpellInfo(50464) then
        SpellStopCasting()
    end
end

-- прервем чтение покровительства природы, если есть просевшие цели
--if (members[1].HP < 60 or LowHP.H80 > 3) and UnitCastingInfo("player") == GetSpellInfo(50464) then
--    SpellStopCasting();
--end]]></Lua>
      </Ability>
      <Ability Name="Restor: Возрождение">
        <SpellID>20484</SpellID>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[if UnitIsDeadOrGhost("mouseover") then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Restor: Дикий гриб">
        <SpellID>88747</SpellID>
        <Target>MouseLocation</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if IsModKeyDown(mkLeftControl) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Restor: Природный целитель">
        <SpellID>88423</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if useAutoDispell then
    return GetDispellInfo();
end]]></Lua>
      </Ability>
      <Ability Name="Restor: Очищение (Симбоз)">
        <SpellID>122288</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if useAutoDispell then
    return GetDispellInfo(true);
end]]></Lua>
      </Ability>
      <Ability Name="Restor: Железная кора">
        <SpellID>102342</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>true</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if members[1].HP < 30 then
    return members[1].Unit;
end]]></Lua>
      </Ability>
      <Ability Name="Restor: Дубовая кора">
        <SpellID>22812</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>true</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if HealthByPercent("player") < 40 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Restor: Природная стремительность">
        <SpellID>132158</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>true</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if members[1].HP < 35 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Restor: Буйный рост">
        <SpellID>48438</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if LowHP.H80 > 3 then
    return members[1].Unit;
end]]></Lua>
      </Ability>
      <Ability Name="Restor: Быстрое восстановление">
        <SpellID>18562</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if HasGlyph(145529) then
    for _,member in ipairs(members) do
        if member.HP < 70 and HasBuff("player", { 774, 8936 }, "PLAYER") then
            return member.Unit;
        end
    end
elseif LowHP.H80 <= 3 then
    for _,member in ipairs(members) do
        if member.HP < 90 and HasBuff(member.Unit, { 774, 8936 }, "PLAYER") then
            local count = 0;
            for _,unit in ipairs(members) do
                if unit.HP < 90 and CheckDistance(unit.X, unit.Y, member.X, member.Y, 9) then
                    count = count + 1;
                end
            end
            if count > 2 then
                return member.Unit;
            end
        end
    end
end]]></Lua>
      </Ability>
      <Ability Name="Restor: Спокойствие">
        <SpellID>740</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[if IsModKeyDown(mkRightShift) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Restor: Озарение">
        <SpellID>29166</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if myMana <= 75 and GetShapeshiftForm() == 0 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Restor: Омоложение (Сильный Урон)">
        <SpellID>774</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if LowHP.H50 > 3 then -- Опытным путем надо определить условие
    for _,member in ipairs(members) do
        if member.HP < 55 or (member.Agro > 2 and member.IsTank) then
            if not HasBuff(member.Unit, 774, "PLAYER") then
                return member.Unit;
            end
        end
    end
end]]></Lua>
      </Ability>
      <Ability Name="Restor: Сотворение">
        <SpellID>145518</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[local count = 0;
for _,member in ipairs(members) do
    if member.HP < 85 and select(3, HasBuff(member.Unit, 774, "PLAYER")) > 4 then
        count = count + 1;
        if count > 2 then
            print("|cff00ff00 >> Кастую сотворение <<")
            return true;
        end
    end
end]]></Lua>
      </Ability>
      <Ability Name="Restor: Восстановление">
        <SpellID>8936</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[-- 132158 Природная стремительность
if not HasBuff("player", 132158) then
    local name,_,rem = HasBuff("player", 16870); -- 16870 Ясность мысли
    local harmony = select(3, HasBuff("player", 100977));
    local hp = members[1].HP;
    if hp <= 40 or (name and ((hp <= 80 and rem < 5) or (hp <= 65 and rem >= 5) or (harmony < 2 and rem < 5))) then
        return members[1].Unit;
    end
end]]></Lua>
      </Ability>
      <Ability Name="Restor: Целительное прикосновение">
        <SpellID>5185</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[if members[1].HP <= 60 then
    return members[1].Unit;
end]]></Lua>
      </Ability>
      <Ability Name="Restor: Жизнецвет">
        <SpellID>33763</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[local hasTank = false;
for _,member in ipairs(members) do
    if member.IsTank then
        hasTank = true;
        break;
    end
end

-- если рейд проседает, то держим 1 стак жизнецвета на танке
local lb_count = LowHP.H50 > 3 and 1 or 3;

-- В рейде накладываем жизнецвет только на танка
-- чтобы во время боя (при агро на 2х танках) жизнецвет не перекидывало с одного на другого.
for _,member in ipairs(members) do
    if member.Agro > 2 and (not hasTank or member.IsTank) then
        local name,count,rem = HasBuff(member.Unit, 33763, "PLAYER");
        -- Обновим стаки жизнецвета
        if name and (count < lb_count or rem < 3) then
            return member.Unit;
        -- Если жизнецвет уже есть, тогда дальше не продолжаем.
        elseif count >= lb_count and rem > 3 then
            return;
        end
    end
end

-- Накладываем жизнецвет на юнита с агро или если в рейде то на танка
for _,member in ipairs(members) do
    if member.Agro > 2 and (not hasTank or member.IsTank) then
        return member.Unit;
    end
end]]></Lua>
      </Ability>
      <Ability Name="Restor: Омоложение">
        <SpellID>774</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[for _,member in ipairs(members) do
    if member.HP < 82 or ((not IsInRaid() or member.IsTank) and member.Agro > 2)then
        if not HasBuff(member.Unit, 774, "PLAYER") then
            return member.Unit;
        end
    end
end]]></Lua>
      </Ability>
      <Ability Name="Restor: Покровительство природы">
        <SpellID>50464</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>true</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[if LowHP.H80 < 3 then
    if members[1].HP < 80 or select(3, HasBuff("player", 100977)) < 2 then
        return members[1].Unit;
    end
end]]></Lua>
      </Ability>
      <Ability Name="Restor: Лунный огонь">
        <SpellID>8921</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>true</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if useDamage and myMana > 40 and select(3, HasDebuff("target", 8921, "PLAYER")) < 2 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Restor: Гнев">
        <SpellID>5176</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>true</IsSpellKnownCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[if useDamage and myMana > 40 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Restor: Оживление">
        <SpellID>50769</SpellID>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[if not UnitAffectingCombat("player") and UnitIsDeadOrGhost("mouseover") then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Инициализация (Страж)">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if     IsModKeyDown(mkLeftShift) then
elseif IsModKeyDown(mkLeftControl) then
    if setAoE then
        setAoE = false;
        ShowMessage("|cff00ff00 Одиночная цель", true);
    else
        setAoE = true;
        ShowMessage("|cffff0000 AOE", true);
    end
elseif IsModKeyDown(mkLeftAlt) then
    return true;
elseif IsModKeyDown(mkRightShift) then
    if useCooldown then
        useCooldown = false;
        ShowMessage("|cffff0000Кулдауны выключены", true);
    else
        useCooldown = true;
        ShowMessage("|cff00ff00Кулдауны включены", true);
    end
elseif IsModKeyDown(mkRightControl) then
elseif IsModKeyDown(mkRightAlt) then
    if isAltMod then
        isAltMod = false;
        ShowMessage("|cffff0000Используется \'Дикая защита\'", true);
    else
        isAltMod = true;
        ShowMessage("|cff00ff00Используется \'Неистовое восстановление\'", true);
    end
end

-- если персонаж на маунте, или в инвизе или не в форме медведа или кота
if IsMounted() or not (GetShapeshiftForm() == 3 or GetShapeshiftForm() == 1) or HasBuff("player", { 5215, 58984 }) then
    return true;
end

-- камень здоровья
if HealthByPercent("player") < 30 then
    UseItemById(5512);
end

agroStatus = UnitThreatSituation("player");
playerHP   = HealthByPercent("player");
isInMeele  = IsSpellInRange(GetSpellInfo(33878), "target") == 1;
isCat      = GetShapeshiftForm() == 3;]]></Lua>
      </Ability>
      <Ability Name="Guard: Лобовая атака">
        <SpellID>80964</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>true</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return CheckInterrupt("target");]]></Lua>
      </Ability>
      <Ability Name="Guard: Неистовое восстановление">
        <SpellID>22842</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>true</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if not isCat and playerHP < 80 and UnitPower("player") > 55 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Guard: Дикая защита">
        <SpellID>62606</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if not isCat and playerHP < 60 and agroStatus > 0 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Guard: Дубовая кожа">
        <SpellID>22812</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if useCooldown and playerHP < 50 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Guard: Инстинкты выживания">
        <SpellID>61336</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if not isCat and useCooldown and playerHP < 35 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Guard: Мощь урсока">
        <SpellID>106922</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if useCooldown and playerHP < 25 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Guard: Увечье">
        <SpellID>33878</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if not isCat then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Guard: Взбучка">
        <SpellID>77758</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if isInMeele and not isCat then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Guard: Размах">
        <SpellID>779</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if setAoE and isInMeele and not isCat then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Guard: Исступление">
        <SpellID>5229</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if not isCat and UnitPower("player") < 70 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Guard: Трепка">
        <SpellID>6807</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[-- без ГКД
if isCat then
    return false;
end

if UnitPower("player") > 70 then
    if HasBuff("player", 135288) then
        return true;
    end
end
if agroStatus == 0 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Guard: Волшебный огонь">
        <SpellID>770</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Guard: Растерзать">
        <SpellID>33745</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if not isCat then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Guard: Взбучка (Кот)">
        <SpellID>106830</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if isCat and setAoE and not HasDebuff("target", 106830, "PLAYER") then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Guard: Размах (Кот)">
        <SpellID>62078</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if isCat and setAoE and HasDebuff("target", 106830, "PLAYER") then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Guard: Глубокая рана (Кот)">
        <SpellID>1822</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if isCat and select(3, HasDebuff("target", 1822, "PLAYER")) < 2 and not setAoE then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Guard: Разорвать (Кот)">
        <SpellID>1079</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if isCat and not setAoE and select(3, HasDebuff("target", 1079, "PLAYER")) < 2 then
    if UnitHealth("target") > (UnitHealthMax("player") / 5) and GetComboPoints("player") > 4 then
        return true;
    end
end]]></Lua>
      </Ability>
      <Ability Name="Guard: Свирепый укус (Кот)">
        <SpellID>22568</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if isCat and not setAoE and UnitPower("player") > 30 and GetComboPoints("player") > 4 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Guard: Увечье (Кот)">
        <SpellID>33876</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if isCat and not setAoE then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Инициализация (КотЭ)">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if     IsModKeyDown(mkLeftShift) then
elseif IsModKeyDown(mkLeftControl) then
    if setAoE then
        setAoE = false;
        print("|cff00ff00 >> Одиночная цель");
    else
        setAoE = true;
        print("|cffff0000 >> AOE");
    end
elseif IsModKeyDown(mkLeftAlt) then
    return true;
elseif IsModKeyDown(mkRightShift) then
    if useCooldown then
        useCooldown = false;
        print("|cffff0000Кулдауны выключены");
    else
        useCooldown = true;
        print("|cff00ff00Кулдауны включены");
    end
elseif IsModKeyDown(mkRightControl) then
elseif IsModKeyDown(mkRightAlt) then
end

-- если персонаж на маунте, тогда не выполняем ротацию дальше
if IsMounted() or HasBuff("player", 5215) then
    return true;
end

-- камень здоровья
if HealthByPercent("player") < 30 then
    UseItemById(5512);
end

agroStatus = UnitThreatSituation("player");
playerHP   = HealthByPercent("player");
isInMeele  = IsSpellInRange(GetSpellInfo(33878), "target") == 1;
isCat      = GetShapeshiftForm() == 3;
energy     = UnitPower("player");
combopoint = GetComboPoints("player");]]></Lua>
      </Ability>
      <Ability Name="Cat: Дикий рев">
        <SpellID>52610</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[local sr = select(3, HasBuff("player", 52610));
if (combopoint > 4 and sr < 4) or (sr < 2 and combopoint > 0) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Cat: Тигриное неистовство">
        <SpellID>5217</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if energy < 35 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Cat: Берсерк">
        <SpellID>106952</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if useCooldown and energy < 35 and not HasBuff("player", 106952) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Cat: Взбучка">
        <SpellID>106832</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if isInMeele and (setAoE or HasBuff("player", 16864)) and not HasDebuff("target", 106830, "PLAYER") then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Cat: Размах">
        <SpellID>62078</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if setAoE and isInMeele then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Cat: Природная чуткость">
        <SpellID>124974</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if IsSpellKnown(124974) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Cat: Целительное прикосновение">
        <SpellID>5185</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if HasBuff("player", 16974) then
     return true;
end]]></Lua>
      </Ability>
      <Ability Name="Cat: Свирепый укус">
        <SpellID>22568</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[local rip = select(3, HasDebuff("target", 1079, "PLAYER"));
if HealthByPercent("target") < 25 then
    if (rip < 2 and combopoint > 1) or combopoint > 4 then
        return true;
    end
end]]></Lua>
      </Ability>
      <Ability Name="Cat: Разорвать">
        <SpellID>1079</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if combopoint > 4 and select(3, HasDebuff("target", 1079)) < 2 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Cat: Глубокая рана">
        <SpellID>1822</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if select(3, HasDebuff("target", 1822)) < 3 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Cat: Полоснуть">
        <SpellID>5221</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if not IsNotBehind(3) then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Cat: Увечье">
        <SpellID>33876</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>true</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[if energy >= 40 then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Инициализация (Баланс)">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[]]></Lua>
      </Ability>
      <Ability Name="Balance: Лунный огонь">
        <SpellID>0</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Balance: Гнев">
        <SpellID>0</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Balance: Звездный поток">
        <SpellID>0</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>false</IsRangeCheck>
        <IsAttacedTarget>false</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[return true;]]></Lua>
      </Ability>
      <Ability Name="Farm: Лунный огонь">
        <SpellID>8921</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[-- 64399 Боевой штандарт координации
UseItemById(64399);
TargetNearestEnemy();
-- and string.match(UnitName("target"), "^(.+).жных морей$")
if UnitExists("target") and not UnitIsDeadOrGhost("target") then
    return true;
end]]></Lua>
      </Ability>
      <Ability Name="Test: Лунный огонь">
        <SpellID>8921</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsRangeCheck>true</IsRangeCheck>
        <IsAttacedTarget>true</IsAttacedTarget>
        <IsUseIncombat>false</IsUseIncombat>
        <SetRecastDelay>false</SetRecastDelay>
        <IsNotHCD>false</IsNotHCD>
        <IsSpellKnownCheck>false</IsSpellKnownCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[-- 64399 Боевой штандарт координации
if not CheckDistance2("player", "target", 10) then
    return true;
end]]></Lua>
      </Ability>
    </AbilityList>
    <RotationList>
      <Rotation Name="Лекарь" ProcNotifyer="false">
        <HotKey Key="Z" Modifier="Alt" />
        <AbilityQueue>
          <string>Restor: Инициализация</string>
          <string>Restor: Возрождение</string>
          <string>Restor: Дикий гриб</string>
          <string>Restor: Природный целитель</string>
          <string>Restor: Природный целитель (mouseover)</string>
          <string>Restor: Очищение (Симбоз)</string>
          <string>Restor: Очищение (Симбоз): Mouseover</string>
          <string>Restor: Озарение</string>
          <string>Restor: Железная кора</string>
          <string>Restor: Дубовая кора</string>
          <string>Restor: Буйный рост</string>
          <string>Restor: Омоложение (Сильный Урон)</string>
          <string>Restor: Сотворение</string>
          <string>Restor: Быстрое восстановление</string>
          <string>Restor: Природная стремительность</string>
          <string>Restor: Восстановление</string>
          <string>Restor: Жизнецвет</string>
          <string>Restor: Целительное прикосновение</string>
          <string>Restor: Омоложение</string>
          <string>Restor: Покровительство природы</string>
          <string>Знак дикой природы</string>
          <string>Restor: Оживление</string>
          <string>Restor: Лунный огонь</string>
          <string>Restor: Гнев</string>
        </AbilityQueue>
        <Notes><![CDATA[LeftShift        - Пауза
LeftControl    - Установка гриба
RightControl - Включение/выключение автодиспела
]]></Notes>
      </Rotation>
      <Rotation Name="Страж" ProcNotifyer="false">
        <HotKey Key="X" Modifier="Alt" />
        <AbilityQueue>
          <string>Инициализация (Страж)</string>
          <string>Guard: Лобовая атака</string>
          <string>Guard: Неистовое восстановление</string>
          <string>Guard: Дикая защита</string>
          <string>Guard: Дубовая кожа</string>
          <string>Guard: Инстинкты выживания</string>
          <string>Guard: Мощь урсока</string>
          <string>Guard: Увечье</string>
          <string>Guard: Взбучка</string>
          <string>Guard: Размах</string>
          <string>Guard: Исступление</string>
          <string>Guard: Трепка</string>
          <string>Guard: Волшебный огонь</string>
          <string>Guard: Растерзать</string>
          <string>Guard: Взбучка (Кот)</string>
          <string>Guard: Размах (Кот)</string>
          <string>Guard: Глубокая рана (Кот)</string>
          <string>Guard: Разорвать (Кот)</string>
          <string>Guard: Свирепый укус (Кот)</string>
          <string>Guard: Увечье (Кот)</string>
          <string>Знак дикой природы</string>
        </AbilityQueue>
        <Notes><![CDATA[Тест]]></Notes>
      </Rotation>
      <Rotation Name="Баланс" ProcNotifyer="false">
        <HotKey Key="V" Modifier="Alt" />
        <AbilityQueue>
          <string>Инициализация (Баланс)</string>
          <string>Balance: Лунный огонь</string>
          <string>Balance: Звездный поток</string>
          <string>Balance: Гнев</string>
          <string>Знак дикой природы</string>
        </AbilityQueue>
        <Notes><![CDATA[]]></Notes>
      </Rotation>
      <Rotation Name="Сила зверя" ProcNotifyer="false">
        <HotKey Key="C" Modifier="Alt" />
        <AbilityQueue>
          <string>Инициализация (КотЭ)</string>
          <string>Cat: Дикий рев</string>
          <string>Cat: Тигриное неистовство</string>
          <string>Cat: Берсерк</string>
          <string>Cat: Взбучка</string>
          <string>Cat: Размах</string>
          <string>Cat: Природная чуткость</string>
          <string>Cat: Целительное прикосновение</string>
          <string>Cat: Свирепый укус</string>
          <string>Cat: Разорвать</string>
          <string>Cat: Глубокая рана</string>
          <string>Cat: Полоснуть</string>
          <string>Cat: Увечье</string>
          <string>Знак дикой природы</string>
        </AbilityQueue>
        <Notes><![CDATA[LeftControl - Включыние / Выключение AOE
LeftAlt - Пауза
RightControl - Включыние / Выключение кулдаунов]]></Notes>
      </Rotation>
      <Rotation Name="Фарм репы (антипираты)" ProcNotifyer="false">
        <HotKey Key="N" Modifier="Alt" />
        <AbilityQueue>
          <string>Farm: Лунный огонь</string>
          <string>Знак дикой природы</string>
        </AbilityQueue>
        <Notes><![CDATA[]]></Notes>
      </Rotation>
      <Rotation Name="Лекарь: Дамаг" ProcNotifyer="false">
        <HotKey Key="B" Modifier="Alt" />
        <AbilityQueue>
          <string>Restor: Инициализация</string>
          <string>Restor: Дикий гриб</string>
          <string>Restor: Возрождение</string>
          <string>Restor: Озарение</string>
          <string>Restor: Лунный огонь</string>
          <string>Restor: Гнев</string>
        </AbilityQueue>
        <Notes><![CDATA[]]></Notes>
      </Rotation>
    </RotationList>
  </Profile>
</ProfileDb>