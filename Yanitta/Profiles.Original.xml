<?xml version="1.0"?>
<ProfileDb xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema">
  <Version>0.0.5.214</Version>
  <Author>Konctantin</Author>
  <Url>https://raw.github.com/Konctantin/yanitta/master/Yanitta/Profiles.Original.xml</Url>
  <Lua><![CDATA[
OnEventExtended = nil;
ABILITY_TABLE   = { };
LOSS_TABLE      = { };
LAST_TARGET     = 0;

-- Константы горячих клавиш
mkLeftShift     = 1;
mkLeftControl   = 2;
mkLeftAlt       = 3;
mkRightShift    = 4;
mkRightControl  = 5;
mkRightAlt      = 6;

-- Заклинания (бафы), которые позволяют произносить заклинания на ходу
moving_spell_table = {
    97128,  -- Опаляющее перо (Алисразор)
    79206,  -- Благосклонность предков (Шанам)
    110806, -- Благосклонность предков (Друид: Симбиоз)
    108839, -- Плавучая льдина
};

-- Возвращает, есть ли один из перечисленных бафов на персонаже
-- Возвращает:
--  Имя эффекта
--  Количество стаков
--  Оставшееся время действия
--  value1, value2, value3 - Величина эффекта
-- Параметры:
--  unit - Цель ("palyer", "target", "focus", "mouseover")
--  {...} - перечень бафов
--  filter - фильтр
function HasBuff(unit, spellId, filter)
    local spell_table = { };
    if type(spellId) == "table" then
        spell_table = spellId;
    elseif type(spellId) == "number" then
        spell_table = { spellId };
    end

    for _,spell_id in ipairs(spell_table) do
        local spellName, spellRank = GetSpellInfo(spell_id);
        if spellName then
            -- name, rank, icon, count, dispelType, duration, expires, caster, isStealable, shouldConsolidate, spellID, canApplyAura, isBossDebuff, value1, value2, value3
            local name,_,_,count,_,_,expires,_,_,_,_,_,_,value1,value2,value3 = UnitBuff(unit, spellName, spellRank, filter);
            if name then
                local rem = min(max((expires or 0) - (GetTime() - (AddonFrame.ping or 0)), 0), 0xffff);
                return name, count, rem, value1, value2, value3;
            end
        end
    end
    return nil, 0, 0, nil, 0, 0;
end

-- Возвращает, есть ли один из перечисленных дебафов на персонаже
-- Возвращает:
--  Имя эффекта
--  Количество стаков
--  Оставшееся время действия
--  value1, value2, value3 - Величина эффекта
-- Параметры:
--  unit - Цель ("palyer", "target", "focus", "mouseover")
--  {...} - перечень дебафов
--  filter - фильтр
function HasDebuff(unit, spellId, filter)
    local spell_table = { };
    if type(spellId) == "table" then
        spell_table = spellId;
    elseif type(spellId) == "number" then
        spell_table = { spellId };
    end

    for _,spell_id in ipairs(spell_table) do
        local spellName, spellRank = GetSpellInfo(spell_id);
        if spellName then
            -- name, rank, icon, count, dispelType, duration, expires, caster, isStealable, shouldConsolidate, spellID, canApplyAura, isBossDebuff, value1, value2, value3
            local name,_,_,count,_,_,expires,_,_,_,_,_,_,value1,value2,value3 = UnitDebuff(unit, spellName, spellRank, filter);
            if name then
                local rem = min(max((expires or 0) - (GetTime() - (AddonFrame.ping or 0)), 0), 0xffff);
                return name, count, rem, value1, value2, value3;
            end
        end
    end
    return nil, 0, 0, nil, 0, 0;
end

-- Вызвращает время до восстановления заклинания
-- Параметр: ид заклинания
function SpellCD(m_spell)
    local start, duration = GetSpellCooldown(m_spell);
    local cooldown = duration + start - GetTime();
    return cooldown > 0 and cooldown - (AddonFrame.ping or 0) or 0;
end

-- Проверка, двигается ли игрок, за исключением бафов, которые дают возможность кастровать на ходу
-- на пример: Опаляющее перо (Алисразор), Благосклонность предков (Шанам)
function IsMoving()
    for _, spell in ipairs(moving_spell_table) do
        local name,rank = GetSpellInfo(spell);
        if name and UnitAura("player", name, rank, nil) then
            return;
        end
    end
    return GetUnitSpeed("player") ~= 0 or IsFalling();
end

-- Проверка на нахождение персонажа за спиной цели
function IsNotBehind(sec)
    return GetTime() - (AddonFrame.LastNotBehindTime or 0) <= (sec or 1);
end

-- Проверка на нахождение цели в зоне видимости персонажа
function IsNotLineOfSight(unit, sec)
    local rec = LOSS_TABLE[UnitGUID(unit)];
    return rec and (GetTime() - rec.ctime) <= (sec or 1);
end

-- возвращает текущее значение здоровья в процентах
function HealthByPercent(m_target)
    return UnitExists(m_target) and 100 * (UnitHealth(m_target) or 1) / (UnitHealthMax(m_target) or 1) or 0;
end

-- возвращает текущее значение ресурса (мана, энергия, фокус, ярость ...) в процентах
function PowerByPercent(m_target, m_powertype)
    return UnitExists(m_target) and 100 * (UnitPower(m_target, m_powertype) or 1) / (UnitPowerMax(m_target, m_powertype) or 1) or 0;
end

-- Проверка, была ли зажата клавиша модификатор mk*
function IsModKeyDown(m_key)
    if not GetCurrentKeyBoardFocus() then
        return (m_key == mkLeftShift    and IsLeftShiftKeyDown()   ) or
               (m_key == mkLeftControl  and IsLeftControlKeyDown() ) or
               (m_key == mkLeftAlt      and IsLeftAltKeyDown()     ) or
               (m_key == mkRightShift   and IsRightShiftKeyDown()  ) or
               (m_key == mkRightAlt     and IsRightAltKeyDown()    ) or
               (m_key == mkRightControl and IsRightControlKeyDown());
    end
end

-- Возвращает дистанцию между двумя игроками
function GetDistance(unit1, unit2)
    local a1, b1, c1, d1 = select(2, GetCurrentMapDungeonLevel());
    if not (a1 and b1 and c1 and d1) then
        a1, b1, c1, d1 = select(2, GetCurrentMapZone());
    end
    if a1 and b1 and c1 and d1 then
        local x1, y1 = GetPlayerMapPosition(unit1);
        local x2, y2 = GetPlayerMapPosition(unit2);
        local dX = ((x1 - x2) * abs(c1 - a1)) ^ 2;
        local dY = ((y1 - y2) * abs(d1 - b1)) ^ 2;
        return sqrt(dX + dY);
    end
end

-- Проверка, имеется ли у персонажа указанный символ
function HasGlyph(glyphid)
    for slot = 1, 6 do
        if select(4, GetGlyphSocketInfo(slot)) == glyphid then
            return slot;
        end
    end
end

-- Использование предмета в инвентаре
-- Если предмет (перчатка, тринька, пояс и т.п) юзабелен и не имеет КД - имитируем клик правой кн. мыши.
function UseItemBySlot(slotId)
    local start, duration, enable = GetInventoryItemCooldown("player", slotId);
    if duration == 0 and enable == 1 then
        UseInventoryItem(slotId);
    end
end

-- Использование предмета в инвентаре по его ID
function UseItemById(itemId)
    local count = GetItemCount(itemId);
    if (count or 0) > 0 then
        local start,duration,enable = GetItemCooldown(itemId);
        if start == 0 and duration == 0 and enable then
            UseItemByName(itemId);
        end
    end
end

-- Возвращает ID юнита
function UnitId(unit)
    return tonumber((UnitGUID(unit) or "0x0000000000000000"):sub(-12, -9), 16);
end

-- Проверяет, надо ли сбивать заклинание текущему юниту.
function CheckInterrupt(unit, sec)
    -- чтение заклинания прерываем только перед окончанием каста.
    local name,_,_,_,startTime,endTime,isTrade,_,notInterruptible = UnitCastingInfo(unit);
    if name and not (notInterruptible or isTrade) then
        if (((endTime / 1000) - GetTime()) - AddonFrame.ping) <= (sec or 1) then
            return true;
        end
    end
    -- канальное заклинание прерываем сразу.
    local name,_,_,_,_,_,isTrade,notInterruptible = UnitChannelInfo(unit);
    if name and not (notInterruptible or isTrade) then
        return true;
    end
end

-- Проверяет наличие исступления.
function CheckEnrage(unit)
    if UnitCanAttack("player", unit) then
        for i = 1, 40 do
            local name,_,_,_,dispelType = UnitBuff(unit, i);
            if not name then
                return;
            -- Исступление отображается как пустая строка
            elseif dispelType == "" then
                return true;
            end
        end
    end
end

-----------------------------------------------
--                    HEAL                   --
-----------------------------------------------

MAIN_CLASS_SPELL = 0;
FORCE_IN_COMBAT  = nil;

DISPELL_TABLE = { --    Магия         Яд             Болезнь         Проклятие
    PRIEST_HEAL     = { Magic = true, Poison = nil , Disease = true, Curse = nil  },
    PRIEST_NONE     = { Magic = nil , Poison = nil , Disease = true, Curse = nil  },
    DRUID_HEAL      = { Magic = true, Poison = true, Disease = nil , Curse = true },
    DRUID_NONE      = { Magic = nil , Poison = true, Disease = nil , Curse = true },
    DRUID_SIMBIOS   = { Magic = nil , Poison = true, Disease = true, Curse = true },
    PALADIN_HEAL    = { Magic = true, Poison = true, Disease = true, Curse = nil  },
    PALADIN_NONE    = { Magic = nil , Poison = true, Disease = true, Curse = nil  },
    MONK_HEAL       = { Magic = true, Poison = true, Disease = true, Curse = nil  },
    MONK_NONE       = { Magic = nil , Poison = true, Disease = true, Curse = nil  },
    SHAMAN_HEAL     = { Magic = true, Poison = nil , Disease = nil , Curse = true },
    SHAMAN_NONE     = { Magic = nil , Poison = nil , Disease = nil , Curse = nil  },
    MAGE_NONE       = { Magic = nil , Poison = nil , Disease = nil , Curse = true },
};

-- Добавляет в таблицу "members" указанного юнита, при этом делая проверки (возможность лечить)
function InsertNewUnitToHeallersTable(unit)
    if UnitExists(unit)
        and not UnitIsDeadOrGhost(unit)
        and not UnitIsCorpse(unit)
        and     UnitCanAssist(unit, "player")
        and     IsSpellInRange(GetSpellInfo(MAIN_CLASS_SPELL), unit) == 1
        and not IsNotLineOfSight(unit) then
        for _,member in ipairs(members) do
            if UnitGUID(member.Unit) == UnitGUID(unit) then
                return;
            end
        end
        table.insert(members, { Unit = unit, IsInMyParty = false });
    end
end

-- в эту функцию добавляем логику по особому поведению в рейдах
-- на пример, если есть какой-то дебаф, который надо выхиливать.
function CheckInstanseLogic(member)
    -- Осада Огриммара: Малкорок
    -- Отхил не проходит, надо настакивать щит под дебафом
    -- по этому просто занижаем реальное здоровье.
    if HasDebuff(member.Unit, 142861) then
        if HasDebuff(member.Unit, 142863) then -- красный
            member.HP = 50;
        elseif HasDebuff(member.Unit, 142864) then -- желтый
            member.HP = 80;
        elseif HasDebuff(member.Unit, 142865) then -- зеленый
            member.HP = 100;
        else -- без щита
            member.HP = min(member.HP, 50);
        end
    -- Престол гроз: Тортос (Кристальная оболочка)
    elseif HasDebuff(member.Unit, 137633) then
        if not HasDebuff(member.Unit, 140701) then
            member.HP = min(member.HP, 50);
        end 
    -- Престол гроз: Наложницы блезнецы (Дебаф: Чудовище из кошмаров)
    elseif HasDebuff(member.Unit, 137341) then
        member.DontHeal = true;
    end
end

-- логика развеивания заклинаний, тут добавляем условия, которые запрещают развеивать дебафы
function DontDispell(debuffId, member)
    -- ша гордыни: диспелим "Слово тьмы: Погибель" только с дебафом "Дар титанов"
    -- После "Освобождения" Дар титанов больше не кидается, поэтому диспелим по КД
    if debuffId == 144351 then
        if not HasDebuff("player", 144359) and HealthByPercent("boss1") > 30 then
            -- Если на нас много порчи - не диспелим
            if UnitPower("player", SPELL_POWER_ALTERNATE_POWER) > 50 then
                return true;
            end
        end
    -- Глубиний
    elseif debuffId == 143579 then
        if select(2, HasDebuff(member.Unit, 143579)) < 3 then
            return true;
        end
    -- Блуждающая энергия: надо диспелить когда возле цели разсеивания нету других игроков
--    elseif debuffId == 142913 then
--        for i,member2 in ipairs(members) do
--            if not UnitIsUnit("player", member2.Unit) then
--                if (GetDistance(member.Unit, member2.Unit) or 0) < 8 then
--                    return true;
--                end
--            end
--        end
    elseif debuffId == 149207 then
        return true;
    end
end

-- Возвращает юнита, с которого надо диспелить (с наибольшим количеством стаков)
-- Параметр dispeller_type - Указывает тип диспеллера ( "NONE", "HEAL", "SIMBIOS")
-- По умолчанию: "NONE"
-- Возвращает: unit, count или nil - если диспелить нечего.
function GetDispellInfo(dispeller_type)
    local dispeller = dispeller_type or "NONE";
    local d_class   = select(2, UnitClass("player")) or "";
    local c_rec     = DISPELL_TABLE[d_class.."_"..dispeller];

    if not c_rec then return end

    local dispellTable = { };
    for _,member in ipairs(members) do
        for index = 1, 40 do
            local name,_,_,count,dispelType,duration,expires,_,_,_,debuffId = UnitDebuff(member.Unit, index);
            if not name then break end
            if c_rec[dispelType] and not DontDispell(debuffId, member) then
                table.insert(dispellTable, { Unit = member.Unit, Count = count, HP = member.HP });
            end
        end
    end
    if #dispellTable > 1 then
        table.sort(dispellTable, function(A, B)
            return A.Count > B.Count;
        end);
        return dispellTable[1].Unit, dispellTable;
    end
end

-- Формирует таблицу "members" которая содержит юнитов нуждающихся в лечении.
-- при формировании происходят проверки: (доступность + рейдовая логика)
-- сформированная таблица будет отсортирована по наименьшему здоровью.
function FillPartyTables(standartSpellId)
    -- Обнуляем все хиловские глобальные переменные.
    FORCE_IN_COMBAT  = false;
    MAIN_CLASS_SPELL = standartSpellId;
    LowHP            = { };
    members          = { { Unit = "player", IsInMyParty = true } };

    for i = 95, 10, -5 do
        LowHP["H"..i] = 0;
    end

    local prefix = "party";
    if IsInRaid() then
        prefix = "raid";
    elseif IsInArenaTeam() then
        prefix = "arena";
    end

    for index = 1, GetNumGroupMembers() do
        local unit = prefix..index;
        if UnitExists(unit)
            and not UnitIsCorpse(unit)
            and not UnitIsUnit("player", unit)
            and     UnitIsConnected(unit)
            and not UnitIsEnemy("player", unit)
            and not UnitIsDeadOrGhost(unit)
            and     UnitInRange(unit)
            and not IsNotLineOfSight(unit) then
            table.insert(members, { Unit = unit, IsInMyParty = true });
        end
    end

    -- отхил дружественной цели по mouseover/target/focus
    InsertNewUnitToHeallersTable("target");
    InsertNewUnitToHeallersTable("focus");
    InsertNewUnitToHeallersTable("mouseover");

    -- Обновляем статы игроков из пати/рейда
    for index = #members, 1, -1 do
        local member = members[index];
        if UnitAffectingCombat(member.Unit) then
            FORCE_IN_COMBAT = true;
        end

        member.IsTank  = UnitGroupRolesAssigned(member.Unit) == "TANK";
        member.Agro    = UnitThreatSituation(member.Unit) or 0;

        local max_hp   = UnitHealthMax(member.Unit) or 0;
        local inc_hp   = UnitGetIncomingHeals(member.Unit) or 0;
        local cur_hp   = UnitHealth(member.Unit) or 0;
        member.IncHeal = 100 * inc_hp / max_hp;
        member.HP      = 100 * (cur_hp + inc_hp) / max_hp;

        -- логика по особому поведению в рейдах
        CheckInstanseLogic(member);

        -- подсчет количества персонажей с определенным уровнем здоровья (95-10) с шагом в -5
        -- не учитываем цели, которые хилить нельзя
        if not member.DontHeal then
            for i = 95, 10, -5 do
                if member.HP <= i then
                    LowHP["H"..i] = LowHP["H"..i] + 1;
                end
            end
        end

        -- удаляем из талицы юнит, которого нельзя хилить
        if member.DontHeal then
            table.remove(members, index);
        end
    end
    -- сортируем таблицы по наименьшему количеству ХР
    if #members > 1 then
        table.sort(members, function(x, y) return x.HP < y.HP; end);
    elseif #members == 0 then
        members = {{ Unit = "none", Agro = 0, HP = 100, IncHeal = 0 }};
    end
end

---------------------------------------
--              CORE                 --
---------------------------------------

function CheckAndCastAbility(ability)
    if ability.IsCheckInCombat and not (FORCE_IN_COMBAT or UnitAffectingCombat("player")) then
        return;
    end

    local recastDelay = 0;
    if ability.SetRecastDelay then
        recastDelay = AddonFrame.ping + 300;
        if (GetTime() - ability.LastCastingTime) < 1 then
            return;
        end
    end

    local spellInfo = GetSpellInfo(ability.SpellId);

    if ability.SpellId < 1 then
        return ability.Func(ability);
    elseif not IsUsableSpell(ability.SpellId) then
        return;
    elseif ability.IsSpellKnownCheck
        and not (IsPlayerSpell(ability.SpellId)
            or IsSpellKnown(ability.SpellId) or IsSpellKnown(ability.SpellId, true)
            or GetSpellBookItemInfo(spellInfo)) then
        return;
    end

    local start, duration, enable = GetSpellCooldown(ability.SpellId);
    if enable == 1 and ((duration + start) - GetTime()) > AddonFrame.ping then
        return;
    end

    local castPing = (AddonFrame.ping * 1000) - recastDelay;
    if not ability.CancelCasting then
        local endTime = select(6, UnitCastingInfo("player")) or 0;
        if (endTime - (GetTime() * 1000)) >= castPing then
            return;
        end
    end
    if not ability.DropChanel then
        local endTime = select(6, UnitChannelInfo("player")) or 0;
        if (endTime - (GetTime() * 1000)) >= castPing then
            return;
        end
    end

    if (ability.IsMovingCheck == "notmoving"  and IS_MOVING)
    or (ability.IsMovingCheck == "moving" and not IS_MOVING) then
        return;
    end

    local result = ability.Func(ability);
    if not result then
        return;
    elseif type(result) == "string" then
        ability.Target = result;
    end

    if ability.Target ~= "none" and ability.Target ~= "player" and ability.Target ~= "mouselocation" then
        if not UnitExists(ability.Target) then
            return;
        elseif ability.IsAttackedCheck and (UnitIsDeadOrGhost(ability.Target) or not UnitCanAttack("player", ability.Target)) then
            return;
        elseif ability.IsRangeCheck and SpellHasRange(spellInfo) and IsSpellInRange(spellInfo, ability.Target) ~= 1 then
            return;
        end
    end

    if ability.CencelCasting or ability.DropChanel then
        SpellStopCasting();
    end
    if ability.Target == "mouselocation" then
        local last = UnitGUID("target");
        CastSpellByName(spellInfo, nil);
        CameraOrSelectOrMoveStart();
        CameraOrSelectOrMoveStop();
        CastSpellByName(spellInfo, nil);
        if UnitGUID("target") ~= last then
            TargetLastTarget();
        end
    elseif ability.Target == "none" then
        LAST_TARGET = UnitGUID("player");
        CastSpellByName(spellInfo, nil);
    else
        LAST_TARGET = UnitGUID(ability.Target);
        CastSpellByName(spellInfo, ability.Target);
    end
    if not ability.IsNotGCD then
        return true;
    end
end

function ChangeRotation(rotation, notes)
    if AddonFrame.CurentRotation and (not rotation or rotation == AddonFrame.CurentRotation) then
        AddonFrame.CurentRotation = nil;
        AddonFrame.print("|cfff5360cРотация отключена.|r", true);
        PlaySound("PAPERDOLLCLOSE", "Master");
        if AddonFrame then
            AddonFrame:UnregisterAllEvents();
        end
    elseif rotation then
        if AddonFrame then
            AddonFrame:RegisterEvent("COMBAT_LOG_EVENT_UNFILTERED");
            AddonFrame:RegisterEvent("PLAYER_ENTERING_WORLD");
            AddonFrame:RegisterEvent("PLAYER_LOGOUT");
            AddonFrame:RegisterEvent("WORLD_MAP_UPDATE");
        end
        AddonFrame.CurentRotation = rotation;
        AddonFrame.print("|cff15bd05Ротация: |r|cff6f0a9a"..rotation.."|r|cff15bd05 - Включена.|r", true);
        local notes = strtrim(notes or '');
        if notes ~= "" then
            for _,line in ipairs({strsplit('\n', notes)}) do
                print("|cff6f0a9a"..line.."|r");
            end
        end
        PlaySound("PAPERDOLLOPEN", "Master");
    end
end

function AddonFrame_OnEvent(self, event, ...)
    if event == "PLAYER_ENTERING_WORLD" then
        self:Show();
    elseif event == "PLAYER_LOGOUT" then
        ChangeRotation();
    elseif event == "WORLD_MAP_UPDATE" then
        LOSS_TABLE = { };
    elseif event == "COMBAT_LOG_EVENT_UNFILTERED" then
        local timestamp, subEvent, hideCaster,
              sourceGUID,srcName,  sourceFlags,sourceFlags2,
              destGUID,  destName, destFlags,  destFlags2,
              spellId,   spellName,spellSchool, param15 = ...;
        if subEvent == "SPELL_CAST_SUCCESS" and sourceGUID == UnitGUID("player") then
            for i, ability in ipairs(ABILITY_TABLE) do
                if spellId == ability.SpellId and destGUID == UnitGUID(ability.Target) then
                    if ability.SetRecastDelay then
                        ability.LastCastingTime = GetTime();
                    end
                end
            end
        elseif subEvent == "SPELL_CAST_FAILED" then
            if param15 == SPELL_FAILED_LINE_OF_SIGHT then
                LOSS_TABLE[LAST_TARGET] = { ctime  = GetTime(), cspell = spellId };
            elseif param15 == SPELL_FAILED_NOT_BEHIND then
                AddonFrame.LastNotBehindTime = GetTime();
            end
        end
    end

    if type(OnEventExtended) == "function" then
        OnEventExtended(self, event, ...);
    end
end

function AddonFrame_OnUpdate(self, elapsed)
    if type(ABILITY_TABLE) == "table" and GetTime() >= (AddonFrame.LastTime or 0) then
        if AddonFrame.CurentRotation and not UnitIsDeadOrGhost("player") then
            IS_MOVING = IsMoving();
            AddonFrame.ping = select(4, GetNetStats()) / 1000;
            for _,ability in ipairs(ABILITY_TABLE) do
                if CheckAndCastAbility(ability) then
                    break;
                end
            end
        end
        AddonFrame.LastTime = GetTime() + 0.2;
    end
    if (AddonFrame.Duration or 0) < GetTime() then
        AddonFrame.Msg:SetText("");
    end
end

if not AddonFrame then
    AddonFrame = CreateFrame("Frame");
    AddonFrame:SetScript("OnUpdate", AddonFrame_OnUpdate);
    AddonFrame:SetScript("OnEvent",  AddonFrame_OnEvent);
    AddonFrame:SetHeight(300);
    AddonFrame:SetWidth(600);
    AddonFrame.Msg = AddonFrame:CreateFontString(nil, "BACKGROUND", "PVPInfoTextFont");
    AddonFrame.Msg:SetAllPoints();
    AddonFrame.print = function(msg, con)
        AddonFrame.Msg:SetText(msg);
        if con then print(msg) end
        AddonFrame.Duration = GetTime() + 5;
    end
    AddonFrame:SetPoint("CENTER", 0, 200);
    AddonFrame:Show();
end
]]></Lua>
  <Profile Class="Warrior">
    <Lua><![CDATA[
useCooldown = true;
setAoE      = nil;
isAltMod    = nil;
targetCount = 3;

kolossRem  = 0;
RB_Count   = 0;
RB_Rem     = 0;
rage       = 0;
targetHP   = 0;

koloss_remains      = 0;
bloodthirst_remains = 0;

ccIDs = {
    108194,     -- Асфиксия
    115001,     -- Беспощадность зимы
    91800,      -- Отгрызть
    91797,      -- Чудовищный удар
    102795,     -- Медвежьи объятия
    33786,      -- Смерч
    99,         -- Дезориентирующий рык
    22570,      -- Калечение
    5211,       -- Mighty Bash
    9005,       -- Pounce
    110698,     -- Hammer of Justice
    113004,     -- Intimidating Roar
    113056,     -- Intimidating Roar
    117526,     -- Binding Shot
    3355,       -- Freezing Trap
    1513,       -- Scare Beast
    19503,      -- Scatter Shot
    19386,      -- Wyvern Sting
    90337,      -- Bad Manner
    24394,      -- Intimidation
    50519,      -- Sonic Blast
    56626,      -- Sting
    118271,     -- Combustion Impact
    44572,      -- Deep Freeze
    31661,      -- Dragon's Breath
    118,        -- Polymorph
    61305,      -- Polymorph: Black Cat
    28272,      -- Polymorph: Pig
    61721,      -- Polymorph: Rabbit
    61780,      -- Polymorph: Turkey
    28271,      -- Polymorph: Turtle
    82691,      -- Ring of Frost
    123393,     -- Breath of Fire
    126451,     -- Clash
    122242,     -- Clash
    119392,     -- Charging Ox Wave
    119381,     -- Leg Sweep
    115078,     -- Paralysis
    105421,     -- Blinding Light
    115752,     -- Blinding Light
    105593,     -- Fist of Justice
    853,        -- Hammer of Justice
    119072,     -- Holy Wrath
    20066,      -- Repentance
    10326,      -- Turn Evil
    113506,     -- Cyclone
    605,        -- Dominate Mind
    64044,      -- Psychic Horror
    8122,       -- Psychic Scream
    113792,     -- Psychic Terror
    9484,       -- Shackle Undead
    87204,      -- Sin and Punishment
    2094,       -- Blind
    1833,       -- Cheap Shot
    1776,       -- Gouge
    408,        -- Kidney Shot
    113953,     -- Paralysis
    6770,       -- Sap
    76780,      -- Bind Elemental
    77505,      -- Earthquake
    51514,      -- Hex
    118905,     -- Static Charge
    118345,     -- Pulverize
    710,        -- Banish
    54786,      -- Demonic Leap
    5782,       -- Fear
    118699,     -- Fear
    5484,       -- Howl of Terror
    6789,       -- Mortal Coil
    30283,      -- Shadowfury
    104045,     -- Sleep
    89766,      -- Axe Toss
    115268,     -- Mesmerize
    6358,       -- Seduction
    7922,       -- Рывок и оглушение
    5246,       -- Устрашающий крик (Воин)
    20511,      -- Устрашающий крик
    132168,     -- Ударная волна
    105771,     -- Вестник войны
    107079,     -- Сотрясающая ладонь
    13327,      -- Безрассудный рывок
    20549       -- Громовая поступь
};

reflect_table = {
    PVP = {
        33786,  -- DRUID (Cyclone)
        28272,  -- MAGE (All Polymorphs / Frost Bomb / Arcane Blast)
        118,
        61305,
        61721,
        61780,
        28271,
        113092,
        30451,
        20066,  -- PALADIN (Repentance)
        605,    -- PRIEST (Mind Control)
        51514,  -- SHAMAN (Hex)
        51505,  -- SHAMAN (Lava Burst)
        5782,   -- WARLOCK (Fear / Chaos Bolt)
        118699,
        116858
    },
    RAIDS = {
        144214, -- Стрела ледяной бури (Кор'кронские Тёмные Шаманы)
    }
};

function FillFurryData()
     -- Удар колосса
    koloss,_,kolossRem = HasDebuff("target", 86346, "PLAYER");
    -- Яростный выпад!
    ragingBlow,RB_Count,RB_Rem = HasBuff("player", 131116);
    -- Кровавый фарш
    meat_cleaver, meat_cleaver_couunt = HasBuff("player", 12950);

    rage = UnitPower("player");
    targetHP   = HealthByPercent("target");

    -- кулдаун колосса
    koloss_remains = SpellCD(86346);
    -- кулдаун кровожадности
    bloodthirst_remains = SpellCD(23881);
end

function NeedReflect(unit)
    if UnitIsEnemy("player", unit) and UnitIsUnit("player", unit.."target") then
        local name,_,_,_,_,endTime = UnitCastingInfo(unit);
        if name and (((endTime / 1000) - GetTime()) - AddonFrame.ping) <= 2 then
            if UnitIsPVP("player") then
                for _,spell_id in ipairs(reflect_table.PVP) do
                    if name == GetSpellInfo(spell_id) then
                        return true;
                    end
                end
            else
                for _,spell_id in ipairs(reflect_table.RAIDS) do
                    if name == GetSpellInfo(spell_id) then
                        return true;
                    end
                end
            end
        end
    end
end

function NeedMassReflect(unit)
    local reflect_buff = { 23920, 114028 };
    if not HasBuff("player", reflect_buff) or SpellCD(23920) > 0 then
        return NeedReflect(unit);
    end
end
]]></Lua>
    <RotationList>
      <Rotation Name="Неистовство">
        <HotKey Key="Z" Modifier="Alt" />
        <AbilityList>
          <Ability Name="Инициализация">
            <SpellID>0</SpellID>
            <Target>None</Target>
            <CancelChannel>true</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- модификатор
if     IsModKeyDown(mkLeftShift) then
elseif IsModKeyDown(mkLeftControl) then
    -- setAoE = 0   - solo
    -- setAoE = 2   - 2-3 target's
    -- setAoE = 3   - >4 target's
    setAoE = setAoE or 0;
    if setAoE == 0 then
        setAoE = 2;
        AddonFrame.print("|cff6f0a9a Несколько целей", true);
    elseif setAoE == 2 then
        setAoE = 3;
        AddonFrame.print("|cffff0000 AOE", true);
    else
        setAoE = 0;
        AddonFrame.print("|cff00ff00 Одиночная цель", true);
    end
elseif IsModKeyDown(mkLeftAlt) then
    return true;
elseif IsModKeyDown(mkRightShift) then
    if useCooldown then
        useCooldown = false;
        AddonFrame.print("|cffff0000Кулдауны выключены", true);
    else
        useCooldown = true;
        AddonFrame.print("|cff00ff00Кулдауны включены", true);
    end
elseif IsModKeyDown(mkRightControl) then
elseif IsModKeyDown(mkRightAlt) then
end

-- если персонаж на маунте, тогда не выполняем ротацию дальше
if IsMounted() or IsStealthed() then
    return true;
end

-- Перейти в боевую стойку
--if GetSpecialization() ~= 3 and GetShapeshiftForm() ~= 1 then
--    CastShapeshiftForm(1);
--end

-- камень здоровья
if HealthByPercent("player") < 30 then
    UseItemById(5512);
end

FillFurryData();
playerHP   = HealthByPercent("player");
isInMeele  = IsSpellInRange(GetSpellInfo(78), "target") == 1;
]]></Lua>
          </Ability>
          <Ability Name="Победный раж">
            <SpellID>34428</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return playerHP <= 80;
]]></Lua>
          </Ability>
          <Ability Name="Зуботычина">
            <SpellID>6552</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return CheckInterrupt("target");
]]></Lua>
          </Ability>
          <Ability Name="Разрушительный крик">
            <SpellID>102060</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if isInMeele and SpellCD(6552) > 0 and CheckInterrupt("target") then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Героический прыжок">
            <SpellID>6544</SpellID>
            <Target>MouseLocation</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return IsModKeyDown(mkLeftShift);
]]></Lua>
          </Ability>
          <Ability Name="Сокрушительный Бросок">
            <SpellID>64382</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return IsModKeyDown(mkRightControl);
]]></Lua>
          </Ability>
          <Ability Name="Безразсудство">
            <SpellID>1719</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if useCooldown and isInMeele and (kolossRem >= 5 or koloss_remains <= 4 or SpellCD(12292) <= 3) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Кровавая баня">
            <SpellID>12292</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if useCooldown and isInMeele and koloss_remains < 1 and (HasBuff("player", 1719) or SpellCD(1719) > 60) then
    UseItemBySlot(INVSLOT_TRINKET1);
    UseItemBySlot(INVSLOT_TRINKET2);
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Ярость берсерка">
            <SpellID>18499</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if UnitIsPVP("player") then
--    if HasFullControl() then
--        return true;
    if HasDebuff("player", ccIDs) then
        return true;
    end
elseif isInMeele and not HasBuff("player", 12880) and not HasBuff("player", 131116) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Знамя с черепом">
            <SpellID>114207</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if useCooldown and isInMeele and (kolossRem >= 5 or koloss_remains <= 4 or SpellCD(12292) <= 3) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Вихрь">
            <SpellID>1680</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
local setAoE = setAoE or 0;
if isInMeele then
    if setAoE == 3 then
        return true;
    elseif setAoE == 2 then
        local name,count = HasBuff("player", 12950);
        if count < 2 then
            return true;
        end
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Удар героя">
            <SpellID>78</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if (setAoE or 0) == 0 and ((targetHP >= 20 and ( HasDebuff("target", 86346, "PLAYER") and rage >= 40 )) or rage >= 110) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Разсекающий удар">
            <SpellID>845</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if (setAoE or 0) == 2 and ((targetHP >= 20 and ( HasDebuff("target", 86346, "PLAYER") and rage >= 40 )) or rage >= 110) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Яростный выпад">
            <SpellID>85288</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if ragingBlow and (koloss or HasBuff("player", { 12292, 1719 })) then
    return true;
elseif koloss_remains >= 6 or RB_Rem <= 6 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Казнь">
            <SpellID>5308</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return true;
]]></Lua>
          </Ability>
          <Ability Name="Зверский удар (1)">
            <SpellID>100130</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if HasBuff("player", 46916) and targetHP >= 20 and SpellCD(23881) > 0 and SpellCD(23881) <= 1 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Удар колосса">
            <SpellID>86346</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return true;
]]></Lua>
          </Ability>
          <Ability Name="Рев дракона">
            <SpellID>118000</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if isInMeele and not koloss and HasBuff("player", 12292) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Кровожадность">
            <SpellID>23881</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if not (targetHP < 20  and HasDebuff("target", 86346, "PLAYER") and rage >= 30) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Зверский удар (2)">
            <SpellID>100130</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if HasBuff("player", 46916) and targetHP >= 20 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Героический бросок">
            <SpellID>57755</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return true;
]]></Lua>
          </Ability>
          <Ability Name="Зверский удар (3)">
            <SpellID>100130</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if (koloss and targetHP >= 20) or (koloss_remains >= 1 and rage >= 80 and targetHP >= 20) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Командирский крик">
            <SpellID>469</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
local ap_buffs = {
    6673,   -- Боевой крик (Воин)
    57330,  -- Зимний горн (Рыцарь смерти)
    19506   -- Аура меткого выстрела (Охотник)
};
if rage < 70 then
    if HasBuff("player", ap_buffs) and not HasBuff("player", 6673, "PLAYER") then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Боевой крик ">
            <SpellID>6673</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return rage < 70;
]]></Lua>
          </Ability>
        </AbilityList>
      </Rotation>
      <Rotation Name="Защита">
        <HotKey Key="X" Modifier="Alt" />
        <AbilityList>
          <Ability Name="Инициализация">
            <SpellID>0</SpellID>
            <Target>None</Target>
            <CancelChannel>true</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- модификатор
if     IsModKeyDown(mkLeftShift) then
elseif IsModKeyDown(mkLeftControl) then
    if setAoE then
        setAoE = false;
        AddonFrame.print("|cff00ff00 Одиночная цель", true);
    else
        setAoE = true;
        AddonFrame.print("|cffff0000 AOE", true);
    end
elseif IsModKeyDown(mkLeftAlt) then
    return true;
elseif IsModKeyDown(mkRightShift) then
    if useCooldown then
        useCooldown = false;
        AddonFrame.print("|cffff0000Кулдауны выключены", true);
    else
        useCooldown = true;
        AddonFrame.print("|cff00ff00Кулдауны включены", true);
    end
elseif IsModKeyDown(mkRightControl) then
elseif IsModKeyDown(mkRightAlt)     then
    if isAltMod then
        isAltMod = false;
        AddonFrame.print("|cffff0000Используется блок щитом", true);
    else
        isAltMod = true;
        AddonFrame.print("|cff00ff00Используется непроницаемый щит", true);
    end
end

-- если персонаж на маунте, тогда не выполняем ротацию дальше
if IsMounted() or IsStealthed() then
    return true;
end

-- Перейти в стойку защиты
if GetSpecialization() == 3 and GetShapeshiftForm() ~= 2 then
    CastShapeshiftForm(2);
end

-- камень здоровья
if HealthByPercent("player") < 30 then
    UseItemById(5512);
end

agroStatus = UnitThreatSituation("player") or 0;
isInMeele  = IsSpellInRange(GetSpellInfo(78), "target") == 1;
hasAPbuff  = HasBuff("player", { 57330, 19506});
playerHP   = HealthByPercent("player");
rage       = UnitPower("player");
]]></Lua>
          </Ability>
          <Ability Name="Героический прыжок">
            <SpellID>6544</SpellID>
            <Target>MouseLocation</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if IsModKeyDown(mkLeftShift) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Зуботычина">
            <SpellID>6552</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return CheckInterrupt("target");
]]></Lua>
          </Ability>
          <Ability Name="Разрушительный крик">
            <SpellID>102060</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if isInMeele and SpellCD(6552) > 0 and CheckInterrupt("target") then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Победный раж">
            <SpellID>34428</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if playerHP <= 80 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Непроницаемый щит">
            <SpellID>112048</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if rage > 55 and agroStatus > 2 then
    if not HasBuff("player", 112048) then
        local vengens = select(5, HasBuff("player", 93098)) or 0;
        if isAltMod then
            return true;
        elseif playerHP < 60 then
            return true;
        elseif vengens > 100000 then
            return true;
        end
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Глухая оборона">
            <SpellID>871</SpellID>
            <Target>None</Target>
            <CancelChannel>true</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if playerHP < 30 and agroStatus > 2 and useCooldown then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Одобряющий клич">
            <SpellID>97462</SpellID>
            <Target>None</Target>
            <CancelChannel>true</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if isInCombat and playerHP < 25 and useCooldown then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Ни шагу назад">
            <SpellID>12975</SpellID>
            <Target>None</Target>
            <CancelChannel>true</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if playerHP < 20 and agroStatus > 2 and useCooldown then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Деморализующий крик">
            <SpellID>1160</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if playerHP <= 50 and isInMeele and useCooldown then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Блок щитом">
            <SpellID>2565</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if rage >= 60 and agroStatus > 2 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Сокрушительный Бросок">
            <SpellID>64382</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- 5 - RightControl
if IsModKeyDown(5) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Кровавая баня">
            <SpellID>12292</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if useCooldown and isInMeele and agroStatus > 2 then
    if UnitHealth(ability.Target) > (UnitHealthMax("player") * 3) then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Мощный удар щитом">
            <SpellID>23922</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return true;
]]></Lua>
          </Ability>
          <Ability Name="Казнь">
            <SpellID>5308</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if UnitIsPlayer(ability.Target) then
    return true;
elseif rage > 60 and (playerHP > 70 or agroStatus < 3) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Отражение заклинания">
            <SpellID>23920</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- Код профиля
return NeedReflect(ability.Target);
]]></Lua>
          </Ability>
          <Ability Name="Массовое отражение заклинаний">
            <SpellID>114028</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- Код профиля
return NeedMassReflect(ability.Target);
]]></Lua>
          </Ability>
          <Ability Name="Подрезать сухожилья">
            <SpellID>1715</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if UnitIsPlayer(ability.Target) and not HasDebuff(ability.Target, 1715) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Обезоруживание">
            <SpellID>676</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if UnitIsPlayer(ability.Target) then
    local class = select(2, UnitClass(ability.Target));
    if  (class == "WARRIOR") or
        (class == "PALDIN")  or
        (class == "ROGUE")   or
        (class == "SHAMAN")  or
        (class == "DEATHKNIGHT") then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Удар грома (AOE)">
            <SpellID>6343</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if isInMeele and setAoE then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Реванш">
            <SpellID>6572</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return true;
]]></Lua>
          </Ability>
          <Ability Name=" Удар героя">
            <SpellID>78</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- Это заклинание не затрагивает ГКД
-- есть баф на использование бесплатного удара (Ультиматум - 122510)
if UnitIsPlayer(ability.Target) and HealthByPercent(ability.Target) > 20 then
    return true;
elseif not setAoE and (HasBuff("player", 122510) or ((rage > 90 or agroStatus < 2) and not IsUsableSpell(5308))) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Разсекающий удар">
            <SpellID>845</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- Это заклинание не затрагивает ГКД
-- есть баф на использование бесплатного удара (Ультиматум - 122510)
if setAoE and (HasBuff("player", 122510) or rage > 90 or agroStatus < 2) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Удар грома (SOLO)">
            <SpellID>6343</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if not HasDebuff("target", 115798) then
    return isInMeele;
end
]]></Lua>
          </Ability>
          <Ability Name="Командирский крик">
            <SpellID>469</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
local ap_buffs = {
    6673,   -- Боевой крик (Воин)
    57330,  -- Зимний горн (Рыцарь смерти)
    19506   -- Аура меткого выстрела (Охотник)
};
if rage < 70 and not koloss then
    if HasBuff("player", ap_buffs) and not HasBuff("player", 6673, "PLAYER") then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Боевой крик">
            <SpellID>6673</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if rage < 70 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name=" Ярость берсерка">
            <SpellID>18499</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if UnitIsPVP("player") then
--    if HasFullControl() then
--        return true;
    if HasDebuff("player", ccIDs) then
        return true;
    end
elseif isInMeele and rage < 20 and not HasBuff("player", 12880) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Сокрушение">
            <SpellID>20243</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return isInMeele;
]]></Lua>
          </Ability>
        </AbilityList>
      </Rotation>
      <Rotation Name="Оружие">
        <HotKey Key="C" Modifier="Alt" />
        <AbilityList>
          <Ability Name="Инициализация">
            <SpellID>0</SpellID>
            <Target>None</Target>
            <CancelChannel>true</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- модификатор
if type(setAoE) ~= "number" then
    setAoE = 0;
end

if     IsModKeyDown(mkLeftShift) then
elseif IsModKeyDown(mkLeftControl) then
    setAoE = setAoE or 0;
    if setAoE == 0 then
        setAoE = 2;
        AddonFrame.print("|cff6f0a9a Несколько целей 2", true);
    elseif setAoE == 2 then
        setAoE = 3;
        AddonFrame.print("|cff6f0a9a Несколько целей 3", true);
    elseif setAoE == 3 then
        setAoE = 4;
        AddonFrame.print("|cffff0000 AOE", true);
    else
        setAoE = 0;
        AddonFrame.print("|cff00ff00 Одиночная цель", true);
    end
elseif IsModKeyDown(mkLeftAlt) then
    return true;
elseif IsModKeyDown(mkRightShift) then
    if useCooldown then
        useCooldown = false;
        AddonFrame.print("|cff00ff00Кулдауны включены", true);
    else
        useCooldown = true;
        AddonFrame.print("|cffff0000Кулдауны выключены", true);
    end
elseif IsModKeyDown(mkRightControl) then
elseif IsModKeyDown(mkRightAlt) then
end

-- если персонаж на маунте, тогда не выполняем ротацию дальше
if IsMounted() or IsStealthed() then
    return true;
end

-- Перейти в боевую стойку
--if GetSpecialization() ~= 3 and GetShapeshiftForm() ~= 1 then
--    CastShapeshiftForm(1);
--end

-- камень здоровья
if HealthByPercent("player") < 30 then
    UseItemById(5512);
end

rage       = UnitPower("player");
playerHP   = HealthByPercent("player");
targetHP   = HealthByPercent("target");
isInMeele  = IsSpellInRange(GetSpellInfo(78), "target") == 1;
koloss,_,kolossRem = HasDebuff("target", 86346, "PLAYER");
koloss_cd  = SpellCD(86346);
]]></Lua>
          </Ability>
          <Ability Name="Героический прыжок">
            <SpellID>6544</SpellID>
            <Target>MouseLocation</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if IsModKeyDown(mkLeftShift) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Победный раж">
            <SpellID>34428</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if playerHP <= 80 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Зуботычина">
            <SpellID>6552</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return CheckInterrupt("target");
]]></Lua>
          </Ability>
          <Ability Name="Отражение заклинания">
            <SpellID>23920</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- Код профиля
return NeedReflect(ability.Target);
]]></Lua>
          </Ability>
          <Ability Name="Массовое отражение заклинаний">
            <SpellID>114028</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- Код профиля
return NeedMassReflect(ability.Target);
]]></Lua>
          </Ability>
          <Ability Name="Подрезать сухожилья">
            <SpellID>1715</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if UnitIsPlayer(ability.Target) and not HasDebuff(ability.Target, 1715) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Разрушительный крик">
            <SpellID>102060</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if isInMeele and SpellCD(6552) > 0 and CheckInterrupt("target") then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Кровавая Баня">
            <SpellID>12292</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if isInMeele and useCooldown and (koloss_cd < 2 or kolossRem > 4) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Ярость Берсерка">
            <SpellID>18499</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if UnitIsPVP("player") then
--    if HasFullControl() then
--        return true;
    if HasDebuff("player", ccIDs) then
        return true;
    end
elseif isInMeele and rage < 20 and not HasBuff("player", 12880) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Размашистые удары">
            <SpellID>12328</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if setAoE > 0 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Удар грома">
            <SpellID>6343</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if setAoE > 3 and isInMeele and not HasDebuff("target", 115767, "PLAYER") then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Вихрь">
            <SpellID>1680</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if setAoE > 3 and isInMeele then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Смертельный удар">
            <SpellID>12294</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return true;
]]></Lua>
          </Ability>
          <Ability Name=" Удар колосса">
            <SpellID>86346</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if kolossRem <= 1 and kolossRem < 1 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Рев дракона">
            <SpellID>118000</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if isInMeele and not koloss then
    if HasBuff("player", 12292) then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Казнь">
            <SpellID>5308</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if setAoE < 4 and (not HasBuff("player", 29725) or not HasBuff("player", 60503) or rage > 70) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Превосходство">
            <SpellID>7384</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if rage >= 10 and targetHP >= 20 or HasBuff("player", 29725) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Удар героя">
            <SpellID>78</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if setAoE < 3 and ((HasGlyph(4339) and rage > 115) or rage > 85) or (kolossRem > 0 and rage > 40) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Разсекающий удар">
            <SpellID>845</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if setAoE > 2 and ((HasGlyph(4339) and rage > 115) or rage > 85) or (kolossRem > 0 and rage > 40) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Мощный удар">
            <SpellID>1464</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if rage > 35 then
    if setAoE and (kolossRem > 0 or HasBuff("player", 12328)) then -- Размашистые удары
        return true;
    elseif not setAoE and (kolossRem > 0 and select(3, HasBuff("player", 60503)) < 3) and targetHP >= 20 then -- Вкус крови
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Командирский крик">
            <SpellID>6673</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
local ap_buffs = {
    6673,   -- Боевой крик (Воин)
    57330,  -- Зимний горн (Рыцарь смерти)
    19506   -- Аура меткого выстрела (Охотник)
};
if rage < 70 then
    if HasBuff("player", ap_buffs) and not HasBuff("player", 6673, "PLAYER") then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Боевой крик">
            <SpellID>6673</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if rage < 70 then
    return true;
end
]]></Lua>
          </Ability>
        </AbilityList>
      </Rotation>
    </RotationList>
  </Profile>
  <Profile Class="Paladin">
    <Lua><![CDATA[
agroStatus  = 0;
useCooldown = true;
setAoE      = nil;
]]></Lua>
    <RotationList>
      <Rotation Name="Защита">
        <HotKey Key="X" Modifier="Alt" />
        <AbilityList>
          <Ability Name="Инициализация">
            <SpellID>0</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- модификатор5
if     IsModKeyDown(mkLeftShift) then
elseif IsModKeyDown(mkLeftControl) then
    if setAoE then
        setAoE = false;
        AddonFrame.print("|cff00ff00 >> Одиночная цель", true);
    else
        setAoE = true;
        AddonFrame.print("|cffff0000 >> AOE", true);
    end
elseif IsModKeyDown(mkLeftAlt) then
    return true;
elseif IsModKeyDown(mkRightShift) then
    if useCooldown then
        useCooldown = false;
        AddonFrame.print("|cffff0000Кулдауны выключены", true);
    else
        useCooldown = true;
        AddonFrame.print("|cff00ff00Кулдауны включены", true);
    end
elseif IsModKeyDown(mkRightControl) then
elseif IsModKeyDown(mkRightAlt) then
end

-- если персонаж на маунте, тогда не выполняем ротацию дальше
if IsMounted() or IsStealthed() then
    return true;
end

-- камень здоровья
if HealthByPercent("player") < 30 then
    UseItemById(5512);
end

agroStatus = UnitThreatSituation("player");
isInMeele  = IsSpellInRange(GetSpellInfo(35395), "target") == 1;
playerHP   = HealthByPercent("player");
hollyPower = UnitPower("player", SPELL_POWER_HOLY_POWER);

divine_purpose = HasBuff("player", 90174);  -- Божественный замысел
holy_avenger   = HasBuff("player", 105809); -- Святая клятва
inquisition,_,inquisition_rem = HasBuff("player", 84963); -- дознание
]]></Lua>
          </Ability>
          <Ability Name="Щит небес">
            <SpellID>20925</SpellID>
            <Target>Player</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if not HasBuff("player", 20925, "PLAYER") then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Торжество">
            <SpellID>130551</SpellID>
            <Target>Player</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if playerHP < 70 then
    if divine_purpose or hollyPower > 2 then
        -- Бастион славы (114637)
        if (select(2, HasBuff("player", 114637)) or 0) > 4 then
            return true;
        end
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Щит праведника">
            <SpellID>53600</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if divine_purpose or hollyPower > 2 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Ревностный защитник">
            <SpellID>31850</SpellID>
            <Target>Player</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if playerHP < 15 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Защитник древних королей">
            <SpellID>86659</SpellID>
            <Target>Player</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if playerHP < 40 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Божественная защита">
            <SpellID>498</SpellID>
            <Target>Player</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if playerHP < 60 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Молот праведника">
            <SpellID>53595</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- Должен быть дебаф на Слабые Удары (115798)
return setAoE or not HasDebuff("target", 115798);
]]></Lua>
          </Ability>
          <Ability Name="Удар воина света">
            <SpellID>35395</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return not setAoE;
]]></Lua>
          </Ability>
          <Ability Name="Молот гнева">
            <SpellID>24275</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return true;
]]></Lua>
          </Ability>
          <Ability Name="Божественная призма">
            <SpellID>114165</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return true;
]]></Lua>
          </Ability>
          <Ability Name="Щит мстителя">
            <SpellID>31935</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return true;
]]></Lua>
          </Ability>
          <Ability Name="Правосудие">
            <SpellID>20271</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return true;
]]></Lua>
          </Ability>
          <Ability Name="Освящение">
            <SpellID>26573</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if isInMeele and not HasDebuff("target", 26573, "PLAYER") then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Гнев небес">
            <SpellID>119072</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return isInMeele;
]]></Lua>
          </Ability>
          <Ability Name="Праведное неистовство">
            <SpellID>25780</SpellID>
            <Target>Player</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if not HasBuff("player", 25780) then
    return true;
end
]]></Lua>
          </Ability>
        </AbilityList>
      </Rotation>
      <Rotation Name="Лекарь">
        <HotKey Key="Z" Modifier="Alt" />
        <AbilityList />
      </Rotation>
      <Rotation Name="Воздаяние">
        <HotKey Key="C" Modifier="Alt" />
        <AbilityList>
          <Ability Name="Инициализация">
            <SpellID>0</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- модификатор5
if     IsModKeyDown(mkLeftShift) then
elseif IsModKeyDown(mkLeftControl) then
    if setAoE then
        setAoE = false;
        AddonFrame.print("|cff00ff00 >> Одиночная цель", true);
    else
        setAoE = true;
        AddonFrame.print("|cffff0000 >> AOE", true);
    end
elseif IsModKeyDown(mkLeftAlt) then
    return true;
elseif IsModKeyDown(mkRightShift) then
    if useCooldown then
        useCooldown = false;
        AddonFrame.print("|cffff0000Кулдауны выключены", true);
    else
        useCooldown = true;
        AddonFrame.print("|cff00ff00Кулдауны включены", true);
    end
elseif IsModKeyDown(mkRightControl) then
elseif IsModKeyDown(mkRightAlt) then
end

-- если персонаж на маунте, тогда не выполняем ротацию дальше
if IsMounted() or IsStealthed() then
    return true;
end

-- камень здоровья
if HealthByPercent("player") < 30 then
    UseItemById(5512);
end

agroStatus = UnitThreatSituation("player");
isInMeele  = IsSpellInRange(GetSpellInfo(35395), "target") == 1;
playerHP   = HealthByPercent("player");
hollyPower = UnitPower("player", SPELL_POWER_HOLY_POWER);

divine_purpose = HasBuff("player", 90174);  -- Божественный замысел
holy_avenger   = HasBuff("player", 105809); -- Святая клятва
inquisition,_,inquisition_rem = HasBuff("player", 84963); -- дознание
]]></Lua>
          </Ability>
          <Ability Name="Дознание">
            <SpellID>84963</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if hollyPower > 2 and inquisition_rem <= 2 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Гнев карателя">
            <SpellID>31884</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if useCooldown and inquisition then
    if SpellCD(86698) < 291 then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Защитник древних королей">
            <SpellID>86698</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if useCooldown and inquisition then
    if SpellCD(31884) < 10 then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Святая клятва">
            <SpellID>105809</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if useCooldown and inquisition and hollyPower <= 2 then
    if SpellCD(86698) < 289 then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Смертный приговор">
            <SpellID>114157</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if useCooldown and inquisition then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Вердикт храмовника (1)">
            <SpellID>85256</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if not setAoE then
    if hollyPower > 4 or (hollyPower > 1 and holy_avenger) then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Божественная буря">
            <SpellID>53385</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if setAoE then
    if hollyPower > 4 or (hollyPower > 1 and holy_avenger) then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Молот гнева">
            <SpellID>24275</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return true;
]]></Lua>
          </Ability>
          <Ability Name="Экзорцизм">
            <SpellID>879</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return true;
]]></Lua>
          </Ability>
          <Ability Name="Удар воина Света">
            <SpellID>35395</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return not setAoE;
]]></Lua>
          </Ability>
          <Ability Name="Молот праведника">
            <SpellID>53595</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return setAoE;
]]></Lua>
          </Ability>
          <Ability Name="Правосудие">
            <SpellID>20271</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return true;
]]></Lua>
          </Ability>
          <Ability Name="Вердикт храмовника (2)">
            <SpellID>85256</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if not setAoE and hollyPower > 2 then
    return true;
end
]]></Lua>
          </Ability>
        </AbilityList>
      </Rotation>
    </RotationList>
  </Profile>
  <Profile Class="Hunter">
    <Lua><![CDATA[
useCooldown = true;
setAoE      = nil;
isAltMod    = nil;
]]></Lua>
    <RotationList>
      <Rotation Name="PVE Выживание">
        <HotKey Key="X" Modifier="Alt" />
        <AbilityList>
          <Ability Name="Инициализация">
            <SpellID>0</SpellID>
            <Target>None</Target>
            <CancelChannel>true</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- модификатор
if     IsModKeyDown(mkLeftShift) then
elseif IsModKeyDown(mkLeftControl) then
    if setAoE then
        setAoE = false;
        AddonFrame.print("|cff00ff00 Одиночная цель", true);
    else
        setAoE = true;
        AddonFrame.print("|cffff0000 AOE", true);
    end
elseif IsModKeyDown(mkLeftAlt) then
    StopAttack();
    PetStopAttack();
    -- перейдем в аспект ястребя
    if GetShapeshiftForm() ~= 1 then
        CastShapeshiftForm(1);
    end
    return true;
elseif IsModKeyDown(mkRightShift) then
    if useCooldown then
        useCooldown = false;
        AddonFrame.print("|cffff0000Кулдауны выключены", true);
    else
        useCooldown = true;
        AddonFrame.print("|cff00ff00Кулдауны включены", true);
    end
elseif IsModKeyDown(mkRightControl) then
elseif IsModKeyDown(mkRightAlt) then
end

-- если в комуфляже или притворились мертвыми или "Слился с тенью"
if HasBuff("player", { 5384, 51755, 58984 }) then
    return true;
end

unitFocus = UnitPower("player");

-- При проке "На изготовку" прерываем чтение "Выстрел кобры"
if not setAoE and UnitCastingInfo("player") == GetSpellInfo(77767) then
    if HasBuff("player", 56453) then
        SpellStopCasting();
    end
end

-- Установка пета в указанную позицию
if IsMouseButtonDown(4) then
    PetMoveTo();
    CameraOrSelectOrMoveStart();
    CameraOrSelectOrMoveStop();
    PetMoveTo();
end
]]></Lua>
          </Ability>
          <Ability Name="Дух ястреба">
            <SpellID>0</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if UnitAffectingCombat("player") or IsMounted() then
    if GetShapeshiftForm() ~= 1 and GetShapeshiftFormCooldown(1) == 0 then
        CastShapeshiftForm(1);
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Дух гепарда">
            <SpellID>0</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if not UnitAffectingCombat("player") and not IsMounted() then
    if GetShapeshiftForm() ~= 2 and GetShapeshiftFormCooldown(2) == 0 then
        CastShapeshiftForm(2);
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Метание ловушки">
            <SpellID>77769</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return not HasBuff("player", 77769);
]]></Lua>
          </Ability>
          <Ability Name="Взрывная ловушка">
            <SpellID>82939</SpellID>
            <Target>MouseLocation</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return IsModKeyDown(mkLeftShift);
]]></Lua>
          </Ability>
          <Ability Name="Ледяная ловушка">
            <SpellID>82941</SpellID>
            <Target>MouseLocation</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return IsModKeyDown(mkRightAlt);
]]></Lua>
          </Ability>
          <Ability Name="Замораживающая ловушка">
            <SpellID>60192</SpellID>
            <Target>MouseLocation</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return IsModKeyDown(mkRightControl);
]]></Lua>
          </Ability>
          <Ability Name="Триньки/перчатки">
            <SpellID>0</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- если персонаж на маунте, тогда не выполняем ротацию дальше
if IsMounted() or IsStealthed() then
    return true;
end

-- камень здоровья
if HealthByPercent("player") < 30 then
    UseItemById(5512);
end

if useCooldown then
    UseItemBySlot(INVSLOT_HAND);
    UseItemBySlot(INVSLOT_TRINKET1);
    UseItemBySlot(INVSLOT_TRINKET2);
end
]]></Lua>
          </Ability>
          <Ability Name="Усмиряющий выстрел">
            <SpellID>19801</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if CheckEnrage(ability.Target) then
    print("|cff15bd05>> Снимаю исступление!");
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Лечение питомца">
            <SpellID>136</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
local pethp = HealthByPercent("pet");
if pethp ~= 0 and pethp < 75 then
    if not HasBuff("pet", 136) then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Убийственный выстрел">
            <SpellID>53351</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if UnitLevel("player") >= 35 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Залп">
            <SpellID>2643</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return setAoE;
]]></Lua>
          </Ability>
          <Ability Name="Разрывной выстрел">
            <SpellID>53301</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return true;
]]></Lua>
          </Ability>
          <Ability Name="Черная стрела">
            <SpellID>3674</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return not setAoE;
]]></Lua>
          </Ability>
          <Ability Name="Укус змеи">
            <SpellID>1978</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if not setAoE and not HasDebuff(ability.Target, 118253, "PLAYER") then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Бросок глеф">
            <SpellID>117050</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return unitFocus >= 15;
]]></Lua>
          </Ability>
          <Ability Name="Ужасный зверь">
            <SpellID>120679</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return useCooldown;
]]></Lua>
          </Ability>
          <Ability Name="Быстрая стрельба">
            <SpellID>3045</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return useCooldown;
]]></Lua>
          </Ability>
          <Ability Name="Звериный натиск">
            <SpellID>121818</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return useCooldown;
]]></Lua>
          </Ability>
          <Ability Name="Стая воронов">
            <SpellID>131894</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return useCooldown;
]]></Lua>
          </Ability>
          <Ability Name="Чародейский выстрел">
            <SpellID>3044</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if not setAoE and unitFocus > 35 then
    --local lowHP = (UnitHealth(ability.Target) or 0) < (UnitHealthMax("player") * 3);
    -- Если Стая воронов скоро откатится, копим для нее концентрацию
    if useCooldown and IsPlayerSpell(131894) and SpellCD(131894) < 2 then
        return;
    end
    -- Если Черная стрела скоро откатится, копим для нее концентрацию
    if IsPlayerSpell(3674) and SpellCD(3674) < 2 then
        return;
    end
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Выстрел кобры">
            <SpellID>77767</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return IsSpellInRange(GetSpellInfo(3044), "target") == 1;
]]></Lua>
          </Ability>
        </AbilityList>
      </Rotation>
      <Rotation Name="Повелитель зверей">
        <HotKey Key="C" Modifier="Alt" />
        <AbilityList />
      </Rotation>
      <Rotation Name="Стрельба">
        <HotKey Key="V" Modifier="Alt" />
        <AbilityList />
      </Rotation>
      <Rotation Name="Farm">
        <HotKey Key="B" Modifier="Alt" />
        <AbilityList>
          <Ability Name="Укус змеи">
            <SpellID>1978</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- 64399 Боевой штандарт координации
UseItemById(64399);
TargetNearestEnemy();
if UnitExists("target") and not UnitIsDeadOrGhost("target") then
    if IsSpellInRange(GetSpellInfo(3044), "target") == 1 then
        StartAttack("target");
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Выстрел кобры">
            <SpellID>77767</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
TargetNearestEnemy();
if UnitExists("target") and not UnitIsDeadOrGhost("target") then
    if IsSpellInRange(GetSpellInfo(3044), "target") == 1 then
        StartAttack("target");
        return true;
    end
end
]]></Lua>
          </Ability>
        </AbilityList>
      </Rotation>
    </RotationList>
  </Profile>
  <Profile Class="Rogue">
    <Lua><![CDATA[
invisible     = false;
setAoE        = false;
useCooldown   = true;
]]></Lua>
    <RotationList>
      <Rotation Name="Бой">
        <HotKey Key="Z" Modifier="Alt" />
        <AbilityList>
          <Ability Name="Инициализаця">
            <SpellID>0</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- модификатор
if     IsModKeyDown(mkLeftShift) then
elseif IsModKeyDown(mkLeftControl) then
    if setAoE then
        setAoE = false;
        AddonFrame.print("|cff00ff00 >> Одиночная цель", true);
    else
        setAoE = true;
        AddonFrame.print("|cffff0000 >> AOE", true);
    end
elseif IsModKeyDown(mkLeftAlt) then
    return true;
elseif IsModKeyDown(mkRightShift) then
    if useCooldown then
        useCooldown = false;
        AddonFrame.print("|cffff0000Кулдауны выключены", true);
    else
        useCooldown = true;
        AddonFrame.print("|cff00ff00Кулдауны включены", true);
    end
elseif IsModKeyDown(mkRightControl) then
    if invisible then
        invisible = false;
        AddonFrame.print("|cffff0000Незаметность выключена", true);
    else
        invisible = true;
        AddonFrame.print("|cff00ff00Незаметность включена", true);
    end
elseif IsModKeyDown(mkRightAlt) then
end

-- если персонаж на маунте, тогда не выполняем ротацию дальше
if IsMounted() or IsStealthed() then
    return true;
end

-- камень здоровья
if HealthByPercent("player") < 30 then
    UseItemById(5512);
end

-- Если мы в скрытности, то всегда, если возможно прыгаем в форму незаметности
if GetSpecialization() == 3 then
    if GetShapeshiftForm() ~= 1 then
        local start, duration, enable = GetShapeshiftFormCooldown(1);
        if enable == 1 and start == 0 then
            CastShapeshiftForm(1);
        end
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Смертоносный яд">
            <SpellID>2823</SpellID>
            <Target>Player</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>true</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>NotMoving</IsMovingCheck>
            <Lua><![CDATA[
if not (UnitAffectingCombat("player") or HasBuff("player", 2823)) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Веер клинков">
            <SpellID>51723</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if IsModKeyDown(mkLeftShift) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Внезапный удар">
            <SpellID>8676</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if GetShapeshiftForm() == 1 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Заживление ран">
            <SpellID>73651</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if GetComboPoints("player") > 4 and HealthByPercent("player") < 80 then
    if not HasBuff("target", 73651, "PLAYER") then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Нахождение в скрытности">
            <SpellID>0</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if GetShapeshiftForm() == 1 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Мясорубка ">
            <SpellID>5171</SpellID>
            <Target>Player</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
local name, count, rem = HasBuff("player", 5171);

if rem == 0 then
    return true;
end

if UnitExists("target") and GetComboPoints("player", "target") > 4 then
    if rem < 4 then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Пробивающий удар">
            <SpellID>84617</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if not HasDebuff("target", 84617, "PLAYER") then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Потрошение">
            <SpellID>2098</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if GetComboPoints("player", "target") > 4 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Рваная рана">
            <SpellID>1943</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if GetComboPoints("player", "target") > 4 then
    if not HasDebuff("target", 1943, "PLAYER") then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Коварный удар">
            <SpellID>1752</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return true;
]]></Lua>
          </Ability>
          <Ability Name="Незаметность">
            <SpellID>1784</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if invisible and not UnitAffectingCombat("player") and GetShapeshiftForm() ~= 1 then
    return true;
end
]]></Lua>
          </Ability>
        </AbilityList>
      </Rotation>
      <Rotation Name="Ликвидация">
        <HotKey Key="X" Modifier="Alt" />
        <AbilityList>
          <Ability Name="Инициализаця">
            <SpellID>0</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- модификатор
if     IsModKeyDown(mkLeftShift) then
elseif IsModKeyDown(mkLeftControl) then
    if setAoE then
        setAoE = false;
        AddonFrame.print("|cff00ff00 >> Одиночная цель", true);
    else
        setAoE = true;
        AddonFrame.print("|cffff0000 >> AOE", true);
    end
elseif IsModKeyDown(mkLeftAlt) then
    return true;
elseif IsModKeyDown(mkRightShift) then
    if useCooldown then
        useCooldown = false;
        AddonFrame.print("|cffff0000Кулдауны выключены", true);
    else
        useCooldown = true;
        AddonFrame.print("|cff00ff00Кулдауны включены", true);
    end
elseif IsModKeyDown(mkRightControl) then
    if invisible then
        invisible = false;
        AddonFrame.print("|cffff0000Незаметность выключена", true);
    else
        invisible = true;
        AddonFrame.print("|cff00ff00Незаметность включена", true);
    end
elseif IsModKeyDown(mkRightAlt) then
end

-- если персонаж на маунте, тогда не выполняем ротацию дальше
if IsMounted() then
    return true;
end

-- камень здоровья
if HealthByPercent("player") < 30 then
    UseItemById(5512);
end

-- Если мы в скрытности, то всегда, если возможно прыгаем в форму незаметности
if GetSpecialization() == 3 then
    if GetShapeshiftForm() ~= 1 then
        local start, duration, enable = GetShapeshiftFormCooldown(1);
        if enable == 1 and start == 0 then
            CastShapeshiftForm(1);
        end
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Смертоносный яд">
            <SpellID>2823</SpellID>
            <Target>Player</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>true</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>NotMoving</IsMovingCheck>
            <Lua><![CDATA[
if not (UnitAffectingCombat("player") or HasBuff("player", 2823)) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Заживление ран">
            <SpellID>73651</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if GetComboPoints("player") > 4 and HealthByPercent("player") < 80 then
    if not HasBuff("target", 73651, "PLAYER") then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Внезапный удар">
            <SpellID>8676</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if GetShapeshiftForm() == 1 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Мясорубка ">
            <SpellID>5171</SpellID>
            <Target>Player</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
local name, count, rem = HasBuff("player", 5171);

if rem == 0 then
    return true;
end

if UnitExists("target") and GetComboPoints("player", "target") > 4 then
    if rem < 4 then
        return true;
    end
end
]]></Lua>
          </Ability>
        </AbilityList>
      </Rotation>
      <Rotation Name="Скрытность">
        <HotKey Key="C" Modifier="Alt" />
        <AbilityList />
      </Rotation>
      <Rotation Name="Фарм ларей">
        <HotKey Key="V" Modifier="Alt" />
        <Lua><![CDATA[
ALREADY_PICKPOCKETED_TABLE = { };
RFrame = CreateFrame("Frame");
RFrame:RegisterEvent("UI_ERROR_MESSAGE");
RFrame:RegisterEvent("WORLD_MAP_UPDATE");
RFrame:SetScript("OnEvent",  function(self, event, ...)
    if event == "UI_ERROR_MESSAGE" then
        local msg = ...;
        if UnitExists("target") and (msg == SPELL_FAILED_TARGET_NO_POCKETS or msg == ERR_ALREADY_PICKPOCKETED) then
            ALREADY_PICKPOCKETED_TABLE[UnitGUID("target")] = GetTime();
        end
    elseif event == "WORLD_MAP_UPDATE" then
        ALREADY_PICKPOCKETED_TABLE = { };
    end
end);
RFrame:Show();

function IsPickPocketed(unit)
    if ALREADY_PICKPOCKETED_TABLE then
        local t = ALREADY_PICKPOCKETED_TABLE[UnitGUID(unit)];
        if type(t) == "number" and (t + 300) > GetTime() then
            return true;
        end
    end
end
]]></Lua>
        <AbilityList>
          <Ability Name="Обшаривание карманов">
            <SpellID>921</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if GetShapeshiftForm() ~= 1 and GetShapeshiftFormCooldown(1) == 0 then
    CastShapeshiftForm(1);
end

TargetNearestEnemy();
if not IsPickPocketed("target") and not UnitIsDeadOrGhost("target") then
    return true;
end
]]></Lua>
          </Ability>
        </AbilityList>
      </Rotation>
    </RotationList>
  </Profile>
  <Profile Class="Priest">
    <Lua><![CDATA[
useCooldown = true;
setAoE      = nil;
useAutoDispell = true;
]]></Lua>
    <RotationList>
      <Rotation Name="Послушание">
        <HotKey Key="C" Modifier="Alt" />
        <AbilityList>
          <Ability Name="Инициализация">
            <SpellID>0</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- модификатор
if     IsModKeyDown(mkLeftShift) then
    return true;
elseif IsModKeyDown(mkLeftControl) then
elseif IsModKeyDown(mkLeftAlt) then
elseif IsModKeyDown(mkRightShift) then
    if useCooldown then
        useCooldown = false;
        AddonFrame.print("|cffff0000Кулдауны выключены", true);
    else
        useCooldown = true;
        AddonFrame.print("|cff00ff00Кулдауны включены", true);
    end
elseif IsModKeyDown(mkRightControl) then
elseif IsModKeyDown(mkRightAlt) then
    if useAutoDispell then
        useAutoDispell = false;
        AddonFrame.print("|cffff0000Диспел по mouseover: Выключен", true);
    else
        useAutoDispell = true;
        AddonFrame.print("|cff00ff00Диспел по mouseover: Включен", true);
    end
end

-- если персонаж на маунте, тогда не выполняем ротацию дальше
if IsMounted() or IsStealthed() then
    return true;
end

FillPartyTables(2061);

isInRange = IsSpellInRange(GetSpellInfo(8092), "target") == 1;
myMana    = PowerByPercent("player", SPELL_POWER_MANA);

if myMana < 75 then
    --UseItemBySlot(INVSLOT_TRINKET1);
    UseItemBySlot(INVSLOT_TRINKET2);
end

-- камень здоровья
if HealthByPercent("player") < 30 then
    UseItemById(5512);
end
]]></Lua>
          </Ability>
          <Ability Name="Массовое разсеивание">
            <SpellID>32375</SpellID>
            <Target>MouseLocation</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>NotMoving</IsMovingCheck>
            <Lua><![CDATA[
return IsModKeyDown(mkLeftAlt);
]]></Lua>
          </Ability>
          <Ability Name="Слово силы: Барьер">
            <SpellID>62618</SpellID>
            <Target>MouseLocation</Target>
            <CancelChannel>true</CancelChannel>
            <CancelCasting>true</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return IsModKeyDown(mkLeftControl);
]]></Lua>
          </Ability>
          <Ability Name="Разсеивание заклинаний (Авто)">
            <SpellID>527</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if useAutoDispell then
    return GetDispellInfo("HEAL");
end
]]></Lua>
          </Ability>
          <Ability Name="Вхождение в бездну">
            <SpellID>108968</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if useCooldown and members[1].HP < 20 and HealthByPercent("player") > 95 then
    return members[1].Unit;
end
]]></Lua>
          </Ability>
          <Ability Name="Подавление боли">
            <SpellID>33206</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if useCooldown and members[1].HP < 30 then
    return members[1].Unit;
end
]]></Lua>
          </Ability>
          <Ability Name="Подчиняющий разум">
            <SpellID>123040</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if myMana < 80 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Придание сил">
            <SpellID>10060</SpellID>
            <Target>Player</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return LowHP.H50 > 3;
]]></Lua>
          </Ability>
          <Ability Name="Архангел">
            <SpellID>81700</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return LowHP.H70 > 3;
]]></Lua>
          </Ability>
          <Ability Name="Каскад">
            <SpellID>120785</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if LowHP.H70 > 3 then
    return members[1].Unit;
end
]]></Lua>
          </Ability>
          <Ability Name="Слово силы: Щит">
            <SpellID>17</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- Ослабленная душа (6788)
for _,member in ipairs(members) do
    if not HasDebuff(member.Unit, 6788) then
        if member.Agro > 2 or (IS_MOVING and member.HP < 70) or member.HP < 50 then
            return member.Unit;
        end
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Быстрое исцеление">
            <SpellID>2061</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>NotMoving</IsMovingCheck>
            <Lua><![CDATA[
if members[1].HP < 40 then
    return members[1].Unit;
end
]]></Lua>
          </Ability>
          <Ability Name="Молитва восстановления">
            <SpellID>33076</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if LowHP.H90 > 2 and members[1].HP < 85 then
   return members[1].Unit;
end
]]></Lua>
          </Ability>
          <Ability Name="Молитва Исцеления">
            <SpellID>596</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>NotMoving</IsMovingCheck>
            <Lua><![CDATA[
-- Если активен щит души, тогда настакиваем щит
if LowHP.H70 > 3 or HasBuff("player", 114908, "PLAYER") then
    return members[1].Unit;
end
]]></Lua>
          </Ability>
          <Ability Name="Великое исцеление">
            <SpellID>2060</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>NotMoving</IsMovingCheck>
            <Lua><![CDATA[
if members[1].HP < 60 then
    return members[1].Unit;
end
]]></Lua>
          </Ability>
          <Ability Name="Обновление">
            <SpellID>139</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
for _,member in ipairs(members) do
   if (member.IsTank and member.HP < 90) or member.HP < 70 then
       if not HasBuff(member.Unit, 139, "PLAYER") then
           return member.Unit;
       end
   end
end
]]></Lua>
          </Ability>
          <Ability Name="Исцеление">
            <SpellID>2050</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>NotMoving</IsMovingCheck>
            <Lua><![CDATA[
if UnitCanAttack("player", "target") ~= 1 then
    if members[1].HP < 90 then
        return members[1].Unit;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Исповедь">
            <SpellID>47540</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return true;
]]></Lua>
          </Ability>
          <Ability Name="Священный огонь">
            <SpellID>14914</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return true;
]]></Lua>
          </Ability>
          <Ability Name="Слово Тьмы: Смерть (Target)">
            <SpellID>32379</SpellID>
            <Target>Target</Target>
            <CancelChannel>true</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return HealthByPercent("target") < 20;
]]></Lua>
          </Ability>
          <Ability Name="Слово тьмы: Боль">
            <SpellID>589</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if select(3, HasDebuff("target", 589, "PLAYER")) < 2 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Кара">
            <SpellID>585</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>NotMoving</IsMovingCheck>
            <Lua><![CDATA[
return true;
]]></Lua>
          </Ability>
        </AbilityList>
      </Rotation>
      <Rotation Name="Свет">
        <HotKey Key="Z" Modifier="Alt" />
        <AbilityList />
      </Rotation>
      <Rotation Name="Тьма">
        <HotKey Key="X" Modifier="Alt" />
        <AbilityList>
          <Ability Name="Инициализация">
            <SpellID>0</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- модификатор
if     IsModKeyDown(mkLeftShift) then
elseif IsModKeyDown(mkLeftControl) then
    if setAoE then
        setAoE = false;
        AddonFrame.print("|cff00ff00 >> Одиночная цель", true);
    else
        setAoE = true;
        AddonFrame.print("|cffff0000 >> AOE", true);
    end
elseif IsModKeyDown(mkLeftAlt) then
    return true;
elseif IsModKeyDown(mkRightShift) then
    if useCooldown then
        useCooldown = false;
        AddonFrame.print("|cffff0000Кулдауны выключены", true);
    else
        useCooldown = true;
        AddonFrame.print("|cff00ff00Кулдауны включены", true);
    end
elseif IsModKeyDown(mkRightControl) then
elseif IsModKeyDown(mkRightAlt) then

end

-- если персонаж на маунте, тогда не выполняем ротацию дальше
if IsMounted() then
    return true;
end

-- Перейти в форму тьмы
if GetSpecialization() == 3 and GetShapeshiftForm() ~= 1 then
    CastShapeshiftForm(1);
end

-- камень здоровья
if HealthByPercent("player") < 30 then
    UseItemById(5512);
end

isInRange = IsSpellInRange(GetSpellInfo(8092), "target") == 1;
]]></Lua>
          </Ability>
          <Ability Name="Массовое разсеивание">
            <SpellID>32375</SpellID>
            <Target>MouseLocation</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>NotMoving</IsMovingCheck>
            <Lua><![CDATA[
return IsModKeyDown(mkLeftAlt);
]]></Lua>
          </Ability>
          <Ability Name="Искушение разума">
            <SpellID>48045</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return setAoE;
]]></Lua>
          </Ability>
          <Ability Name="Слово Тьмы: Смерть (Target)">
            <SpellID>32379</SpellID>
            <Target>Target</Target>
            <CancelChannel>true</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return HealthByPercent("target") < 20;
]]></Lua>
          </Ability>
          <Ability Name="Слово Тьмы: Смерть (Focus)">
            <SpellID>32379</SpellID>
            <Target>Focus</Target>
            <CancelChannel>true</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return HealthByPercent("focus") < 20;
]]></Lua>
          </Ability>
          <Ability Name="Слово Тьмы: Смерть (Mouseover)">
            <SpellID>32379</SpellID>
            <Target>Mouseover</Target>
            <CancelChannel>true</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return HealthByPercent("mouseover") < 20;
]]></Lua>
          </Ability>
          <Ability Name="Всепожирающая чума">
            <SpellID>2944</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if UnitPower("player", SPELL_POWER_SHADOW_ORBS) >= 3 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Взрыв разума">
            <SpellID>8092</SpellID>
            <Target>Target</Target>
            <CancelChannel>true</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return true;
]]></Lua>
          </Ability>
          <Ability Name="Сияние">
            <SpellID>120517</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return true;
]]></Lua>
          </Ability>
          <Ability Name="Исчадие тьмы">
            <SpellID>34433</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return useCooldown;
]]></Lua>
          </Ability>
          <Ability Name="Пронзание разума">
            <SpellID>73510</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if HasBuff("player", 87160) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Слово тьмы: Боль">
            <SpellID>589</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
local name, count, rem = HasDebuff(ability.Target, 589, "PLAYER");
if not name or rem < 2 or IS_MOVING then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Слово тьмы: Боль (focus)">
            <SpellID>589</SpellID>
            <Target>Focus</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
local name, count, rem = HasDebuff(ability.Target, 589, "PLAYER");
if not name or rem < 2 or IS_MOVING then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Слово тьмы: Боль (mouseover)">
            <SpellID>589</SpellID>
            <Target>Mouseover</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
local name, count, rem = HasDebuff(ability.Target, 589, "PLAYER");
if not name or rem < 2 or IS_MOVING then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Прикосновение вампира (target)">
            <SpellID>34914</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>true</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if not IS_MOVING then
    local name, count, rem = HasDebuff(ability.Target, 34914, "PLAYER");
    if not name or rem < 2 then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Прикосновение вампира (Focus)">
            <SpellID>34914</SpellID>
            <Target>Focus</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>true</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if not IS_MOVING then
    local name, count, rem = HasDebuff(ability.Target, 34914, "PLAYER");
    if not name or rem < 2 then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Прикосновение вампира (Mouseover)">
            <SpellID>34914</SpellID>
            <Target>Mouseover</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>true</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if not IS_MOVING then
    local name, count, rem = HasDebuff(ability.Target, 34914, "PLAYER");
    if not name or rem < 2 then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Пытка разума">
            <SpellID>15407</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return isInRange;
]]></Lua>
          </Ability>
        </AbilityList>
      </Rotation>
    </RotationList>
  </Profile>
  <Profile Class="DeathKnight">
    <Lua><![CDATA[
-- 1 - Blood rune
-- 2 - Unholy rune
-- 3 - Frost rune
-- 4 - Death rune

RUNETYPE_BLOOD     = 1;
RUNETYPE_CHROMATIC = 2;
RUNETYPE_FROST     = 3;
RUNETYPE_DEATH     = 4;

TOTAL_RUNE_COUNT   = 6;

useCooldown        = true;
setAoE             = nil;
isAltMod           = nil;
rune_names = { "Blood", "Unholy", "Frost", "Death" };

DIESES_BLOOD_PLAGUE       = 55078;
DIESES_FROST_FEVER         = 55095;

function FillDiesesInfo(ability)
    blood_plague,_,blood_plague_rem = HasDebuff(ability.Target, DIESES_BLOOD_PLAGUE, "PLAYER");-- Кровавая чума
    frost_fever, _,frost_fever_rem  = HasDebuff(ability.Target, DIESES_FROST_FEVER, "PLAYER");-- Озноб
end

function FillRunesInfo()
    runes = {
        Blood  = { Rem = 0, Count = 0 },
        Unholy = { Rem = 0, Count = 0 },
        Frost  = { Rem = 0, Count = 0 },
        Death  = { Rem = 0, Count = 0 },
        Power  = 0,
    };

    runes.Power = UnitPower("player");--, SPELL_POWER_RUNIC_POWER);
    
    for slot = 1, 6 do
        local runeType        = GetRuneType(slot);
        local start, duration = GetRuneCooldown(slot);
        local rune_name = rune_names[runeType];
 
        runes[rune_name].Rem   = (start + duration) - GetTime();
        runes[rune_name].Count = GetRuneCount(slot) + runes[rune_name].Count;
    end
end

function GetFreeRuneCountForType(runeType)
    if not runeType or runeType < 1 or runeType > 4 then
        return 0;
    end
    
    FillRunesInfo();
    
    if runeType == RUNETYPE_DEATH then
        return runes.Death.Count;
    end

    local deathRuneCount = runes.Death.Count;
    local runeName = rune_names[runeType];

    local selRuneCount = runes[runeName].Count;

    return deathRuneCount + selRuneCount;
end

function HaveFullyDepletedRunes()
    
    FillRunesInfo();

    local unholy = runes.Unholy.Count;
    local frost  = runes.Frost.Count;
    local blood  = runes.Blood.Count;
    local death  = runes.Death.Count;
    
    -- Frost DK dont have blood runes
    if GetShapeshiftForm() == 2 then
        blood = 2; -- disable blood rune calc
    end

    return unholy == 0 or frost == 0 or blood == 0 or death == 0;
end

function HaveFullyRunes()
    
    FillRunesInfo();

    local unholy = runes.Unholy.Count;
    local frost  = runes.Frost.Count;
    local blood  = runes.Blood.Count;
    local death  = runes.Death.Count;
    
    -- Frost DK dont have blood runes
    if GetShapeshiftForm() == 2 then
        blood = 0; -- disable blood rune calc
    end

    return unholy == 2 or frost == 2 or blood == 2 or death == 2;
end

function GetRunesCount()
    
    FillRunesInfo();

    local unholy = runes.Unholy.Count;
    local frost  = runes.Frost.Count;
    local blood  = runes.Blood.Count;
    local death  = runes.Death.Count;
    
    if GetShapeshiftForm() == 2 then
        blood = 0;
    end
    
    return unholy + frost + blood + death;
end

function GetRunesAtCooldownCount()
    return TOTAL_RUNE_COUNT - GetRunesCount();
end

function HaveRuneAtCooldown()
    return GetRunesAtCooldownCount() > 0;
end
]]></Lua>
    <RotationList>
      <Rotation Name="Кровь">
        <HotKey Key="X" Modifier="Alt" />
        <AbilityList>
          <Ability Name="Инициализация">
            <SpellID>0</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- модификатор
if     IsModKeyDown(mkLeftShift) then
elseif IsModKeyDown(mkLeftControl) then
    if setAoE then
        setAoE = false;
        print("|cff00ff00 >> Одиночная цель");
    else
        setAoE = true;
        print("|cffff0000 >> AOE");
    end
elseif IsModKeyDown(mkLeftAlt) then
    return true;
elseif IsModKeyDown(mkRightShift) then
    if useCooldown then
        useCooldown = false;
        print("|cffff0000Кулдауны выключены");
    else
        useCooldown = true;
        print("|cff00ff00Кулдауны включены");
    end
elseif IsModKeyDown(mkRightControl) then
elseif IsModKeyDown(mkRightAlt)     then
end

-- если персонаж на маунте, тогда не выполняем ротацию дальше
if IsMounted() then
    return true;
end

-- Перейти в стойку защиты
if     GetSpecialization() == 1 and GetShapeshiftForm() ~= 1 then
    CastShapeshiftForm(1); -- blood
elseif GetSpecialization() == 2 and GetShapeshiftForm() ~= 2 then
    CastShapeshiftForm(2); -- frost
elseif GetSpecialization() == 3 and GetShapeshiftForm() ~= 3 then
    CastShapeshiftForm(3); -- unholly
end

FillRunesInfo();

-- камень здоровья
if HealthByPercent("player") < 30 then
    UseItemById(5512);
end

isInMeele  = IsSpellInRange(GetSpellInfo(49998), "target") == 1;
agroStatus = UnitThreatSituation("player");
playerHP   = HealthByPercent("player");
]]></Lua>
          </Ability>
          <Ability Name="Смерть и разложение">
            <SpellID>43265</SpellID>
            <Target>MouseLocation</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return IsModKeyDown(mkLeftShift);
]]></Lua>
          </Ability>
          <Ability Name="Кровь вампира">
            <SpellID>55233</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if playerHP < 30 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Костяной щит">
            <SpellID>49222</SpellID>
            <Target>Player</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if not HasBuff("player", 49222) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Незыблемость льда">
            <SpellID>48792</SpellID>
            <Target>Player</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if useCooldown and playerHP <= 40 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Захват рун">
            <SpellID>48982</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if agroStatus == 3 and playerHP < 90 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Танцующее руническое оружие">
            <SpellID>49028</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return useCooldown;
]]></Lua>
          </Ability>
          <Ability Name="Вспышка болезни">
            <SpellID>77575</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if not HasDebuff("target", 59879, "PLAYER") and not HasDebuff("target", 59921, "PLAYER") then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Удар чумы">
            <SpellID>45462</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if not UnitDebuff("target", 59879) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Ледяное прикосновение">
            <SpellID>45477</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if not UnitDebuff("target", 59921) or HasBuff("player", 59052) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Жнец душ">
            <SpellID>114866</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return true;
]]></Lua>
          </Ability>
          <Ability Name="Кровоотвод">
            <SpellID>45529</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- if=(unholy=0&frost>=1)|(unholy>=1&frost=0)|(death=1)
if (runes.Unholy.Count == 0 and runes.Frost.Count >= 1) 
or (runes.Unholy.Count >= 1 and runes.Frost.Count == 0) 
or runes.Death.Count == 1 then
    if (select(2, HasBuff("player", 114851)) or 0) >= 5 then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Удар смерти">
            <SpellID>49998</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return true;
]]></Lua>
          </Ability>
          <Ability Name="Вскипание крови">
            <SpellID>48721</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if setAoE and isInMeele and runes.Blood.Count > 0 or HasBuff("player", 81141) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Удар в сердце">
            <SpellID>55050</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- if=(blood=1&blood.cooldown_remains<1)|blood=2
if isInMeele and (runes.Blood.Count == 1 and runes.Blood.Rem < 1) or runes.Blood.Count == 2 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Рунический удар">
            <SpellID>56815</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if UnitPower("player") > 40 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Усиление рунического оружия">
            <SpellID>47568</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if useCooldown and runes.Blood.Count == 0 and runes.Unholy.Count == 0 and runes.Frost.Count == 0 then
    return true;
end
]]></Lua>
          </Ability>
        </AbilityList>
      </Rotation>
      <Rotation Name="Лед">
        <HotKey Key="Z" Modifier="Alt" />
        <Lua><![CDATA[
function OnEventExtended (self, event, ...)
    if event == "COMBAT_LOG_EVENT_UNFILTERED" then
        -- для начала приведу полный список параметров.
        local timestamp, subEvent, hideCaster,
              sourceGUID,srcName,  sourceFlags,sourceFlags2,
              destGUID,  destName, destFlags,  destFlags2,
        -- Добавочные переменные
              spellId,   spellName,spellSchool,auraType = ...;

        if subEvent == "SPELL_AURA_APPLIED" then
            if UnitGUID("player") == sourceGUID and destGUID == UnitGUID("player") then -- e.g talent proc
                for _,ability in ipairs(ABILITY_TABLE) do
                    if ability.Procs then
                        for _,spellIdInList in ipairs(ability.Procs) do
                            if spellIdInList == spellId then 
                                if nil then
                                --if CheckAndCastAbility(ability) then
                                    break;
                                end                            
                            end
                        end
                    end
                end
            end
        end
    end
end
]]></Lua>
        <AbilityList>
          <Ability Name="Инициализация">
            <SpellID>0</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- модификатор
if     IsModKeyDown(mkLeftShift) then
elseif IsModKeyDown(mkLeftControl) then
    if setAoE then
        setAoE = false;
        print("|cff00ff00 >> Одиночная цель");
    else
        setAoE = true;
        print("|cffff0000 >> AOE");
    end
elseif IsModKeyDown(mkLeftAlt) then
    return true;
elseif IsModKeyDown(mkRightShift) then
    if useCooldown then
        useCooldown = false;
        print("|cffff0000Кулдауны выключены");
    else
        useCooldown = true;
        print("|cff00ff00Кулдауны включены");
    end
elseif IsModKeyDown(mkRightControl) then
elseif IsModKeyDown(mkRightAlt)     then
end

-- если персонаж на маунте, тогда не выполняем ротацию дальше
if IsMounted() then
    return true;
end

-- Смена власти в зависимости от специализации
if  GetSpecialization() == 1 and GetShapeshiftForm() ~= 1 then
    CastShapeshiftForm(1); -- blood
elseif GetSpecialization() == 2 and GetShapeshiftForm() ~= 2 then
    CastShapeshiftForm(2); -- frost
elseif GetSpecialization() == 3 and GetShapeshiftForm() ~= 3 then
    CastShapeshiftForm(3); -- unholly
end

FillRunesInfo();

-- камень здоровья
if HealthByPercent("player") < 30 then
    UseItemById(5512);
end

isInMeele  = IsSpellInRange(GetSpellInfo(49998), "target") == 1;
agroStatus = UnitThreatSituation("player");
playerHP   = HealthByPercent("player");
]]></Lua>
          </Ability>
          <Ability Name="Воскрешение мертвых">
            <SpellID>46584</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return true;
]]></Lua>
          </Ability>
          <Ability Name="Смертельный союз">
            <SpellID>48743</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return playerHP < 30;
]]></Lua>
          </Ability>
          <Ability Name="Зимний горн">
            <SpellID>57330</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return true; -- всегда кастовать Зимный горн для получения рунической энергии
]]></Lua>
          </Ability>
          <Ability Name="Вспышка болезни">
            <SpellID>77575</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
bloodPlague,_,bloodPlagueRem = HasDebuff("target", DIESES_BLOOD_PLAGUE, "PLAYER");
frostFever,_,frostFeverRem = HasDebuff("target", DIESES_FROST_FEVER, "PLAYER");

return (not bloodPlague or bloodPlagueRem <= 1) or (not frostFever or frostFeverRem <= 1);
]]></Lua>
          </Ability>
          <Ability Name="Жнец душ">
            <SpellID>130735</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
local unholy = GetFreeRuneCountForType(RUNETYPE_FROST);
if unholy < 1 then
    return false;
end

local pct = 35;
if HasBuff("player", 138347) then
    pct = 45;
end
return HealthByPercent("target") <= pct;
]]></Lua>
          </Ability>
          <Ability Name="Воющий ветер">
            <SpellID>49184</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
local frost = GetFreeRuneCountForType(RUNETYPE_FROST);
if frost >= 2 or HasBuff("player", 59052) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Уничтожение">
            <SpellID>49020</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
local frost = GetFreeRuneCountForType(RUNETYPE_FROST);
local unholy = GetFreeRuneCountForType(RUNETYPE_CHROMATIC);

return unholy >= 1 and frost >= 1;
]]></Lua>
          </Ability>
          <Ability Name="Ледяной удар">
            <SpellID>49143</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return runes.Power >= 20;
]]></Lua>
          </Ability>
          <Ability Name="Лик Смерти">
            <SpellID>47541</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- Сливаем избыток рунической энергии Ликом Смерти
if runes.Power < 80 then
    return false;
end

return SpellCD(49143) > 1;
]]></Lua>
          </Ability>
          <Ability Name="Кровоотвод">
            <SpellID>45529</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
local haveRuneAtCooldown = HaveRuneAtCooldown();
if not haveRuneAtCooldown or haveRuneAtCooldown == 0 then
    return false;
end

local bloodCharge,stackCount = HasBuff("player", 114851);
if not bloodCharge then
    return false;
end

return stackCount >= 5;
]]></Lua>
          </Ability>
          <Ability Name="Вытягивание чумы">
            <SpellID>123693</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- Поглощает 2 болезни и восстанавливает 1 случайную руну ввиде руны смерти

bloodPlague,_,bloodPlagueRem = HasDebuff("target", DIESES_BLOOD_PLAGUE, "PLAYER");
frostFever,_,frostFeverRem = HasDebuff("target", DIESES_FROST_FEVER, "PLAYER");

-- На целе есть 2 болезни
if not bloodPlague or not frostFever then
    return false;
end

local reqCount = 2;
if HealthByPercent("target") < 5 then
    reqCount = 1;
end

return GetRunesAtCooldownCount() > reqCount;

--return HaveFullyDepletedRunes() or HealthByPercent("target") < 5;
]]></Lua>
          </Ability>
          <Ability Name="Удар чумы ">
            <SpellID>45462</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
local unholy = GetFreeRuneCountForType(RUNETYPE_CHROMATIC);
return unholy >= 1 and not HasDebuff("target", DIESES_BLOOD_PLAGUE, "PLAYER");
]]></Lua>
          </Ability>
          <Ability Name="Нечестивая порча">
            <SpellID>115989</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return true;

-- проверка по кд в 1.5 минуты и наличие хотя бы 3х целей еще по мимо основной
]]></Lua>
          </Ability>
          <Ability Name="Воющий ветер (2)">
            <SpellID>49184</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if HasBuff("player", 59052) then
    return true;
end

local frost = GetFreeRuneCountForType(RUNETYPE_FROST);

local reqCount = 2;
if SpellCD(49020) > 1 then
    reqCount = 1;
end

return frost >= reqCount;
]]></Lua>
          </Ability>
          <Ability Name="Ледяное прикосновение">
            <SpellID>45477</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if HasBuff("player", 59052) then
    return true;
end

local frost = GetFreeRuneCountForType(RUNETYPE_FROST);

local reqCount = 3;
if SpellCD(49020) > 1 then -- Уничтожение имеет КД
    reqCount = 2;
end

return frost >= reqCount or not HasDebuff("target", DIESES_FROST_FEVER, "PLAYER");
]]></Lua>
          </Ability>
          <Ability Name="Удар чумы (2)">
            <SpellID>45462</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
local unholy = GetFreeRuneCountForType(RUNETYPE_CHROMATIC);
local reqCount = 2;
if SpellCD(49020) > 1 then
    reqCount = 1;
end
if unholy >= reqCount or not HasDebuff("target", DIESES_BLOOD_PLAGUE, "PLAYER") then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Ледяной столп">
            <SpellID>51271</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return GetFreeRuneCountForType(RUNETYPE_FROST) >= 2;
]]></Lua>
          </Ability>
          <Ability Name="Вскипание крови ">
            <SpellID>48721</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if GetFreeRuneCountForType(RUNETYPE_BLOOD) > 2 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Усиление рунического оружия">
            <SpellID>47568</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return GetRunesAtCooldownCount() >= 5;
]]></Lua>
          </Ability>
          <Ability Name="Смерть и разложение">
            <SpellID>43265</SpellID>
            <Target>MouseLocation</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return IsModKeyDown(mkLeftShift);
]]></Lua>
          </Ability>
        </AbilityList>
      </Rotation>
      <Rotation Name="Нечестивость">
        <HotKey Key="C" Modifier="Alt" />
        <AbilityList />
      </Rotation>
      <Rotation Name="Лед (2)">
        <HotKey Key="V" Modifier="Alt" />
        <Notes><![CDATA[
Тестовый вариант:
    1) Доступность заклинаний
    2) Досягаемость
    3) Логика рун
]]></Notes>
        <AbilityList>
          <Ability Name="Инициализация">
            <SpellID>0</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- модификатор
if     IsModKeyDown(mkLeftShift) then
elseif IsModKeyDown(mkLeftControl) then
    if setAoE then
        setAoE = false;
        print("|cff00ff00 >> Одиночная цель");
    else
        setAoE = true;
        print("|cffff0000 >> AOE");
    end
elseif IsModKeyDown(mkLeftAlt) then
    return true;
elseif IsModKeyDown(mkRightShift) then
    if useCooldown then
        useCooldown = false;
        print("|cffff0000Кулдауны выключены");
    else
        useCooldown = true;
        print("|cff00ff00Кулдауны включены");
    end
elseif IsModKeyDown(mkRightControl) then
elseif IsModKeyDown(mkRightAlt)     then
end

-- если персонаж на маунте, тогда не выполняем ротацию дальше
if IsMounted() then
    return true;
end

-- Смена власти в зависимости от специализации
if GetSpecialization() == 2 and GetShapeshiftForm() ~= 2 then
    CastShapeshiftForm(2); -- frost
end

FillRunesInfo();
FillDiesesInfo(ability);

-- камень здоровья
if HealthByPercent("player") < 30 then
    UseItemById(5512);
end

isInMeele  = IsSpellInRange(GetSpellInfo(49998), "target") == 1;
agroStatus = UnitThreatSituation("player");
playerHP   = HealthByPercent("player");
]]></Lua>
          </Ability>
          <Ability Name="Смерть и разложение">
            <SpellID>43265</SpellID>
            <Target>MouseLocation</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return IsModKeyDown(mkLeftShift);
]]></Lua>
          </Ability>
          <Ability Name="Вытягивание чумы">
            <SpellID>123693</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- if=talent.plague_leech.enabled&((dot.blood_plague.remains<1|dot.frost_fever.remains<1))

FillDiesesInfo(ability);
if not blood_plague and not frost_fever then
    return false;
end

if not HaveFullyDepletedRunes() then
    return false;
end

if blood_plague_rem < 1 or frost_fever_rem < 1 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Вспышка болезни">
            <SpellID>77575</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- if=!dot.frost_fever.ticking|!dot.blood_plague.ticking
FillDiesesInfo(ability);
if not (blood_plague and frost_fever) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Нечестивая порча">
            <SpellID>115989</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- if=talent.unholy_blight.enabled&((!dot.frost_fever.ticking|!dot.blood_plague.ticking))
FillDiesesInfo(ability);
if not (blood_plague and frost_fever) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Жнец душ">
            <SpellID>114866</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- if=target.health.pct-3*(target.health.pct%target.time_to_die)<=35
local modifier = 3;
if IsInRaid() then
    modifier = 10;
elseif GetNumGroupMembers() > 0 then
    modifier = 5;
end
if (UnitHealth("target") or 0) > (UnitHealth("player") * modifier) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Кровоотвод">
            <SpellID>45529</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if select(2, HasBuff("player", 114851)) < 5 then
    return false;
end

if not HaveFullyDepletedRunes() then
    return false;
end

-- if=talent.blood_tap.enabled&((target.health.pct-3*(target.health.pct%target.time_to_die)<=35&cooldown.soul_reaper.remains=0))
local modifier = 3;
if IsInRaid() then
    modifier = 10;
elseif GetNumGroupMembers() > 0 then
    modifier = 5;
end
if (UnitHealth("target") or 0) > (UnitHealth("player") * modifier) then
    --if HasBuff("player", soul_reaper) then ???
        return true;
    --end
end
]]></Lua>
          </Ability>
          <Ability Name="Воющий ветер">
            <SpellID>49184</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- if=!dot.frost_fever.ticking
FillDiesesInfo(ability);
if not frost_fever or GetFreeRuneCountForType(RUNETYPE_FROST) == 1 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Удар чумы">
            <SpellID>45462</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- !dot.blood_plague.ticking
FillDiesesInfo(ability);
if not blood_plague then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Воющий ветер">
            <SpellID>49184</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- buff.rime.react
-- Морозная дымка
if HasBuff("player", 59052) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Уничтожение">
            <SpellID>49020</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- if=buff.killing_machine.react
-- Машина для убийств
if HasBuff("player", 51124) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Кровоотвод">
            <SpellID>45529</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- if=talent.blood_tap.enabled&buff.killing_machine.react
-- if=talent.blood_tap.enabled&(buff.blood_charge.stack>10&runic_power>76)

if not HaveFullyDepletedRunes() then
    return false;
end

if HasBuff("player", 51124) then
    return select(2, HasBuff("player", 114851)) >= 5;
elseif runes.Power > 76 and select(2, HasBuff("player", 114851)) > 10 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Ледяной удар">
            <SpellID>49143</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- if=runic_power>76
if runes.Power > 76 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Уничтожение">
            <SpellID>49020</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- if=blood=2|frost=2|unholy=2
if HaveFullyRunes() then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Вытягивание чумы">
            <SpellID>123693</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- if=talent.plague_leech.enabled&((dot.blood_plague.remains<3|dot.frost_fever.remains<3))
FillDiesesInfo(ability);
if blood_plague_rem < 3 or frost_fever_rem < 3 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Вспышка болезни">
            <SpellID>77575</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- if=dot.frost_fever.remains<3|dot.blood_plague.remains<3
FillDiesesInfo(ability);
if blood_plague_rem < 3 or frost_fever_rem < 3 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Нечестивая порча">
            <SpellID>115989</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- if=talent.unholy_blight.enabled&((dot.frost_fever.remains<3|dot.blood_plague.remains<3))
FillDiesesInfo(ability);
if blood_plague_rem < 3 or frost_fever_rem < 3 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Ледяной удар">
            <SpellID>49143</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- if=talent.runic_empowerment.enabled&(frost=0|unholy=0|blood=0)
if not HaveFullyDepletedRunes() then
    if IsPlayerSpell(81229) then
        return true;
    end
end
-- if=talent.blood_tap.enabled&buff.blood_charge.stack<=10
if IsPlayerSpell(45529) then
    if select(2, HasBuff("player", 114851)) <= 10 then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Зимний горн">
            <SpellID>57330</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return true;
]]></Lua>
          </Ability>
          <Ability Name="Уничтожение">
            <SpellID>49020</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return true;
]]></Lua>
          </Ability>
          <Ability Name="Кровоотвод">
            <SpellID>45529</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- if=talent.blood_tap.enabled&(buff.blood_charge.stack>10&runic_power>=20)

if not HaveFullyDepletedRunes() then
    return false;
end

if runes.Power >= 20 then
    -- Заряд крови
    if select(2, HasBuff("player", 114851)) > 10 then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Ледяной удар">
            <SpellID>49143</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return true;
]]></Lua>
          </Ability>
          <Ability Name="Вытягивание чумы">
            <SpellID>123693</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return true;
]]></Lua>
          </Ability>
          <Ability Name="Усиление рунического оружия">
            <SpellID>47568</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return GetRunesAtCooldownCount() >= 5;
]]></Lua>
          </Ability>
          <Ability Name="(Слив рун льдя 1) Воющий ветер ">
            <SpellID>49184</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- if not unholy runes and frost runes = 1
if GetFreeRuneCountForType(RUNETYPE_FROST) == 1 and GetFreeRuneCountForType(RUNETYPE_CHROMATIC) < 1 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="(Слив рун льдя 2) Воющий ветер ">
            <SpellID>49184</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- if not unholy runes and frost runes = 1
if GetFreeRuneCountForType(RUNETYPE_FROST) == 1 and GetFreeRuneCountForType(RUNETYPE_CHROMATIC) > 1 and SpellCD(49020) > 1 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="(Слив рун нечестивости 1) Удар смерти">
            <SpellID>45462</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- !dot.blood_plague.ticking
if GetFreeRuneCountForType(RUNETYPE_CHROMATIC) == 1 and GetFreeRuneCountForType(RUNETYPE_FROST) < 1 then
    return true;
end
]]></Lua>
          </Ability>
        </AbilityList>
      </Rotation>
    </RotationList>
  </Profile>
  <Profile Class="Shaman">
    <RotationList>
      <Rotation Name="Стихии">
        <HotKey Key="X" Modifier="Alt" />
        <AbilityList>
          <Ability Name="Инициализация">
            <SpellID>0</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- модификатор
if     IsModKeyDown(mkLeftShift) then
elseif IsModKeyDown(mkLeftControl) then
    if setAoE then
        setAoE = false;
        AddonFrame.print("|cff00ff00 Одиночная цель", 1);
    else
        setAoE = true;
        AddonFrame.print("|cffff0000 AOE", 1);
    end
elseif IsModKeyDown(mkLeftAlt) then
    return true;
elseif IsModKeyDown(mkRightShift) then
    if useCooldown then
        useCooldown = false;
        AddonFrame.print("|cffff0000Кулдауны выключены", 1);
    else
        useCooldown = true;
        AddonFrame.print("|cff00ff00Кулдауны включены", 1);
    end
elseif IsModKeyDown(mkRightControl) then
elseif IsModKeyDown(mkRightAlt)     then
end

-- если персонаж на маунте, тогда не выполняем ротацию дальше
if IsMounted() then
    return true;
end

-- камень здоровья
if HealthByPercent("player") < 30 then
    UseItemById(5512);
end

isInRange = IsSpellInRange(GetSpellInfo(403), "target") == 1;

--FillPartyTables(331);
]]></Lua>
          </Ability>
          <Ability Name="Исцеляющий всплеск">
            <SpellID>8004</SpellID>
            <Target>Mouseover</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if UnitIsFriend("player", "mouseover") then
    if HealthByPercent("mouseover") < 50 then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Опаляющий тотем">
            <SpellID>3599</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if not setAoE and isInRange and UnitExists("target") and not GetTotemInfo(1) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Огненный шок">
            <SpellID>8050</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if select(3, HasDebuff(ability.Target, 8050, "PLAYER")) <= 3 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Огненный шок">
            <SpellID>8050</SpellID>
            <Target>Focus</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if select(3, HasDebuff(ability.Target, 8050, "PLAYER")) <= 3 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Огненный шок">
            <SpellID>8050</SpellID>
            <Target>Mouseover</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if select(3, HasDebuff(ability.Target, 8050, "PLAYER")) <= 3 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Выброс лавы">
            <SpellID>51505</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return true;
]]></Lua>
          </Ability>
          <Ability Name="Земной шок">
            <SpellID>8042</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if (select(2, HasBuff("player", 324)) or 0) > 6 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Цепная молния">
            <SpellID>421</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return setAoE;
]]></Lua>
          </Ability>
          <Ability Name="Молния">
            <SpellID>403</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return true;
]]></Lua>
          </Ability>
        </AbilityList>
      </Rotation>
      <Rotation Name="Совершенствование">
        <HotKey Key="Z" Modifier="Alt" />
        <AbilityList />
      </Rotation>
      <Rotation Name="Исцеление">
        <HotKey Key="C" Modifier="Alt" />
        <AbilityList>
          <Ability Name="Инициализация">
            <SpellID>0</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- модификатор
if     IsModKeyDown(mkLeftShift) then
elseif IsModKeyDown(mkLeftControl) then
    if setAoE then
        setAoE = false;
        print("|cff00ff00 >> Одиночная цель");
    else
        setAoE = true;
        print("|cffff0000 >> AOE");
    end
elseif IsModKeyDown(mkLeftAlt) then
    return true;
elseif IsModKeyDown(mkRightShift) then
    if useCooldown then
        useCooldown = false;
        print("|cffff0000Кулдауны выключены");
    else
        useCooldown = true;
        print("|cff00ff00Кулдауны включены");
    end
elseif IsModKeyDown(mkRightControl) then
    if useAutoDispell then
        useAutoDispell = false;
        AddonFrame.print("|cffff0000Автодиспел выключен", true);
    else
        useAutoDispell = true;
        AddonFrame.print("|cff00ff00Автодиспел включен", true);
    end
elseif IsModKeyDown(mkRightAlt)     then
end

-- если персонаж на маунте, тогда не выполняем ротацию дальше
if IsMounted() then
    return true;
end

-- камень здоровья
if HealthByPercent("player") < 30 then
    UseItemById(5512);
end

FillPartyTables(331);
]]></Lua>
          </Ability>
          <Ability Name="Водяной щит">
            <SpellID>52127</SpellID>
            <Target>Player</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if not HasBuff("player", 52127) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Щит земли">
            <SpellID>974</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
for _,member in ipairs(members) do
    if member.Agro > 2 and member.IsTank then
        if select(3, HasBuff(member.Unit, 974, "PLAYER")) > 10 then
            return;
        end
    end
end

-- Накладываем щит земли на танка с агро
for _,member in ipairs(members) do
    if member.Agro > 2 and member.IsTank then
        return member.Unit;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Быстрина">
            <SpellID>61295</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
for _,member in ipairs(members) do
    if member.HP < 70 or (member.IsTank and member.Agro > 2)then
        if not HasBuff(member.Unit, 61295, "PLAYER") then
            return member.Unit;
        end
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Исцелающий всплеск">
            <SpellID>8004</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>NotMoving</IsMovingCheck>
            <Lua><![CDATA[
if members[1].HP < 70 then
    return members[1].Unit;
end
]]></Lua>
          </Ability>
          <Ability Name="Волна исцеления">
            <SpellID>331</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>NotMoving</IsMovingCheck>
            <Lua><![CDATA[
if members[1].HP < 70 then
    return members[1].Unit;
end
]]></Lua>
          </Ability>
          <Ability Name="Тотем исцеляющего потока">
            <SpellID>5394</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if not GetTotemInfo(3) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Дух предков">
            <SpellID>2008</SpellID>
            <Target>Mouseover</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>NotMoving</IsMovingCheck>
            <Lua><![CDATA[
if UnitIsDead("mouseover") and not UnitAffectingCombat("player") and UnitIsPlayer("mouseover") then
    return true;
end
]]></Lua>
          </Ability>
        </AbilityList>
      </Rotation>
    </RotationList>
  </Profile>
  <Profile Class="Mage">
    <Lua><![CDATA[
useCooldown  = true;
setAoE       = nil;
]]></Lua>
    <RotationList>
      <Rotation Name="Огонь">
        <HotKey Key="Z" Modifier="Alt" />
        <Lua><![CDATA[
igniteDamage = 0;     -- Урон от тика доты Воспламенение (12654)
pyroCrit     = nil;   -- Было ли заклинание Огненная глыба (11366) критическим

function OnEventExtended (self, event, ...)
    if event == "COMBAT_LOG_EVENT_UNFILTERED" then
        -- для начала приведу полный список параметров.
        local timestamp, subEvent, hideCaster,
              sourceGUID,srcName,  sourceFlags,sourceFlags2,
              destGUID,  destName, destFlags,  destFlags2,
              spellId,   spellName,spellSchool,amount,      overkill,school,
              resisted,  blocked,  absorbed,   critical,    glancing,crushing = ...;

        if subEvent == "SPELL_PERIODIC_DAMAGE" then
            if UnitGUID("player") == sourceGUID and destGUID == UnitGUID("target") then
                -- Воспламенение
                if spellId == 12654 then
                    igniteDamage = amount;
                    --print("Тик: Воспламенение (12654) - "..tostring(amount));
                end
            end
        end

        if subEvent == "SPELL_DAMAGE" then
            if UnitGUID("player") == sourceGUID and destGUID == UnitGUID("target") then
                -- Огненная глыба
                if spellId == 11366 then
                    pyroCrit = critical;
                    if critical then
                        print("|cff00ff00 Крит: Огненная глыба (11366) - "..tostring(amount));
                    end
                end
            end
        end
    end
end
]]></Lua>
        <AbilityList>
          <Ability Name="Инициализация">
            <SpellID>0</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- модификатор
if     IsModKeyDown(mkLeftShift) then
elseif IsModKeyDown(mkLeftControl) then
    if setAoE then
        setAoE = false;
        print("|cff00ff00 >> Одиночная цель");
    else
        setAoE = true;
        print("|cffff0000 >> AOE");
    end
elseif IsModKeyDown(mkLeftAlt) then
    return true;
elseif IsModKeyDown(mkRightShift) then
    if useCooldown then
        useCooldown = false;
        print("|cffff0000Кулдауны выключены");
    else
        useCooldown = true;
        print("|cff00ff00Кулдауны включены");
    end
elseif IsModKeyDown(mkRightControl) then
elseif IsModKeyDown(mkRightAlt) then
end

isInRange = IsSpellInRange(GetSpellInfo(133), "target") == 1;

-- камень здоровья
if HealthByPercent("player") < 30 then
    UseItemById(5512);
end
]]></Lua>
          </Ability>
          <Ability Name="Использование предметов">
            <SpellID>0</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- если персонаж на маунте, тогда не выполняем ротацию дальше
if IsMounted() then
    return true;
end

if useCooldown then
    UseItemBySlot(INVSLOT_HAND);
    UseItemBySlot(INVSLOT_TRINKET1);
    UseItemBySlot(INVSLOT_TRINKET1);
end
]]></Lua>
          </Ability>
          <Ability Name="Огненный столб">
            <SpellID>2120</SpellID>
            <Target>MouseLocation</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return IsModKeyDown(mkLeftShift);
]]></Lua>
          </Ability>
          <Ability Name="Возгорание">
            <SpellID>11129</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- Вешаем возгорание только после крита Огненной бомбы (и/или) наличия сильной доты.
-- Так же важно использовать возгорание под прок тринек
if useCooldown and pyroCrit and (igniteDamage or 0) > 5000 then
    if select(3, HasDebuff(ability.Target, 12654, "PLAYER")) > 3 then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Живая бомба (Target)">
            <SpellID>44457</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if not HasDebuff(ability.Target, 44457, "PLAYER") then
    if IsSpellInRange(GetSpellInfo(133), ability.Target) == 1 then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Живая бомба (Focus)">
            <SpellID>44457</SpellID>
            <Target>Focus</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if not HasDebuff(ability.Target, 44457, "PLAYER") then
    if IsSpellInRange(GetSpellInfo(133), ability.Target) == 1 then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Живая бомба (Mouseover)">
            <SpellID>44457</SpellID>
            <Target>Mouseover</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if not HasDebuff(ability.Target, 44457, "PLAYER") then
    if IsSpellInRange(GetSpellInfo(133), ability.Target) == 1 then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Огненная глыба">
            <SpellID>11366</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>true</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- Огненная глыба! (48108)
if HasBuff("player", 48108) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Пламенный взрыв">
            <SpellID>108853</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>true</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if isInRange and HasBuff("player", 48107) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Ожoг">
            <SpellID>2948</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>Moving</IsMovingCheck>
            <Lua><![CDATA[
return true;
]]></Lua>
          </Ability>
          <Ability Name="Огненный шар">
            <SpellID>133</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>NotMoving</IsMovingCheck>
            <Lua><![CDATA[
return true;
]]></Lua>
          </Ability>
        </AbilityList>
      </Rotation>
      <Rotation Name="Лед">
        <HotKey Key="X" Modifier="Alt" />
        <AbilityList>
          <Ability Name="Инициализация">
            <SpellID>0</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- модификатор
if     IsModKeyDown(mkLeftShift) then
elseif IsModKeyDown(mkLeftControl) then
    if setAoE then
        setAoE = false;
        print("|cff00ff00 >> Одиночная цель");
    else
        setAoE = true;
        print("|cffff0000 >> AOE");
    end
elseif IsModKeyDown(mkLeftAlt) then
    return true;
elseif IsModKeyDown(mkRightShift) then
    if useCooldown then
        useCooldown = false;
        print("|cffff0000Кулдауны выключены");
    else
        useCooldown = true;
        print("|cff00ff00Кулдауны включены");
    end
elseif IsModKeyDown(mkRightControl) then
elseif IsModKeyDown(mkRightAlt) then
end

if IsMounted() or HasBuff("player", 87959) then
    return true;
end

isInRange = IsSpellInRange(GetSpellInfo(116), "target") == 1;

-- камень здоровья
if HealthByPercent("player") < 30 then
    UseItemById(5512);
end

-- Холод элементаля (33395)
if IsMouseButtonDown(4) then
    if SpellCD(33395) == 0 then
        CastSpellByID(33395);
        CameraOrSelectOrMoveStart();
        CameraOrSelectOrMoveStop();
        CastSpellByID(33395);
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Замедленное падение">
            <SpellID>130</SpellID>
            <Target>Player</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- надо тестировать
if not IsFalling() then
    falingStartTime = 0;
elseif IsFalling() and (falingStartTime or 0) == 0 then
    falingStartTime = GetTime();
elseif GetTime() - (falingStartTime or 0) > 1 and not HasBuff("player", 130) then
    falingStartTime = 0;
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Чародейская гениальность">
            <SpellID>1459</SpellID>
            <Target>Player</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return not HasBuff("player", 1459);
]]></Lua>
          </Ability>
          <Ability Name="Снежная Буря">
            <SpellID>10</SpellID>
            <Target>MouseLocation</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return IsModKeyDown(mkLeftShift);
]]></Lua>
          </Ability>
          <Ability Name="Антимагия">
            <SpellID>2139</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return CheckInterrupt(ability.Target);
]]></Lua>
          </Ability>
          <Ability Name="Ледяная преграда">
            <SpellID>11426</SpellID>
            <Target>Player</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return not HasBuff("player", 11426);
]]></Lua>
          </Ability>
          <Ability Name="Живая бомба">
            <SpellID>44457</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if not HasDebuff(ability.Target, 44457, "PLAYER") then
    return IsSpellInRange(GetSpellInfo(116), ability.Target) == 1;
end
]]></Lua>
          </Ability>
          <Ability Name="Живая бомба">
            <SpellID>44457</SpellID>
            <Target>Focus</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if not HasDebuff(ability.Target, 44457, "PLAYER") then
    return IsSpellInRange(GetSpellInfo(116), ability.Target) == 1;
end
]]></Lua>
          </Ability>
          <Ability Name="Живая бомба">
            <SpellID>44457</SpellID>
            <Target>Mouseover</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if not HasDebuff(ability.Target, 44457, "PLAYER") then
    return IsSpellInRange(GetSpellInfo(116), ability.Target) == 1;
end
]]></Lua>
          </Ability>
          <Ability Name="Стрела ледяного огня">
            <SpellID>44614</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return HasBuff("player", 44549) ~= nil;
]]></Lua>
          </Ability>
          <Ability Name="Ледяное копье">
            <SpellID>30455</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if HasBuff("player", 112965) or (IS_MOVING and not HasBuff("player", 108839)) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Плавучая льдина">
            <SpellID>108839</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>Moving</IsMovingCheck>
            <Lua><![CDATA[
if isInRange then
    local bufs = {
        44549,  -- Заморозка мозгов
        108839, -- Плавучая льдина
        112965, -- Ледяные пальцы
    };
    if not HasBuff("player", bufs) then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Ледяная стрела">
            <SpellID>116</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>NotMoving</IsMovingCheck>
            <Lua><![CDATA[
return true;
]]></Lua>
          </Ability>
          <Ability Name="Морозный доспех">
            <SpellID>7302</SpellID>
            <Target>Player</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>NotMoving</IsMovingCheck>
            <Lua><![CDATA[
return not HasBuff("player", 7302);
]]></Lua>
          </Ability>
        </AbilityList>
      </Rotation>
      <Rotation Name="Тайная магия">
        <HotKey Key="C" Modifier="Alt" />
        <AbilityList />
      </Rotation>
    </RotationList>
  </Profile>
  <Profile Class="Warlock">
    <Lua><![CDATA[
useCooldown = true;

function QuestCore()

    if IsModKeyDown(mkRightAlt) then
        RunMacroText("/tar Властитель преисподней");
        RunMacroText("/cast Порабощение демона");
        return true;
    end

    --if UnitName("pet") == "Властитель преисподней" then
        
        if HealthByPercent("player") < 60 then
            -- Пламенное дыхание Скверны
            if SpellCD(138813) == 0 then
                CastSpellByName(GetSpellInfo(138813), "player");
            end
        end

        -- катаклизм
        if UnitCastingInfo("focus") == GetSpellInfo(138564) then
            -- рывок
            if SpellCD(138796) == 0 then
                CastSpellByName(GetSpellInfo(138796), "focus");
            end
        end

        -- Стрела хаоса
        if UnitCastingInfo("focus") == GetSpellInfo(138559) then
            -- Демонический круг: Телепортация
            if SpellCD(48020) == 0 then
                SpellStopCasting();
                CastSpellByName(GetSpellInfo(48020));
            end
        end
    --else
    --    if UnitExists("Властитель преисподней") then
    --        TargetUnit("Властитель преисподней");
    --        if UnitName("target") == "Властитель преисподней" then
    --            CastSpellByName(GetSpellInfo(1098), "target");
    --        end
    --    end
    --end


    if UnitName("mouseover") == "Владыка судеб" then
        if not HasDebuff("mouseover", 710) then
            CastSpellByName("Изгнание", "mouseover");
        end
    end

end
]]></Lua>
    <RotationList>
      <Rotation Name="Демонология">
        <HotKey Key="X" Modifier="Alt" />
        <AbilityList>
          <Ability Name="Инициализация">
            <SpellID>0</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- модификатор
if     IsModKeyDown(mkLeftShift) then
elseif IsModKeyDown(mkLeftControl) then
    if setAoE then
        setAoE = false;
        print("|cff00ff00 >> Одиночная цель");
    else
        setAoE = true;
        print("|cffff0000 >> AOE");
    end
elseif IsModKeyDown(mkLeftAlt) then
    return true;
elseif IsModKeyDown(mkRightShift) then
    if useCooldown then
        useCooldown = false;
        print("|cffff0000Кулдауны выключены");
    else
        useCooldown = true;
        print("|cff00ff00Кулдауны включены");
    end
elseif IsModKeyDown(mkRightControl) then
elseif IsModKeyDown(mkRightAlt) then
end

isInRange = IsSpellInRange(GetSpellInfo(172), "target") == 1;

if IsMounted() then
    return true;
end

power2 = 0;
if GetSpecialization() == 1 then     -- aflyction
    power2 = UnitPower("player", SPELL_POWER_SOUL_SHARDS);
elseif GetSpecialization() == 2 then -- demonology
    power2 = UnitPower("player", SPELL_POWER_DEMONIC_FURY);
    if power2 < 100 or select(3, HasDebuff("target", 172, "PLAYER")) < 2 then
        CancelShapeshiftForm();
    end
elseif GetSpecialization() == 3 then -- dectruction
    power2 = UnitPower("player", SPELL_POWER_BURNING_EMBERS);
end

-- камень здоровья
if HealthByPercent("player") < 30 then
    UseItemById(5512);
end
]]></Lua>
          </Ability>
          <Ability Name="Метаморфоза">
            <SpellID>103958</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if GetShapeshiftForm() ~= 1 and power2 > 150 then
    if power2 > 990 or select(3, HasDebuff("target", 603, "PLAYER")) < 2 then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Рок">
            <SpellID>603</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if isInRange then
    if GetShapeshiftForm() == 1 then
        if select(3, HasDebuff("target", 603, "PLAYER")) < 2 then
            return true;
        end
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Порча (Target)">
            <SpellID>172</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if GetShapeshiftForm() ~= 1 then
    if select(3, HasDebuff("target", 172, "PLAYER")) < 2 then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Порча (Focus)">
            <SpellID>172</SpellID>
            <Target>Focus</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if GetShapeshiftForm() ~= 1 then
    if select(3, HasDebuff("focus", 172, "PLAYER")) < 2 then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Порча (Mouseover)">
            <SpellID>172</SpellID>
            <Target>Mouseover</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if GetShapeshiftForm() ~= 1 then
    if select(3, HasDebuff("mouseover", 172, "PLAYER")) < 2 then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Рука Гул'дана">
            <SpellID>105174</SpellID>
            <Target>Target</Target>
            <CancelChannel>true</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if not HasBuff("target", 47960) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Ожег души">
            <SpellID>6353</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if HasBuff("target", 122351) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Стрела тьмы">
            <SpellID>686</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return true;
]]></Lua>
          </Ability>
          <Ability Name="Узы тьмы">
            <SpellID>109773</SpellID>
            <Target>Player</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if UnitLevel("player") > 81 and not HasBuff("player", 109773) then
    return true;
end
]]></Lua>
          </Ability>
        </AbilityList>
      </Rotation>
      <Rotation Name="Разрушение">
        <HotKey Key="Z" Modifier="Alt" />
        <Lua><![CDATA[
useChaosBold = true;
]]></Lua>
        <AbilityList>
          <Ability Name="Инициализация">
            <SpellID>0</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- модификатор
if     IsModKeyDown(mkLeftShift) then
elseif IsModKeyDown(mkLeftControl) then
    if useChaosBold then
        useChaosBold = false;
        AddonFrame.print("|cffff0000 Стрела хаоса отключена", 1);

    else
        useChaosBold = true;
        AddonFrame.print("|cff00ff00 Стрела хаоса включена", 1);
    end
elseif IsModKeyDown(mkLeftAlt) then
    return true;
elseif IsModKeyDown(mkRightShift) then
    if useCooldown then
        useCooldown = false;
        AddonFrame.print("|cffff0000Кулдауны выключены", 1);
    else
        useCooldown = true;
        AddonFrame.print("|cff00ff00Кулдауны включены", 1);
    end
elseif IsModKeyDown(mkRightControl) then
elseif IsModKeyDown(mkRightAlt) then
end

isInRange = IsSpellInRange(GetSpellInfo(172), "target") == 1;
]]></Lua>
          </Ability>
          <Ability Name="Неистовство тьмы">
            <SpellID>30283</SpellID>
            <Target>MouseLocation</Target>
            <CancelChannel>true</CancelChannel>
            <CancelCasting>true</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if IsMouseButtonDown(3) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Удар кнутом">
            <SpellID>119909</SpellID>
            <Target>MouseLocation</Target>
            <CancelChannel>true</CancelChannel>
            <CancelCasting>true</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if IsMouseButtonDown(3) then
    local cd = SpellCD(30283);
    if cd > 0 and cd < 28 then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Пауза">
            <SpellID>0</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if IsMounted() then
    return true;
end

power2           = UnitPower("player", SPELL_POWER_BURNING_EMBERS);
FireAndBrimstone = HasBuff("player", 108683); -- огонь и сера
ChaosCount       = select(2, HasBuff("player", 80240));-- хаос
RainOfFire       = HasBuff("player", 104232); -- огненный ливень

-- камень здоровья
if HealthByPercent("player") < 30 then
    UseItemById(5512);
end

-- Установка пета в указанную позицию
if IsMouseButtonDown(4) then
    PetMoveTo();
    CameraOrSelectOrMoveStart();
    CameraOrSelectOrMoveStop();
    PetMoveTo();
end

------------------------------------------------
--    CD
------------------------------------------------

-- Копим угли
if useCooldown and SpellCD(113858) < (40 - (power2 * 10)) then
    useChaosBold = false;
end

-- Сливаем угли
if useCooldown and HasBuff("player", 113858) then
    UseItemBySlot(INVSLOT_TRINKET1);
    UseItemBySlot(INVSLOT_TRINKET1);
    UseItemBySlot(INVSLOT_HAND);
    useChaosBold = true;
end

-- quest
--return QuestCore();
]]></Lua>
          </Ability>
          <Ability Name="Огненный ливень">
            <SpellID>104232</SpellID>
            <Target>MouseLocation</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if IsModKeyDown(mkLeftShift) then
    if not HasBuff("player", 104232) then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Запрет чар">
            <SpellID>119910</SpellID>
            <Target>Target</Target>
            <CancelChannel>true</CancelChannel>
            <CancelCasting>true</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return CheckInterrupt(ability.Target);
]]></Lua>
          </Ability>
          <Ability Name="Запрет чар">
            <SpellID>132409</SpellID>
            <Target>Target</Target>
            <CancelChannel>true</CancelChannel>
            <CancelCasting>true</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return CheckInterrupt(ability.Target);
]]></Lua>
          </Ability>
          <Ability Name="Проклятие стихий">
            <SpellID>1490</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if UnitHealth(ability.Target) > (UnitHealthMax("player")*2) then
    if not HasDebuff(ability.Target, 1490, "PLAYER") then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Ожоги тьмы">
            <SpellID>17877</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>true</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if power2 > 0 and useChaosBold and HealthByPercent(ability.Target) < 20 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Черная душа: Изменчивость">
            <SpellID>113858</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>NotMoving</IsMovingCheck>
            <Lua><![CDATA[
if isInRange and useCooldown and power2 > 3 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Завеса сумерек">
            <SpellID>6229</SpellID>
            <Target>Player</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if not HasBuff("player", 6229) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Хаос">
            <SpellID>80240</SpellID>
            <Target>Focus</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>NotMoving</IsMovingCheck>
            <Lua><![CDATA[
if power2 > 0 and not RainOfFire and not FireAndBrimstone and ChaosCount == 0 then
    if UnitExists("target")
        and not UnitIsUnit(ability.Target, "target")
        and UnitIsEnemy("target", "player") then
        if not HasDebuff(ability.Target, 80240, "PLAYER") then
            return true;
        end
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Хаос">
            <SpellID>80240</SpellID>
            <Target>Mouseover</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>NotMoving</IsMovingCheck>
            <Lua><![CDATA[
if power2 > 0 and not RainOfFire and not FireAndBrimstone and ChaosCount == 0 then
    if UnitExists("target")
        and not (UnitIsUnit(ability.Target, "target") or UnitIsUnit(ability.Target, "focus"))
        and UnitIsEnemy("target", "player") then
        if not HasDebuff(ability.Target, 80240, "PLAYER") then
            return true;
        end
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Огонь и сера">
            <SpellID>108683</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if isInRange and power2 > 0 and HasBuff("player", 104232) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Жертвенный огонь (AOE)">
            <SpellID>108686</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>true</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>NotMoving</IsMovingCheck>
            <Lua><![CDATA[
if UnitHealth(ability.Target) < UnitHealthMax("player") then
    return;
end

if FireAndBrimstone and power2 > 0 and isInRange and ChaosCount < 3
    and IsSpellKnown(108683) then
    if select(3, HasDebuff(ability.Target, 108686, "PLAYER")) < 3 then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Жертвенный огонь">
            <SpellID>348</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>true</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>NotMoving</IsMovingCheck>
            <Lua><![CDATA[
if UnitHealth(ability.Target) < UnitHealthMax("player") then
    return;
end

if not FireAndBrimstone and isInRange and ChaosCount < 3 then
    if select(3, HasDebuff(ability.Target, 348, "PLAYER")) < 3 then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Жертвенный огонь">
            <SpellID>348</SpellID>
            <Target>Focus</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>true</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>NotMoving</IsMovingCheck>
            <Lua><![CDATA[
if UnitHealth(ability.Target) < UnitHealthMax("player") then
    return;
end

if not FireAndBrimstone and isInRange and ChaosCount < 3 then
    if select(3, HasDebuff(ability.Target, 348, "PLAYER")) < 3 then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Жертвенный огонь">
            <SpellID>348</SpellID>
            <Target>Mouseover</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>true</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>NotMoving</IsMovingCheck>
            <Lua><![CDATA[
if UnitHealth(ability.Target) < UnitHealthMax("player") then
    return;
end

if not FireAndBrimstone and isInRange and ChaosCount < 3 then
    if select(3, HasDebuff(ability.Target, 348, "PLAYER")) < 3 then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Стрела хаоса">
            <SpellID>116858</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>true</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>NotMoving</IsMovingCheck>
            <Lua><![CDATA[
if useChaosBold and power2 > 0 and not FireAndBrimstone then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Поджигаие">
            <SpellID>17962</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if isInRange and ChaosCount < 3 then
    -- Если нету бафа обратного потока
    if not HasBuff("player", 117828) then
        if FireAndBrimstone then
            return power2 > 1;
        else
            return true;
        end
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Испепеление">
            <SpellID>29722</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if IS_MOVING or IsPlayerSpell(137587) then
    return isInRange;
end
]]></Lua>
          </Ability>
          <Ability Name="Пламя скверны">
            <SpellID>77799</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>Moving</IsMovingCheck>
            <Lua><![CDATA[
if PowerByPercent("player") > 30 then
    if select(2, HasBuff("player", 80240)) < 3 then
        return true;
    end
end
]]></Lua>
          </Ability>
        </AbilityList>
      </Rotation>
      <Rotation Name="Колдовство">
        <HotKey Key="C" Modifier="Alt" />
        <AbilityList>
          <Ability Name="Инициализация">
            <SpellID>0</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- модификатор
if     IsModKeyDown(mkLeftShift) then
elseif IsModKeyDown(mkLeftControl) then
    if setAoE then
        setAoE = false;
        print("|cff00ff00 >> Одиночная цель");
    else
        setAoE = true;
        print("|cffff0000 >> AOE");
    end
elseif IsModKeyDown(mkLeftAlt) then
    return true;
elseif IsModKeyDown(mkRightShift) then
    if useCooldown then
        useCooldown = false;
        print("|cffff0000Кулдауны выключены");
    else
        useCooldown = true;
        print("|cff00ff00Кулдауны включены");
    end
elseif IsModKeyDown(mkRightControl) then
elseif IsModKeyDown(mkRightAlt) then
end

isInRange = IsSpellInRange(GetSpellInfo(172), "target") == 1;

if IsMounted() then
    return true;
end

power2 = 0;
if GetSpecialization() == 1 then     -- aflyction
    power2 = UnitPower("player", SPELL_POWER_SOUL_SHARDS);
elseif GetSpecialization() == 2 then -- demonology
    power2 = UnitPower("player", SPELL_POWER_DEMONIC_FURY);
    if power2 < 100 or select(3, HasDebuff("target", 172, "PLAYER")) < 2 then
        CancelShapeshiftForm();
    end
elseif GetSpecialization() == 3 then -- dectruction
    power2 = UnitPower("player", SPELL_POWER_BURNING_EMBERS);
end

-- камень здоровья
if HealthByPercent("player") < 30 then
    UseItemById(5512);
end
]]></Lua>
          </Ability>
          <Ability Name="Семя порчи">
            <SpellID>27243</SpellID>
            <Target>Target</Target>
            <CancelChannel>true</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return setAoE;
]]></Lua>
          </Ability>
          <Ability Name="Блуждающий дух">
            <SpellID>48181</SpellID>
            <Target>Target</Target>
            <CancelChannel>true</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>true</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if power2 > 0 and not HasDebuff(ability.Target, ability.SpellId, "PLAYER") then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Агония (Target)">
            <SpellID>980</SpellID>
            <Target>Target</Target>
            <CancelChannel>true</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if select(3, HasDebuff(ability.Target, ability.SpellId, "PLAYER")) < 2 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Агония (Focus)">
            <SpellID>980</SpellID>
            <Target>Focus</Target>
            <CancelChannel>true</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if select(3, HasDebuff(ability.Target, ability.SpellId, "PLAYER")) < 2 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Агония (Mouseover)">
            <SpellID>980</SpellID>
            <Target>Mouseover</Target>
            <CancelChannel>true</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if select(3, HasDebuff(ability.Target, ability.SpellId, "PLAYER")) < 2 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Порча (Target)">
            <SpellID>172</SpellID>
            <Target>Target</Target>
            <CancelChannel>true</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if select(3, HasDebuff(ability.Target, ability.SpellId, "PLAYER")) < 2 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Порча (Focus)">
            <SpellID>172</SpellID>
            <Target>Focus</Target>
            <CancelChannel>true</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if select(3, HasDebuff(ability.Target, ability.SpellId, "PLAYER")) < 2 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Порча (Mouseover)">
            <SpellID>172</SpellID>
            <Target>Mouseover</Target>
            <CancelChannel>true</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if select(3, HasDebuff(ability.Target, ability.SpellId, "PLAYER")) < 2 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Нестабильное колдовство (Target)">
            <SpellID>30108</SpellID>
            <Target>Target</Target>
            <CancelChannel>true</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>true</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>NotMoving</IsMovingCheck>
            <Lua><![CDATA[
if select(3, HasDebuff(ability.Target, ability.SpellId, "PLAYER")) < 2 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Нестабильное колдовство (Focus)">
            <SpellID>30108</SpellID>
            <Target>Focus</Target>
            <CancelChannel>true</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>true</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>NotMoving</IsMovingCheck>
            <Lua><![CDATA[
if select(3, HasDebuff(ability.Target, ability.SpellId, "PLAYER")) < 2 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Нестабильное колдовство (Mouseover)">
            <SpellID>30108</SpellID>
            <Target>Mouseover</Target>
            <CancelChannel>true</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>true</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>NotMoving</IsMovingCheck>
            <Lua><![CDATA[
if select(3, HasDebuff(ability.Target, ability.SpellId, "PLAYER")) < 2 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Похищение души">
            <SpellID>1120</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if HealthByPercent(ability.Target) <= 20 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Гибельная хватка">
            <SpellID>103103</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if HealthByPercent(ability.Target) > 20 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Пламя Скверны">
            <SpellID>77799</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>Moving</IsMovingCheck>
            <Lua><![CDATA[
return true;
]]></Lua>
          </Ability>
          <Ability Name="Узы тьмы">
            <SpellID>109773</SpellID>
            <Target>Player</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if UnitLevel("player") > 81 and not HasBuff("player", 109773) then
    return true;
end
]]></Lua>
          </Ability>
        </AbilityList>
      </Rotation>
    </RotationList>
  </Profile>
  <Profile Class="Monk">
    <Lua><![CDATA[
useCooldown = true;
]]></Lua>
    <RotationList>
      <Rotation Name="Ткач туманов">
        <HotKey Key="X" Modifier="Alt" />
        <AbilityList />
      </Rotation>
      <Rotation Name="Хмелевар">
        <HotKey Key="Z" Modifier="Alt" />
        <AbilityList>
          <Ability Name="Инициализация">
            <SpellID>0</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if     IsModKeyDown(mkLeftShift) then
elseif IsModKeyDown(mkLeftControl) then
    if setAoE then
        setAoE = false;
        AddonFrame.print("|cff00ff00 >> Одиночная цель", true);
    else
        setAoE = true;
        AddonFrame.print("|cffff0000 >> AOE", true);
    end
elseif IsModKeyDown(3) then
    return true;
elseif IsModKeyDown(4) then
    if useCooldown then
        useCooldown = false;
        AddonFrame.print("|cffff0000Кулдауны выключены", true);
    else
        useCooldown = true;
        AddonFrame.print("|cff00ff00Кулдауны включены", true);
    end
elseif IsModKeyDown(5) then
elseif IsModKeyDown(6) then
end

-- если персонаж на маунте, тогда не выполняем ротацию дальше
if IsMounted() then
    return true;
end

isInMeele  = IsSpellInRange(GetSpellInfo(100787), "target") == 1;
agroStatus = UnitThreatSituation("player") or 0;
playerHP   = HealthByPercent("player");
energy     = UnitPower("player");     -- energy
chi        = UnitPower("player", 12); -- chi

additionalChi = 0;
if IsSpellKnown(115396) then
    additionalChi = 1;
end

TP  = HasBuff("player",   125359);            -- Сила тигра
BoF = HasDebuff("target", 123725, "PLAYER");  -- Пламенное дыхание
DH  = HasDebuff("target", 123727, "PLAYER");  -- Хмельная дымка
SR  = select(3, HasBuff("player",   115307)); -- Скрытые резервы

-- камень здоровья
if HealthByPercent("player") < 30 then
    UseItemById(5512);
end
]]></Lua>
          </Ability>
          <Ability Name="Целительная сфера">
            <SpellID>115460</SpellID>
            <Target>MouseLocation</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if IsModKeyDown(mkRightAlt) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Хмельная дымка">
            <SpellID>115180</SpellID>
            <Target>MouseLocation</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if IsModKeyDown(mkLeftShift) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Смертельное касание">
            <SpellID>115080</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if chi > 2 and not UnitIsPlayer("target") and UnitHealth("target") < UnitHealthMax("player") then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Рука-копье">
            <SpellID>116705</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return CheckInterrupt("target");
]]></Lua>
          </Ability>
          <Ability Name="Отвар неуловимости">
            <SpellID>115308</SpellID>
            <Target>Player</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if select(2, HasBuff("player", 115308)) > 9 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Очищающий отвар">
            <SpellID>119582</SpellID>
            <Target>Player</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- (124275) Легкое пошатывание
-- (124274) Умеренное пошатывание
-- (124273) Сильное пошатывание
-- Снимаем только при "Сильном пошатывании"
if chi > 0 and HasDebuff("player", 124273) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Защита">
            <SpellID>115295</SpellID>
            <Target>Player</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if agroStatus > 2 and HasBuff("player", 118636) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Укрепляющий отвар">
            <SpellID>115203</SpellID>
            <Target>Player</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if playerHP < 40 and useCooldown then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Пламенное дыхание">
            <SpellID>115181</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if isInMeele and setAoE and chi > 2 then
    -- Хмельная дымка             
    if HasDebuff("target", 123727, "PLAYER")
    -- Пламенное дыхание
    and not HasDebuff("target", 123725, "PLAYER") then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Порыв нефритового ветра">
            <SpellID>116847</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if setAoE and chi >= 2 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Удар кружкой">
            <SpellID>121253</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if chi < (2 + additionalChi) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Танцующий журавль">
            <SpellID>101546</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if isInMeele and setAoE and chi > 2 then
    if HasDebuff("target", 123727, "PLAYER")
    and not HasDebuff("target", 123725, "PLAYER") then
        return false;
    end
end
if setAoE and isInMeele and energy >= 40 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Устранение вреда">
            <SpellID>115072</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if isInMeele and playerHP < 90 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Дзуки">
            <SpellID>100780</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if (chi < 3 or energy > 85) and SpellCD(121253) > 1 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Лапа тигра">
            <SpellID>100787</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if (chi < 3 and energy < 40) or not HasBuff("player", 125359) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Нокаутирующий удар">
            <SpellID>100784</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if chi >= 3 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Наследие императора">
            <SpellID>117666</SpellID>
            <Target>Player</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
local params_buff = { 1126, 115921, 20217, 90363 };
if not HasBuff("player", params_buff) then
    return true;
end
]]></Lua>
          </Ability>
        </AbilityList>
      </Rotation>
      <Rotation Name="Танцующий с ветром">
        <HotKey Key="C" Modifier="Alt" />
        <Notes><![CDATA[
actions+=/chi_sphere,if=talent.power_strikes.enabled&buff.chi_sphere.react&chi<4
actions+=/virmens_bite_potion,if=buff.bloodlust.react|target.time_to_die<=60
actions+=/chi_brew,if=talent.chi_brew.enabled&chi<=2&(trinket.proc.agility.react|(charges=1&recharge_time<=10)|charges=2|target.time_to_die<charges*10)
actions+=/tiger_palm,if=buff.tiger_power.remains<=3
actions+=/tigereye_brew,if=buff.tigereye_brew_use.down&buff.tigereye_brew.stack=20
actions+=/tigereye_brew,if=buff.tigereye_brew_use.down&trinket.proc.agility.react
actions+=/tigereye_brew,if=buff.tigereye_brew_use.down&chi>=2&(trinket.proc.agility.react|buff.tigereye_brew.stack>=15|target.time_to_die<40)&debuff.rising_sun_kick.up&buff.tiger_power.up
actions+=/energizing_brew,if=energy.time_to_max>5
actions+=/rising_sun_kick,if=debuff.rising_sun_kick.down
actions+=/tiger_palm,if=buff.tiger_power.down&debuff.rising_sun_kick.remains>1&energy.time_to_max>1
actions+=/invoke_xuen,if=talent.invoke_xuen.enabled
actions+=/run_action_list,name=aoe,if=active_enemies>=3
actions+=/run_action_list,name=single_target,if=active_enemies<3

actions.aoe=rushing_jade_wind,if=talent.rushing_jade_wind.enabled
actions.aoe+=/zen_sphere,cycle_targets=1,if=talent.zen_sphere.enabled&!dot.zen_sphere.ticking
actions.aoe+=/chi_wave,if=talent.chi_wave.enabled
actions.aoe+=/chi_burst,if=talent.chi_burst.enabled
actions.aoe+=/rising_sun_kick,if=chi=chi.max
actions.aoe+=/spinning_crane_kick,if=!talent.rushing_jade_wind.enabled

actions.single_target=rising_sun_kick
actions.single_target+=/fists_of_fury,if=buff.energizing_brew.down&energy.time_to_max>4&buff.tiger_power.remains>4
actions.single_target+=/chi_wave,if=talent.chi_wave.enabled&energy.time_to_max>2
actions.single_target+=/chi_burst,if=talent.chi_burst.enabled&energy.time_to_max>2
actions.single_target+=/zen_sphere,cycle_targets=1,if=talent.zen_sphere.enabled&energy.time_to_max>2&!dot.zen_sphere.ticking
actions.single_target+=/blackout_kick,if=buff.combo_breaker_bok.react
actions.single_target+=/tiger_palm,if=buff.combo_breaker_tp.react&(buff.combo_breaker_tp.remains<=2|energy.time_to_max>=2)
actions.single_target+=/jab,if=chi.max-chi>=2
actions.single_target+=/blackout_kick,if=energy+energy.regen*cooldown.rising_sun_kick.remains>=40
]]></Notes>
        <AbilityList>
          <Ability Name="Инициализация">
            <SpellID>0</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
energy = UnitPower("player");     -- energy
chi    = UnitPower("player", SPELL_POWER_LIGHT_FORCE); -- chi
]]></Lua>
          </Ability>
          <Ability Name="Смертельное касание">
            <SpellID>115080</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if chi > 2 and not UnitIsPlayer("target") and UnitHealth("target") < UnitHealthMax("player") then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Будоражащий отвар">
            <SpellID>115288</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if energi < 40 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Лапа тигра">
            <SpellID>100787</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if chi > 0
]]></Lua>
          </Ability>
        </AbilityList>
      </Rotation>
    </RotationList>
  </Profile>
  <Profile Class="Druid">
    <Lua><![CDATA[
useCooldown = true;
setAoE      = nil;
isCat       = nil;
useAutoDispell = true;
]]></Lua>
    <RotationList>
      <Rotation Name="Лекарь">
        <HotKey Key="Z" Modifier="Alt" />
        <AbilityList>
          <Ability Name="Инициализация">
            <SpellID>0</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- модификатор
if     IsModKeyDown(mkLeftShift) then
    for index=1,5 do 
    	if not IsRaidMarkerActive(index) then
    		PlaceRaidMarker(index);
    		break;
    	end
    end
    return true;
--elseif IsModKeyDown(mkLeftControl) then
--elseif IsModKeyDown(mkLeftAlt) then
--elseif IsModKeyDown(mkRightShift) then
elseif IsModKeyDown(mkRightControl) then
    if useAutoDispell then
        useAutoDispell = false;
        AddonFrame.print("|cffff0000Автодиспел выключен", true);
    else
        useAutoDispell = true;
        AddonFrame.print("|cff00ff00Автодиспел включен", true);
    end
elseif IsModKeyDown(mkRightAlt) then
    if useDamage then
        useDamage = false;
        AddonFrame.print("|cffff0000Нанесение урона выключено", true);
    else
        useDamage = true;
        AddonFrame.print("|cff00ff00Нанесение урона включено", true);
    end
end

FillPartyTables(774);

myMana = PowerByPercent("player", SPELL_POWER_MANA);
]]></Lua>
          </Ability>
          <Ability Name="Возрождение">
            <SpellID>20484</SpellID>
            <Target>Mouseover</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>NotMoving</IsMovingCheck>
            <Lua><![CDATA[
return UnitIsDeadOrGhost(ability.Target);
]]></Lua>
          </Ability>
          <Ability Name="Оживление">
            <SpellID>50769</SpellID>
            <Target>Mouseover</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>NotMoving</IsMovingCheck>
            <Lua><![CDATA[
if not UnitAffectingCombat("player")
    and (UnitIsDeadOrGhost(ability.Target) or UnitIsCorpse(ability.Target)) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Дикий гриб">
            <SpellID>88747</SpellID>
            <Target>MouseLocation</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- Колеcико мышки
return IsMouseButtonDown(3);
]]></Lua>
          </Ability>
          <Ability Name="Пауза">
            <SpellID>0</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- если персонаж на маунте или в форме или "Слился с тенью", тогда не выполняем ротацию дальше
if IsMounted() or IsStealthed() 
    or (GetShapeshiftForm() ~= 0 and GetShapeshiftForm() ~= 6) then
    return true;
end

-- Если кастуем спокойствие - тогда ничего не делаем
if UnitChannelInfo("player") then
    return true;
end

-- используем аксесуар на ману, только в форме исцеления (0)
if myMana < 80 and GetShapeshiftForm() == 0 then
    UseItemBySlot(INVSLOT_TRINKET2);
end

if myMana < 90 and GetShapeshiftForm() == 0 then
    UseItemBySlot(INVSLOT_TRINKET1);
end

-- камень здоровья
if HealthByPercent("player") < 30 then
    UseItemById(5512);
end

if LowHP.H70 > 3 and UnitAffectingCombat("player") then
    UseItemBySlot(INVSLOT_HAND); -- Нейронные пружины
end
]]></Lua>
          </Ability>
          <Ability Name="Природный целитель">
            <SpellID>88423</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if IsMouseButtonDown(5) then
    if UnitExists("mouseover") then
        return "mouseover";
    end
end
if useAutoDispell then
    return GetDispellInfo("HEAL");
end
]]></Lua>
          </Ability>
          <Ability Name="Очищение (Симбоз)">
            <SpellID>122288</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if useAutoDispell then
    return GetDispellInfo("SIMBIOS");
end
]]></Lua>
          </Ability>
          <Ability Name="Озарение">
            <SpellID>29166</SpellID>
            <Target>Player</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if PowerByPercent("player", SPELL_POWER_MANA) <= 70
    and (GetShapeshiftForm() == 0 or GetShapeshiftForm() == 6) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Железная кора">
            <SpellID>102342</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if members[1].HP < 30 then
    return members[1].Unit;
end
]]></Lua>
          </Ability>
          <Ability Name="Дубовая кора">
            <SpellID>22812</SpellID>
            <Target>Player</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
local debuff,_,rem = HasDebuff("player", 144330);
-- Переписать: используя обобщение с другими ротациями.
if HealthByPercent("player") < 25 then
    return true;
elseif debuff and rem < 4 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Умиротворение">
            <SpellID>2908</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if CheckEnrage(ability.Target) then
    print("|cff15bd05>> Снимаю исступление!");
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Буйный рост">
            <SpellID>48438</SpellID>
            <Target>Player</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if LowHP.H80 > 3 then
    return members[1].Unit;
end
]]></Lua>
          </Ability>
          <Ability Name="Целительное прикосновение (Сет)">
            <SpellID>5185</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if members[1].HP <= 80 then
    local count = select(2, HasBuff("player", 144871));
    if count > 4 and IS_MOVING then
        return members[1].Unit;
    elseif count > 2 and not IS_MOVING then
        return members[1].Unit;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Омоложение (Сильный Урон)">
            <SpellID>774</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if IsModKeyDown(mkLeftControl)
and UnitExists("mouseover")
and UnitCanAssist("player", "mouseover")
and not HasBuff("mouseover", 774, "PLAYER") then
    return "mouseover";
end

if LowHP.H50 > 3 or IsModKeyDown(mkLeftControl) then -- Опытным путем надо определить условие
    for _,member in ipairs(members) do
        if member.HP < 55 or (member.Agro > 2 and member.IsTank) or IsModKeyDown(mkLeftControl) then
            if not HasBuff(member.Unit, 774, "PLAYER") then
                return member.Unit;
            end
        end
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Сотворение">
            <SpellID>145518</SpellID>
            <Target>Player</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
local count = 0;
for _,member in ipairs(members) do
    if member.HP < 85 and select(3, HasBuff(member.Unit, 774, "PLAYER")) > 3 then
        count = count + 1;
        if count > 2 then
            print("|cff00ff00 >> Кастую сотворение <<")
            return true;
        end
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Быстрое восстановление">
            <SpellID>18562</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
local buffs = { 774, 8936 };

if HasGlyph(145529) then
    for _,member in ipairs(members) do
        if member.HP < 70 and HasBuff(member.Unit, buffs, "PLAYER") then
            print("|cff00ff00 >> Кастую Быстрое восстановление <<");
            return member.Unit;
        end
    end
elseif LowHP.H80 <= 3 then
    for _,member in ipairs(members) do
        if member.HP < 90 and HasBuff(member.Unit, buffs, "PLAYER") then
            local count = 0;
            for _,unit in ipairs(members) do
                if unit.HP < 90 and (GetDistance(unit, member) or 0xff) < 10 then
                    count = count + 1;
                end
            end
            if count > 2 then
                print("|cff00ff00 >> Кастую Быстрое восстановление <<");
                return member.Unit;
            end
        end
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Природная стремительность">
            <SpellID>132158</SpellID>
            <Target>Player</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return members[1].HP < 35;
]]></Lua>
          </Ability>
          <Ability Name="Восстановление">
            <SpellID>8936</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- 132158 Природная стремительность
if not HasBuff("player", 132158) then
    if IsMouseButtonDown(4) and UnitExists("mouseover") and UnitCanAssist("player", "mouseover") then
        return "mouseover";
    end
    local name,_,rem = HasBuff("player", 16870); -- 16870 Ясность мысли
    local harmony = select(3, HasBuff("player", 100977));
    local hp = members[1].HP;
    if hp <= 40 or (name and ((hp <= 80 and rem < 5) or (hp <= 65 and rem >= 5) or (harmony < 2 and rem < 5))) then
        if GetShapeshiftForm() == 6 or not IS_MOVING then
            return members[1].Unit;
        end
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Жизнецвет">
            <SpellID>33763</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
local hasTank = false;
for _,member in ipairs(members) do
    if member.IsTank then
        hasTank = true;
        break;
    end
end

-- если рейд проседает, то держим 1 стак жизнецвета на танке
local lb_count = LowHP.H50 > 3 and 1 or 3;

-- В рейде накладываем жизнецвет только на танка
-- чтобы во время боя (при агро на 2х танках) жизнецвет не перекидывало с одного на другого.
for _,member in ipairs(members) do
    if member.Agro > 2 and (not hasTank or member.IsTank) then
        local name,count,rem = HasBuff(member.Unit, 33763, "PLAYER");
        -- Обновим стаки жизнецвета
        if name and (count < lb_count or rem < 3) then
            return member.Unit;
        -- Если жизнецвет уже есть, тогда дальше не продолжаем.
        elseif count >= lb_count and rem > 3 then
            return;
        end
    end
end

-- Накладываем жизнецвет на юнита с агро или если в рейде то на танка
for _,member in ipairs(members) do
    if member.Agro > 2 and (not hasTank or member.IsTank) then
        return member.Unit;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Целительное прикосновение">
            <SpellID>5185</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>NotMoving</IsMovingCheck>
            <Lua><![CDATA[
if members[1].HP <= 60 then
    return members[1].Unit;
end
]]></Lua>
          </Ability>
          <Ability Name="Омоложение">
            <SpellID>774</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
for _,member in ipairs(members) do
    if member.HP < 82 or ((not IsInRaid() or member.IsTank) and member.Agro > 2)then
        if not HasBuff(member.Unit, 774, "PLAYER") then
            return member.Unit;
        end
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Покровительство природы">
            <SpellID>50464</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>true</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>NotMoving</IsMovingCheck>
            <Lua><![CDATA[
if LowHP.H80 < 3 then
    if members[1].HP < 80 or select(3, HasBuff("player", 100977)) < 2 then
        return members[1].Unit;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Знак дикой природы">
            <SpellID>1126</SpellID>
            <Target>Player</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
local params_buff = { 1126, 115921, 20217, 90363 };
if type(members) == "table" and GetShapeshiftForm() == 0 then
    for _,member in ipairs(members) do
        if member.IsInMyParty and UnitIsPlayer(member.Unit) and not HasBuff(member.Unit, params_buff) then
            return true;
        end
    end
elseif not UnitAffectingCombat("player") then
    if not HasBuff("player", params_buff) then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Лунный огонь">
            <SpellID>8921</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>true</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if useDamage and select(3, HasDebuff("target", 8921, "PLAYER")) < 2 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Гнев">
            <SpellID>5176</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>NotMoving</IsMovingCheck>
            <Lua><![CDATA[
return useDamage;
]]></Lua>
          </Ability>
        </AbilityList>
      </Rotation>
      <Rotation Name="Страж">
        <HotKey Key="X" Modifier="Alt" />
        <AbilityList>
          <Ability Name="Инициализация">
            <SpellID>0</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if     IsModKeyDown(mkLeftShift) then
elseif IsModKeyDown(mkLeftControl) then
    if setAoE then
        setAoE = false;
        AddonFrame.print("|cff00ff00 Одиночная цель", true);
    else
        setAoE = true;
        AddonFrame.print("|cffff0000 AOE", true);
    end
elseif IsModKeyDown(mkLeftAlt) then
    return true;
elseif IsModKeyDown(mkRightShift) then
    if useCooldown then
        useCooldown = false;
        AddonFrame.print("|cffff0000Кулдауны выключены", true);
    else
        useCooldown = true;
        AddonFrame.print("|cff00ff00Кулдауны включены", true);
    end
elseif IsModKeyDown(mkRightControl) then
elseif IsModKeyDown(mkRightAlt) then
    if isAltMod then
        isAltMod = false;
        AddonFrame.print("|cffff0000Используется \'Дикая защита\'", true);
    else
        isAltMod = true;
        AddonFrame.print("|cff00ff00Используется \'Неистовое восстановление\'", true);
    end
end

-- если персонаж на маунте, или в инвизе или не в форме медведа или кота
if IsMounted() or not (GetShapeshiftForm() == 3 or GetShapeshiftForm() == 1) or IsStealthed() then
    return true;
end

-- камень здоровья
if HealthByPercent("player") < 30 then
    UseItemById(5512);
end

agroStatus = UnitThreatSituation("player") or 0;
playerHP   = HealthByPercent("player");
isInMeele  = IsSpellInRange(GetSpellInfo(33878), "target") == 1;
isCat      = GetShapeshiftForm() == 3;
]]></Lua>
          </Ability>
          <Ability Name="Лобовая атака">
            <SpellID>80964</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return CheckInterrupt("target");
]]></Lua>
          </Ability>
          <Ability Name="Неистовое восстановление">
            <SpellID>22842</SpellID>
            <Target>Player</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>true</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if not isCat then
    if playerHP < 80 and UnitPower("player") > 55 then
        return true;
    elseif playerHP < 50 and UnitPower("player") > 35 then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Дикая защита">
            <SpellID>62606</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if not isCat and playerHP < 60 and agroStatus > 0 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Дубовая кожа">
            <SpellID>22812</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if useCooldown and playerHP < 50 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Инстинкты выживания">
            <SpellID>61336</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if not isCat and useCooldown and playerHP < 35 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Мощь урсока">
            <SpellID>106922</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if useCooldown and playerHP < 25 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Увечье">
            <SpellID>33878</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if not isCat then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Взбучка">
            <SpellID>77758</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if isInMeele and not isCat then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Размах">
            <SpellID>779</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if setAoE and isInMeele and not isCat then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Исступление">
            <SpellID>5229</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if not isCat and UnitPower("player") < 70 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Трепка">
            <SpellID>6807</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- без ГКД
if isCat then
    return false;
end

if playerHP > 80 then
    if HasBuff("player", 135288) then
        return true;
    end
end
if agroStatus < 3 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Волшебный огонь">
            <SpellID>770</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return true;
]]></Lua>
          </Ability>
          <Ability Name="Растерзать">
            <SpellID>33745</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if not isCat then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Взбучка (Кот)">
            <SpellID>106830</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if isCat and setAoE and not HasDebuff("target", 106830, "PLAYER") then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Размах (Кот)">
            <SpellID>62078</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if isCat and setAoE and HasDebuff("target", 106830, "PLAYER") then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Глубокая рана (Кот)">
            <SpellID>1822</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if isCat and select(3, HasDebuff("target", 1822, "PLAYER")) < 2 and not setAoE then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Разорвать (Кот)">
            <SpellID>1079</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if isCat and not setAoE and select(3, HasDebuff("target", 1079, "PLAYER")) < 2 then
    if UnitHealth("target") > (UnitHealthMax("player") / 5) and GetComboPoints("player") > 4 then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Свирепый укус (Кот)">
            <SpellID>22568</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if isCat and not setAoE and UnitPower("player") > 30 and GetComboPoints("player") > 4 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Увечье (Кот)">
            <SpellID>33876</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if isCat and not setAoE then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Знак дикой природы">
            <SpellID>1126</SpellID>
            <Target>Player</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
local params_buff = { 1126, 115921, 20217, 90363 };
if type(members) == "table" and GetShapeshiftForm() == 0 then
    for _,member in ipairs(members) do
        if member.IsInMyParty and UnitIsPlayer(member.Unit) and not HasBuff(member.Unit, params_buff) then
            return true;
        end
    end
elseif not UnitAffectingCombat("player") then
    if not HasBuff("player", params_buff) then
        return true;
    end
end
]]></Lua>
          </Ability>
        </AbilityList>
      </Rotation>
      <Rotation Name="Баланс">
        <HotKey Key="V" Modifier="Alt" />
        <AbilityList>
          <Ability Name="Инициализация">
            <SpellID>0</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if     IsModKeyDown(mkLeftShift) then
elseif IsModKeyDown(mkLeftControl) then
    if setAoE then
        setAoE = false;
        print("|cff00ff00 >> Одиночная цель");
    else
        setAoE = true;
        print("|cffff0000 >> AOE");
    end
elseif IsModKeyDown(mkLeftAlt) then
    return true;
elseif IsModKeyDown(mkRightShift) then
    if useCooldown then
        useCooldown = false;
        print("|cffff0000Кулдауны выключены");
    else
        useCooldown = true;
        print("|cff00ff00Кулдауны включены");
    end
elseif IsModKeyDown(mkRightControl) then
elseif IsModKeyDown(mkRightAlt) then
end

-- если персонаж на маунте, тогда не выполняем ротацию дальше
if IsMounted() or IsStealthed() then
    return true;
end

-- камень здоровья
if HealthByPercent("player") < 30 then
    UseItemById(5512);
end
]]></Lua>
          </Ability>
          <Ability Name="Лунный огонь">
            <SpellID>8921</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if select(3, HasDebuff("target", 8921)) < 3 then
    return true;
end

if IS_MOVING and GetEclipseDirection() == "sun" then
    return not HasBuff("player", 93400);
end
]]></Lua>
          </Ability>
          <Ability Name="Лунный огонь">
            <SpellID>8921</SpellID>
            <Target>Focus</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if select(3, HasDebuff("focus", 8921)) < 3 then
    return true;
end

if IS_MOVING and GetEclipseDirection() == "sun" then
    return not HasBuff("player", 93400);
end
]]></Lua>
          </Ability>
          <Ability Name="Лунный огонь">
            <SpellID>8921</SpellID>
            <Target>Mouseover</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if select(3, HasDebuff("mouseover", 8921)) < 3 then
    return true;
end

if IS_MOVING and GetEclipseDirection() == "sun" then
    return not HasBuff("player", 93400);
end
]]></Lua>
          </Ability>
          <Ability Name="Солнечный огонь">
            <SpellID>93402</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if select(3, HasDebuff("target", 93402)) < 3 then
    return true;
end

if IS_MOVING and GetEclipseDirection() == "moon" then
    return not HasBuff("player", 93400);
end
]]></Lua>
          </Ability>
          <Ability Name="Солнечный огонь">
            <SpellID>93402</SpellID>
            <Target>Focus</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if select(3, HasDebuff("focus", 93402)) < 3 then
    return true;
end

if IS_MOVING and GetEclipseDirection() == "moon" then
    return not HasBuff("player", 93400);
end
]]></Lua>
          </Ability>
          <Ability Name="Солнечный огонь">
            <SpellID>93402</SpellID>
            <Target>Mouseover</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if select(3, HasDebuff("mouseover", 93402)) < 3 then
    return true;
end

if IS_MOVING and GetEclipseDirection() == "moon" then
    return not HasBuff("player", 93400);
end
]]></Lua>
          </Ability>
          <Ability Name="Звездный поток">
            <SpellID>78674</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if IS_MOVING and HasBuff("player", 93400) then
    return true;
elseif not IS_MOVING then
    return true;
end

]]></Lua>
          </Ability>
          <Ability Name="Гнев">
            <SpellID>5176</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>NotMoving</IsMovingCheck>
            <Lua><![CDATA[
if GetEclipseDirection() == "moon" then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Звездный огонь">
            <SpellID>2912</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>NotMoving</IsMovingCheck>
            <Lua><![CDATA[
if GetEclipseDirection() == "sun" then
    return true;
end
]]></Lua>
          </Ability>
        </AbilityList>
      </Rotation>
      <Rotation Name="Сила зверя">
        <HotKey Key="C" Modifier="Alt" />
        <AbilityList>
          <Ability Name="Инициализация">
            <SpellID>0</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if     IsModKeyDown(mkLeftShift) then
elseif IsModKeyDown(mkLeftControl) then
    if setAoE then
        setAoE = false;
        print("|cff00ff00 >> Одиночная цель");
    else
        setAoE = true;
        print("|cffff0000 >> AOE");
    end
elseif IsModKeyDown(mkLeftAlt) then
    return true;
elseif IsModKeyDown(mkRightShift) then
    if useCooldown then
        useCooldown = false;
        print("|cffff0000Кулдауны выключены");
    else
        useCooldown = true;
        print("|cff00ff00Кулдауны включены");
    end
elseif IsModKeyDown(mkRightControl) then
elseif IsModKeyDown(mkRightAlt) then
end

-- если персонаж на маунте, тогда не выполняем ротацию дальше
if IsMounted() or HasBuff("player", 5215) then
    return true;
end

-- камень здоровья
if HealthByPercent("player") < 30 then
    UseItemById(5512);
end

agroStatus = UnitThreatSituation("player");
playerHP   = HealthByPercent("player");
isInMeele  = IsSpellInRange(GetSpellInfo(33878), "target") == 1;
isCat      = GetShapeshiftForm() == 3;
energy     = UnitPower("player");
combopoint = GetComboPoints("player");
]]></Lua>
          </Ability>
          <Ability Name="Дикий рев">
            <SpellID>52610</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
local sr = select(3, HasBuff("player", 52610));
if (combopoint > 4 and sr < 4) or (sr < 2 and combopoint > 0) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Тигриное неистовство">
            <SpellID>5217</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if energy < 35 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Берсерк">
            <SpellID>106952</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if useCooldown and energy < 35 and not HasBuff("player", 106952) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Взбучка">
            <SpellID>106832</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if isInMeele and (setAoE or HasBuff("player", 16864)) and not HasDebuff("target", 106830, "PLAYER") then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Размах">
            <SpellID>62078</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if setAoE and isInMeele then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Природная чуткость">
            <SpellID>124974</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if IsSpellKnown(124974) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Целительное прикосновение">
            <SpellID>5185</SpellID>
            <Target>Player</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if HasBuff("player", 16974) then
     return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Свирепый укус">
            <SpellID>22568</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
local rip = select(3, HasDebuff("target", 1079, "PLAYER"));
if HealthByPercent("target") < 25 then
    if (rip < 2 and combopoint > 1) or combopoint > 4 then
        return true;
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Разорвать">
            <SpellID>1079</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if combopoint > 4 and select(3, HasDebuff("target", 1079)) < 2 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Глубокая рана">
            <SpellID>1822</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if select(3, HasDebuff("target", 1822)) < 3 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Полоснуть">
            <SpellID>5221</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if not IsNotBehind(3) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Увечье">
            <SpellID>33876</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if energy >= 40 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Знак дикой природы">
            <SpellID>1126</SpellID>
            <Target>Player</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
local params_buff = { 1126, 115921, 20217, 90363 };
if type(members) == "table" and GetShapeshiftForm() == 0 then
    for _,member in ipairs(members) do
        if member.IsInMyParty and UnitIsPlayer(member.Unit) and not HasBuff(member.Unit, params_buff) then
            return true;
        end
    end
elseif not UnitAffectingCombat("player") then
    if not HasBuff("player", params_buff) then
        return true;
    end
end
]]></Lua>
          </Ability>
        </AbilityList>
      </Rotation>
      <Rotation Name="Фарм репы">
        <HotKey Key="N" Modifier="Alt" />
        <AbilityList>
          <Ability Name="Инициализация">
            <SpellID>0</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if IsModKeyDown(mkLeftAlt) then
    return true;
end

if IsMounted() then
    return true;
end

if GetShapeshiftForm() ~= 0 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Лунный огонь">
            <SpellID>8921</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- 64399 Боевой штандарт координации
--UseItemById(64399);
TargetNearestEnemy();
-- and string.match(UnitName("target"), "^(.+).жных морей$")
if UnitExists("target") and not UnitIsDeadOrGhost("target") and (IsMoving() or not HasDebuff("target", 8921)) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Гнев">
            <SpellID>5176</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
return true;
]]></Lua>
          </Ability>
          <Ability Name="Знак дикой природы">
            <SpellID>1126</SpellID>
            <Target>Player</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
local params_buff = { 1126, 115921, 20217, 90363 };
if type(members) == "table" and GetShapeshiftForm() == 0 then
    for _,member in ipairs(members) do
        if member.IsInMyParty and UnitIsPlayer(member.Unit) and not HasBuff(member.Unit, params_buff) then
            return true;
        end
    end
elseif not UnitAffectingCombat("player") then
    if not HasBuff("player", params_buff) then
        return true;
    end
end
]]></Lua>
          </Ability>
        </AbilityList>
      </Rotation>
      <Rotation Name="Лекарь: Дамаг">
        <HotKey Key="B" Modifier="Alt" />
        <AbilityList>
          <Ability Name="Инициализация">
            <SpellID>0</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- модификатор
if     IsModKeyDown(mkLeftShift) then
    return true;
elseif IsModKeyDown(mkLeftControl) then
elseif IsModKeyDown(mkLeftAlt) then
elseif IsModKeyDown(mkRightShift) then
    if useCooldown then
        useCooldown = false;
        AddonFrame.print("|cffff0000Кулдауны выключены", true);
    else
        useCooldown = true;
        AddonFrame.print("|cff00ff00Кулдауны включены", true);
    end
elseif IsModKeyDown(mkRightControl) then
    if useAutoDispell then
        useAutoDispell = false;
        AddonFrame.print("|cffff0000Автодиспел выключен", true);
    else
        useAutoDispell = true;
        AddonFrame.print("|cff00ff00Автодиспел включен", true);
    end
elseif IsModKeyDown(mkRightAlt) then
    if useDamage then
        useDamage = false;
        AddonFrame.print("|cffff0000Нанесение урона выключено", true);
    else
        useDamage = true;
        AddonFrame.print("|cff00ff00Нанесение урона включено", true);
    end
end

local b_ufs = { 58984, 104270 };

-- если персонаж на маунте или в форме или "Слился с тенью", тогда не выполняем ротацию дальше
if IsMounted() or (GetShapeshiftForm() ~= 0 and GetShapeshiftForm() ~= 6) or HasBuff("player", b_ufs) or IsStealthed() then
    return true;
end

-- Если кастуем спокойствие - тогда ничего не делаем
if UnitChannelInfo("player") then
    return true;
end

FillPartyTables(774);

isInRange = IsSpellInRange(GetSpellInfo(8092), "target") == 1;
isMoving  = IsMoving();
myMana    = PowerByPercent("player", SPELL_POWER_MANA);

-- используем аксесуар на ману, только в форме исцеления (0)
if myMana < 80 and GetShapeshiftForm() == 0 then
    UseItemBySlot(INVSLOT_TRINKET2);
end

if myMana < 90 and GetShapeshiftForm() == 0 then
    UseItemBySlot(INVSLOT_TRINKET1);
end

-- камень здоровья
if HealthByPercent("player") < 30 then
    UseItemById(5512);
end

if LowHP.H70 > 3 and UnitAffectingCombat("player") then
    UseItemBySlot(INVSLOT_HAND); -- Нейронные пружины
end

if UnitId("boss1") == 71529 and UnitCastingInfo("boss1") then
    if UnitCastingInfo("player") == GetSpellInfo(5185) or UnitCastingInfo("player") == GetSpellInfo(50464) then
        SpellStopCasting()
    end
end

-- прервем чтение покровительства природы, если есть просевшие цели
--if (members[1].HP < 60 or LowHP.H80 > 3) and UnitCastingInfo("player") == GetSpellInfo(50464) then
--    SpellStopCasting();
--end
]]></Lua>
          </Ability>
          <Ability Name="Дикий гриб">
            <SpellID>88747</SpellID>
            <Target>MouseLocation</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if IsMouseButtonDown(3) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Возрождение">
            <SpellID>20484</SpellID>
            <Target>Mouseover</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>NotMoving</IsMovingCheck>
            <Lua><![CDATA[
if UnitIsDeadOrGhost("mouseover") then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Озарение">
            <SpellID>29166</SpellID>
            <Target>Player</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if myMana <= 75 and (GetShapeshiftForm() == 0 or GetShapeshiftForm() == 6) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Лунный огонь">
            <SpellID>8921</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>true</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if select(3, HasDebuff("target", 8921, "PLAYER")) < 2 then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Гнев">
            <SpellID>5176</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>true</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>true</IsSpellKnownCheck>
            <IsMovingCheck>NotMoving</IsMovingCheck>
            <Lua><![CDATA[
return true;
]]></Lua>
          </Ability>
        </AbilityList>
      </Rotation>
    </RotationList>
  </Profile>
  <Profile Class="None">
    <RotationList>
      <Rotation Name="Малигос">
        <HotKey Key="M" Modifier="Alt Shift" />
        <AbilityList>
          <Ability Name="Инициализация">
            <SpellID>0</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if not UnitHasVehicleUI("player") then
    return true;
end

if IsModKeyDown(mkLeftAlt) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Дыхание жизни">
            <SpellID>0</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if GetPetActionCooldown(4) == 0 then
    if HealthByPercent("vehicle") < 40 and not HasBuff("vehicle", 57143) then
        if select(2, HasBuff("player", 57090)) > 3 then
            CastPetAction(4);
        end
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Реанимация">
            <SpellID>0</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if GetPetActionCooldown(3) == 0 then
    if     HealthByPercent("vehicle") < 90 then
        if select(2, HasBuff("vehicle", 57090)) < 1 then
            CastPetAction(3);
        end
    elseif HealthByPercent("vehicle") < 70 then
        if select(2, HasBuff("vehicle", 57090)) < 2 then
            CastPetAction(3);
        end
    elseif HealthByPercent("vehicle") < 50 then
        if select(2, HasBuff("vehicle", 57090)) < 3 then
            CastPetAction(3);
        end
    elseif HealthByPercent("vehicle") < 30 then
        if select(2, HasBuff("vehicle", 57090)) < 4 then
            CastPetAction(3);
        end
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Окутать пламенем">
            <SpellID>0</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>true</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>true</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if UnitExists("target") and UnitIsEnemy("player", "target")
    and GetPetActionCooldown(2) == 0 and GetComboPoints("vehicle") > 2 then
    CastPetAction(2, ability.Target);
end
]]></Lua>
          </Ability>
          <Ability Name="Пламенный шип">
            <SpellID>0</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if UnitExists("target") and UnitIsEnemy("player", "target")
    and GetPetActionCooldown(1) == 0 and GetComboPoints("vehicle") < 3 then
    CastPetAction(1, ability.Target);
end
]]></Lua>
          </Ability>
        </AbilityList>
      </Rotation>
      <Rotation Name="Серебряный авангард (Турнир)">
        <HotKey Key="T" Modifier="Alt Shift" />
        <AbilityList>
          <Ability Name="Инициализация">
            <SpellID>0</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if not UnitHasVehicleUI("player") then
    return true;
end

if IsModKeyDown(mkLeftAlt) then
    return true;
end
]]></Lua>
          </Ability>
          <Ability Name="Защита">
            <SpellID>0</SpellID>
            <Target>None</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if GetPetActionCooldown(4) == 0 then
    local col, rem = select(2, HasBuff("vehicle", 62552));
    if col < 3 or rem < 5 then
        CastPetAction(4);
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Удар по щиту">
            <SpellID>0</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- как-то определть дистанцию до цели
if UnitExists("target") and UnitIsEnemy("player", "target")
    and GetPetActionCooldown(2) == 0 then
    if select(2, HasBuff("target", 62719)) > 1 then
        CastPetAction(2);
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Рывок">
            <SpellID>0</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
-- как-то определть дистанцию до цели
if UnitExists("target") and UnitIsEnemy("player", "target")
    and GetPetActionCooldown(3) == 0 then
    if select(2, HasBuff("target", 62719)) <= 1 then
        CastPetAction(3);
    end
end
]]></Lua>
          </Ability>
          <Ability Name="Выпад">
            <SpellID>0</SpellID>
            <Target>Target</Target>
            <CancelChannel>false</CancelChannel>
            <CancelCasting>false</CancelCasting>
            <IsRangeCheck>false</IsRangeCheck>
            <IsAttacedTarget>false</IsAttacedTarget>
            <IsUseIncombat>false</IsUseIncombat>
            <SetRecastDelay>false</SetRecastDelay>
            <IsNotGCD>false</IsNotGCD>
            <IsSpellKnownCheck>false</IsSpellKnownCheck>
            <IsMovingCheck>None</IsMovingCheck>
            <Lua><![CDATA[
if UnitExists("target") and UnitIsEnemy("player", "target")
    and GetPetActionCooldown(1) == 0 then
    CastPetAction(1);
end
]]></Lua>
          </Ability>
        </AbilityList>
      </Rotation>
    </RotationList>
  </Profile>
</ProfileDb>